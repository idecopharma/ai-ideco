<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>ƒê·ªäNH H∆Ø·ªöNG TU·∫¶N (Full Width Image)</title>
  <meta name="viewport" content="width=1200">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css"/>
  <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
<style>
  .custom-shadow-copy { box-shadow: 0 4px 24px 0 rgba(59, 130, 246, 0.25); }
  .scrollbar-copy { scrollbar-width: thin; scrollbar-color: #cbd5e1 #fff; }
  .scrollbar-copy::-webkit-scrollbar { width: 8px; }
  .scrollbar-copy::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px;}
  #mainIcon_copy { position: fixed; top: 61px; right:710px; z-index: 1000; cursor: pointer; transition: all 0.3s ease; }
  #mainIcon_copy:hover { transform: scale(1.05); box-shadow: 0 6px 28px 0 rgba(59, 130, 246, 0.3); }
  .icon-rectangle-copy { width: 230px; height: 55px; border-radius: 16px; background-color: green; border: 4px solid white; box-shadow: 0 4px 24px 0 rgba(59, 130, 246, 0.25); display: flex; align-items: center; justify-content: center; padding: 0 15px; }
  .icon-text-copy { color: white; font-size: 1.325rem; font-weight: bold; text-align: center; width: 100%; }
  #wowup_copy { z-index: 9999; }
  .pdf-viewer-container-copy { width: 100%; padding: 0; margin: 0; position: relative; background: none; transition: transform 0.2s ease, box-shadow 0.2s ease; }
  .pdf-viewer-container-copy.dragging { opacity: 0.5; border: 2px dashed #3b82f6; background-color: #eff6ff; }
  .pdf-page-container-copy { margin: 0; box-shadow: none; display: block; width: 100%; padding: 0; }
  .pdf-page-copy { max-width: 100% !important; width: 100% !important; height: auto !important; display: block; margin: 0; padding: 0; }
  .file-title-copy { margin-bottom: 6px; font-size: 1.1rem; color: #333; align-self: flex-start; padding-left: 12px; cursor: move; user-select: none; }
  .file-title-copy:hover { background-color: #dbeafe; }
  .delete-modal_copy { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); z-index: 100; justify-content: center; align-items: center; }
  .delete-modal-content_copy { background-color: white; padding: 20px; border-radius: 8px; width: 400px; max-width: 90%; }
  .delete-checkbox_copy { margin-right: 10px; }
  .delete-file-item_copy { display: flex; align-items: center; padding: 8px 0; border-bottom: 1px solid #eee; }
  
  /* Popup Full M√†n H√¨nh */
  #popup_copy_resizable { 
    width: 99vw !important; height: 98vh !important; 
    max-width: 100vw; max-height: 100vh;
    resize: none; box-sizing: border-box; 
  }
  
  .resize-handle-copy { position: absolute; width: 20px; height: 20px; right: 0; bottom: 0; cursor: nwse-resize; z-index: 1000; background: transparent; }
  .loading-overlay-copy { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); z-index: 200; justify-content: center; align-items: center; color: white; font-size: 1.5rem; flex-direction: column; }
  .spinner-copy { border: 5px solid #f3f3f3; border-top: 5px solid #3b82f6; border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite; margin-bottom: 15px; }
  @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
  .footer-buttons-copy { padding: 8px 4px; height: 60px; }
  .footer-buttons-copy .flex-wrap { gap: 6px; }
  .footer-buttons-copy button, .footer-buttons-copy input { padding: 4px 8px; font-size: 0.875rem; }
  #editorArea_copy { box-shadow: 0 8px 30px 0 rgba(0,0,0,0.15); border-radius: 10px; }
  #editorArea_copy .ql-toolbar { border-radius: 10px 10px 0 0; }
  #editorArea_copy .ql-container { border-radius: 0 0 10px 10px; }
  .quill-content-copy ol { list-style-type: decimal; margin-left: 2rem; padding-left: 1rem;}
  .quill-content-copy ul { list-style-type: disc; margin-left: 2rem; padding-left: 1rem;}
  .quill-content-copy .ql-size-small { font-size: 0.75em; }
  .quill-content-copy .ql-size-large { font-size: 1.5em; }
  .quill-content-copy .ql-size-huge { font-size: 2.5em; }
  #quillEditorCopy { background-color: white; min-height: 300px; font-size: 16px; line-height: 1.5; }
  #quillEditorCopy .ql-editor { min-height: 300px; }
</style>
</head>
<body class="bg-gray-50">
  <div id="mainIcon_copy">
    <div class="icon-rectangle-copy">
      <span class="icon-text-copy"> M·ª§C TI√äU KINH DOANH </span>
    </div>
  </div>
  <div id="wowup_copy" class="hidden fixed z-50 top-0 left-0 w-full h-full flex items-center justify-center bg-black bg-opacity-40">
    <div id="popup_copy_resizable" class="relative bg-white custom-shadow-copy border-4 border-blue-500 flex flex-col">
      <div id="contentArea_copy" class="flex-1 overflow-y-scroll p-0 scrollbar-copy border-b border-blue-200" style="max-height: calc(98vh - 80px);"></div>
      
      <div class="footer-buttons-copy flex gap-3 items-center justify-center flex-wrap">
        <input type="file" id="pdfInput_copy" accept="application/pdf, image/*" multiple class="rounded-full border-0 bg-blue-600 text-white py-1 px-3" />
        <button onclick="handleUpload_copy()" id="uploadBtn_copy" class="bg-blue-500 text-white px-3 py-1 rounded shadow hover:bg-blue-700">Upload</button>
        <button onclick="showEditor_copy()" id="editorBtn_copy" class="bg-purple-600 text-white px-3 py-1 rounded shadow hover:bg-purple-800">Nh·∫≠p n·ªôi dung</button>
        <button onclick="handleSave_copy()" id="saveBtn_copy" class="bg-green-600 text-white px-3 py-1 rounded shadow hover:bg-green-800">L∆∞u</button>
        <button onclick="showDeleteModal_copy()" id="deleteBtn_copy" class="bg-red-600 text-white px-3 py-1 rounded shadow hover:bg-red-800" disabled>X√≥a file</button>
        <button onclick="closeWowup_copy()" title="ƒê√≥ng popup" class="bg-gray-200 text-blue-500 px-3 py-1 rounded-full text-xl font-bold shadow hover:bg-gray-400 flex items-center justify-center">√ó</button>
        <button id="markAsReadBtn_copy" class="bg-gray-600 text-white px-3 py-1 rounded shadow hover:bg-gray-800 text-sm">ƒê√£ ƒë·ªçc</button>
      </div>

      <div class="resize-handle-copy"></div>
      
      <div id="editorArea_copy" class="hidden absolute top-0 left-0 w-full h-full bg-white z-20 flex flex-col rounded-lg border border-blue-400 shadow-lg">
        <input type="text" id="editorFileName_copy" class="border rounded px-3 py-2 m-2 text-lg font-semibold" placeholder="Nh·∫≠p t√™n n·ªôi dung (v√≠ d·ª•: ƒê·ªäNH H∆Ø·ªöNG TU·∫¶N)"/>
        <div id="quillToolbarCopy"></div>
        <div id="quillEditorCopy" style="flex:1; min-height:320px;"></div>
        <div class="flex gap-2 justify-end p-2">
          <button onclick="saveEditorContent_copy()" class="bg-green-600 text-white px-3 py-1 rounded shadow hover:bg-green-800">L∆∞u n·ªôi dung</button>
          <button onclick="closeEditor_copy()" class="bg-gray-400 text-white px-3 py-1 rounded shadow hover:bg-gray-600">ƒê√≥ng</button>
        </div>
      </div>
    </div>
  </div>
  
  <div id="deleteModal_copy" class="delete-modal_copy">
    <div class="delete-modal-content_copy">
      <h2 class="text-xl font-bold mb-4">Ch·ªçn file ƒë·ªÉ x√≥a</h2>
      <input type="password" id="deletePasswordInput_copy" placeholder="Nh·∫≠p m·∫≠t kh·∫©u ƒë·ªÉ x√≥a" class="border px-3 py-2 rounded w-full mb-4" />
      <div id="fileListToDelete_copy" class="mb-4 max-h-60 overflow-y-auto"></div>
      <div class="flex justify-end gap-2">
        <button onclick="hideDeleteModal_copy()" class="bg-gray-500 text-white px-4 py-2 rounded shadow hover:bg-gray-700">H·ªßy</button>
        <button onclick="handleDeleteFiles_copy()" class="bg-red-600 text-white px-4 py-2 rounded shadow hover:bg-red-800">X√≥a</button>
      </div>
    </div>
  </div>
  
  <div id="loadingOverlayCopy" class="loading-overlay-copy">
    <div class="spinner-copy"></div>
    <span id="loadingTextCopy">ƒêang x·ª≠ l√Ω...</span>
  </div>

  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/pdfjs-dist@3.11.174/build/pdf.min.js"></script>
  <script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>
  
  <script>
    (function() {
      const firebaseConfig_copy = {
        apiKey: "AIzaSyD4BbsXN-vLQM4JNtMWfNsNOXPnt-a9KpM",
        authDomain: "chuoint-2df9d.firebaseapp.com",
        databaseURL: "https://chuoint-2df9d-default-rtdb.firebaseio.com",
        projectId: "chuoint-2df9d",
        storageBucket: "chuoint-2df9d.firebasestorage.app",
        messagingSenderId: "989211370756",
        appId: "1:989211370756:web:475391dd8d96a0b7375c51",
        measurementId: "G-FKEXNN9VDV"
      };
      if (!firebase.apps.some(app => app.name === "app_copy")) {
        firebase.initializeApp(firebaseConfig_copy, "app_copy");
      }
      const db_copy = firebase.app("app_copy").database();
      const mainIcon_copy = document.getElementById('mainIcon_copy');
      const wowup_copy = document.getElementById('wowup_copy');
      const pdfInput_copy = document.getElementById('pdfInput_copy');
      const uploadBtn_copy = document.getElementById('uploadBtn_copy');
      const editorBtn_copy = document.getElementById('editorBtn_copy');
      const saveBtn_copy = document.getElementById('saveBtn_copy');
      const deleteBtn_copy = document.getElementById('deleteBtn_copy');
      const contentArea_copy = document.getElementById('contentArea_copy');
      const editorArea_copy = document.getElementById('editorArea_copy');
      const editorFileName_copy = document.getElementById('editorFileName_copy');
      const quillEditorCopy = document.getElementById('quillEditorCopy');
      const loadingOverlayCopy = document.getElementById('loadingOverlayCopy');
      const loadingTextCopy = document.getElementById('loadingTextCopy');
      const deleteModal_copy = document.getElementById('deleteModal_copy');
      const fileListToDelete_copy = document.getElementById('fileListToDelete_copy');
      const deletePasswordInput_copy = document.getElementById('deletePasswordInput_copy');
      const markAsReadBtn_copy = document.getElementById('markAsReadBtn_copy');

      let allPdfs_copy = [];
      let quillInstance_copy = null;
      let editingIndex_copy = null;
      let dragSrcEl_copy = null;

      mainIcon_copy.onclick = function() {
        wowup_copy.classList.remove('hidden');
        loadFromFirebase_copy();
      };

      function closeWowup_copy() {
        wowup_copy.classList.add('hidden');
      }

      const autoPopupConfig_copy = {
        targetWeekdays: [1, 2, 3, 4, 5, 6],
        openTimes: [{hour: 10, minute: 30}, {hour: 16, minute: 30}],
        lastReadDate: localStorage.getItem('popupLastReadDate_copy') || ''
      };

      function markAsReadAndClose_copy() {
        const now = new Date();
        const todayKey = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')}`;
        autoPopupConfig_copy.lastReadDate = todayKey;
        localStorage.setItem('popupLastReadDate_copy', todayKey);
        closeWowup_copy();
      }

      function shouldShowPopup() {
        const now = new Date();
        const todayKey = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')}`;
        if (autoPopupConfig_copy.lastReadDate === todayKey) return false;
        if (!autoPopupConfig_copy.targetWeekdays.includes(now.getDay())) return false;
        const currentHour = now.getHours();
        const currentMinute = now.getMinutes();
        for (const time of autoPopupConfig_copy.openTimes) {
          if (currentHour === time.hour && currentMinute >= time.minute && currentMinute < time.minute + 5) return true;
        }
        for (const time of autoPopupConfig_copy.openTimes) {
          if (currentHour > time.hour || (currentHour === time.hour && currentMinute >= time.minute)) return true;
        }
        return false;
      }

      if (markAsReadBtn_copy) {
        markAsReadBtn_copy.onclick = markAsReadAndClose_copy;
      }

      function showLoading_copy(message) {
        loadingTextCopy.textContent = message || 'ƒêang x·ª≠ l√Ω...';
        loadingOverlayCopy.style.display = 'flex';
      }
      
      function hideLoading_copy() { 
        loadingOverlayCopy.style.display = 'none'; 
      }
      
      function loadFromFirebase_copy() {
        showLoading_copy('ƒêang t·∫£i d·ªØ li·ªáu t·ª´ Firebase...');
        db_copy.ref('pdfData').once('value').then((snapshot) => {
          const data = snapshot.val();
          if (!data) allPdfs_copy = [];
          else if (Array.isArray(data)) allPdfs_copy = data;
          else allPdfs_copy = Object.values(data);
          showPdfContent_copy(allPdfs_copy);
          deleteBtn_copy.disabled = allPdfs_copy.length === 0;
          saveBtn_copy.disabled = allPdfs_copy.length === 0;
          hideLoading_copy();
        }).catch((error) => {
          alert('L·ªói khi t·∫£i d·ªØ li·ªáu t·ª´ Firebase! ' + error.message);
          hideLoading_copy();
        });
      }
      
      async function showPdfContent_copy(pdfDataArr) {
        contentArea_copy.innerHTML = '';
        if (!pdfDataArr || pdfDataArr.length === 0) {
          contentArea_copy.innerHTML = '<div class="p-4 text-gray-500 text-center">Kh√¥ng c√≥ d·ªØ li·ªáu n√†o ƒë∆∞·ª£c t·∫£i l√™n.</div>';
          return;
        }
        for (let i = 0; i < pdfDataArr.length; i++) {
          const info = pdfDataArr[i];
          const container = document.createElement('div');
          
          container.className = "pdf-viewer-container-copy mb-4 border-b border-gray-200 pb-2";
          container.setAttribute('draggable', 'true');
          container.setAttribute('data-index', i);
          
          container.addEventListener('dragstart', handleDragStart);
          container.addEventListener('dragenter', handleDragEnter);
          container.addEventListener('dragover', handleDragOver);
          container.addEventListener('dragleave', handleDragLeave);
          container.addEventListener('drop', handleDrop);
          container.addEventListener('dragend', handleDragEnd);

          const title = document.createElement('div');
          title.className = "file-title-copy font-bold text-blue-800 bg-blue-50 p-2 rounded flex justify-between items-center";
          title.title = "K√©o ti√™u ƒë·ªÅ n√†y ƒë·ªÉ s·∫Øp x·∫øp l·∫°i th·ª© t·ª±";
          const titleText = document.createElement('span');
          titleText.innerHTML = `<span style="cursor:move; margin-right:5px;">‚ú¢</span> #${i + 1}: ${info.name || 'Kh√¥ng c√≥ t√™n'}`;
          title.appendChild(titleText);
          const btnGroup = document.createElement('div');
          if (info.type === 'text') {
            const editBtn = document.createElement('button');
            editBtn.textContent = "S·ª≠a";
            editBtn.className = "ml-2 bg-blue-500 text-white px-2 py-1 rounded shadow hover:bg-blue-700 text-sm";
            editBtn.onclick = function(e) { e.stopPropagation(); editEditorContent_copy(i); };
            btnGroup.appendChild(editBtn);
          }
          title.appendChild(btnGroup);
          container.appendChild(title);

          if (info.type === 'text') {
            const contentDiv = document.createElement('div');
            contentDiv.innerHTML = info.html;
            contentDiv.className = "p-3 border rounded bg-yellow-50 mb-3 quill-content-copy";
            container.appendChild(contentDiv);
          } 
          else if (info.type === 'image') {
            // === LOGIC M·ªöI: T·ª∞ ƒê·ªòNG CANH CH·ªàNH ·∫¢NH ===
            const imgDiv = document.createElement('div');
            imgDiv.className = "w-full flex justify-center p-2"; // Th√™m w-full ƒë·ªÉ container r·ªông 100%
            
            const img = document.createElement('img');
            img.src = info.data;
            img.className = "rounded shadow border";
            img.draggable = false;
            
            // X·ª≠ l√Ω khi ·∫£nh t·∫£i xong ƒë·ªÉ bi·∫øt k√≠ch th∆∞·ªõc
            img.onload = function() {
                const naturalW = this.naturalWidth;
                const naturalH = this.naturalHeight;
                
                // N·∫øu l√† ·∫£nh ngang (Landscape) -> Full Width
                if (naturalW > naturalH) {
                    this.style.width = "100%";
                    this.style.height = "auto";
                    this.style.maxWidth = "100%";
                } else {
                    // N·∫øu l√† ·∫£nh d·ªçc (Portrait) -> Gi·ªõi h·∫°n chi·ªÅu cao
                    this.style.width = "auto";
                    this.style.maxHeight = "85vh";
                    this.style.maxWidth = "100%";
                }
            };
            
            imgDiv.appendChild(img);
            container.appendChild(imgDiv);
          } 
          else {
            const pdfContainer = document.createElement('div');
            pdfContainer.className = "pdf-container";
            container.appendChild(pdfContainer);
            await renderPdf_copy(info.data, pdfContainer);
          }
          contentArea_copy.appendChild(container);
        }
      }

      function handleDragStart(e) {
        this.style.opacity = '0.4';
        dragSrcEl_copy = this;
        e.dataTransfer.effectAllowed = 'move';
        e.dataTransfer.setData('text/html', this.innerHTML);
        this.classList.add('dragging');
      }
      function handleDragOver(e) { if (e.preventDefault) e.preventDefault(); e.dataTransfer.dropEffect = 'move'; return false; }
      function handleDragEnter(e) { this.classList.add('over'); }
      function handleDragLeave(e) { this.classList.remove('over'); }
      function handleDrop(e) {
        if (e.stopPropagation) e.stopPropagation();
        if (dragSrcEl_copy !== this) {
          let fromIndex = Number(dragSrcEl_copy.getAttribute('data-index'));
          let toIndex = Number(this.getAttribute('data-index'));
          const itemToMove = allPdfs_copy.splice(fromIndex, 1)[0];
          allPdfs_copy.splice(toIndex, 0, itemToMove);
          showPdfContent_copy(allPdfs_copy);
          saveBtn_copy.disabled = false;
          alertToast("ƒê√£ ƒë·ªïi v·ªã tr√≠. H√£y b·∫•m 'L∆∞u' ƒë·ªÉ c·∫≠p nh·∫≠t.");
        }
        return false;
      }
      function handleDragEnd(e) {
        this.style.opacity = '1';
        this.classList.remove('dragging');
        document.querySelectorAll('.pdf-viewer-container-copy').forEach(item => item.classList.remove('over'));
      }
      function alertToast(msg) {
        const toast = document.createElement('div');
        toast.textContent = msg;
        toast.style.cssText = "position:fixed; bottom:20px; right:20px; background:#333; color:#fff; padding:10px 20px; border-radius:5px; z-index:99999; animation: fadein 0.5s, fadeout 0.5s 2.5s;";
        document.body.appendChild(toast);
        setTimeout(() => { toast.remove(); }, 3000);
      }
      
      async function renderPdf_copy(pdfData, container) {
        try {
          let base64 = pdfData;
          if (pdfData.includes(',')) base64 = pdfData.split(',')[1];
          const binaryString = atob(base64);
          const bytes = new Uint8Array(binaryString.length);
          for (let i = 0; i < binaryString.length; i++) bytes[i] = binaryString.charCodeAt(i);
          const pdf = await pdfjsLib.getDocument({data: bytes}).promise;
          for (let j = 1; j <= pdf.numPages; j++) {
            const page = await pdf.getPage(j);
            const parentWidth = container.clientWidth || container.offsetWidth || 0;
            const pdfOriginalWidth = page.getViewport({ scale: 1.0 }).width;
            let scale = 1;
            if (parentWidth > 0 && pdfOriginalWidth > 0) scale = parentWidth / pdfOriginalWidth;
            const viewport = page.getViewport({ scale: scale });
            const pageContainer = document.createElement('div');
            pageContainer.className = "pdf-page-container-copy";
            pageContainer.style.width = "100%";
            const canvas = document.createElement('canvas');
            const context = canvas.getContext('2d');
            canvas.width = viewport.width;
            canvas.height = viewport.height;
            canvas.className = "pdf-page-copy";
            canvas.style.width = "100%";
            canvas.style.height = "auto";
            pageContainer.appendChild(canvas);
            container.appendChild(pageContainer);
            await page.render({canvasContext: context, viewport: viewport}).promise;
          }
        } catch (error) {
          container.innerHTML = `<div class="text-red-500 p-4">L·ªói khi hi·ªÉn th·ªã PDF: ${error.message}</div>`;
        }
      }
      
      function resizeImage_copy(file) {
        return new Promise((resolve, reject) => {
          const reader = new FileReader();
          reader.readAsDataURL(file);
          reader.onload = function(event) {
            const img = new Image();
            img.src = event.target.result;
            img.onload = function() {
              // === TƒÇNG CH·∫§T L∆Ø·ª¢NG N√âN ƒê·ªÇ XEM FULL SCREEN R√ï H∆†N ===
              const maxWidth = 1920; // TƒÉng l√™n 1920px (Full HD) thay v√¨ 1000px
              let width = img.width;
              let height = img.height;
              if (width > maxWidth) {
                height *= maxWidth / width;
                width = maxWidth;
              }
              const canvas = document.createElement('canvas');
              canvas.width = width;
              canvas.height = height;
              const ctx = canvas.getContext('2d');
              ctx.drawImage(img, 0, 0, width, height);
              resolve(canvas.toDataURL('image/jpeg', 0.8)); // Ch·∫•t l∆∞·ª£ng 0.8
            };
            img.onerror = reject;
          };
          reader.onerror = reject;
        });
      }

      async function handleUpload_copy() {
        const files = pdfInput_copy.files;
        if (!files.length) { alert("Vui l√≤ng ch·ªçn √≠t nh·∫•t m·ªôt file (PDF ho·∫∑c ·∫¢nh)!"); return; }
        uploadBtn_copy.innerText = "ƒêang x·ª≠ l√Ω...";
        uploadBtn_copy.disabled = true;
        showLoading_copy('ƒêang x·ª≠ l√Ω file...');
        try {
          for (let i = 0; i < files.length; i++) {
            const file = files[i];
            if (file.type.startsWith('image/')) {
               const imageData = await resizeImage_copy(file);
               allPdfs_copy.push({ name: file.name, type: 'image', data: imageData });
            } 
            else if (file.type === 'application/pdf') {
               const pdfData = await readFileAsBase64_copy(file);
               allPdfs_copy.push({ name: file.name, type: 'pdf', data: pdfData });
            } else { console.warn("File kh√¥ng ƒë∆∞·ª£c h·ªó tr·ª£: " + file.name); }
          }
          showPdfContent_copy(allPdfs_copy);
          deleteBtn_copy.disabled = false;
          saveBtn_copy.disabled = false;
          pdfInput_copy.value = "";
        } catch (error) { alert('L·ªói khi t·∫£i l√™n: ' + error.message); } finally {
          uploadBtn_copy.innerText = "Upload";
          uploadBtn_copy.disabled = false;
          hideLoading_copy();
        }
      }
      
      window.handleUpload_copy = handleUpload_copy;
      
      function readFileAsBase64_copy(file) {
        return new Promise((resolve, reject) => {
          const reader = new FileReader();
          reader.onload = function() { resolve(reader.result.split(',')[1]); };
          reader.onerror = reject;
          reader.readAsDataURL(file);
        });
      }
      
      async function handleSave_copy() {
        try {
          if (!allPdfs_copy || allPdfs_copy.length === 0) { alert('Kh√¥ng c√≥ d·ªØ li·ªáu n√†o ƒë·ªÉ l∆∞u!'); return; }
          saveBtn_copy.innerText = "ƒêang l∆∞u...";
          saveBtn_copy.disabled = true;
          showLoading_copy('ƒêang l∆∞u d·ªØ li·ªáu v√†o Firebase...');
          await db_copy.ref('pdfData').set(allPdfs_copy);
          alert('D·ªØ li·ªáu ƒë√£ ƒë∆∞·ª£c l∆∞u th√†nh c√¥ng v√†o Firebase!');
          deleteBtn_copy.disabled = allPdfs_copy.length === 0;
        } catch (error) { alert(`L·ªói khi l∆∞u d·ªØ li·ªáu: ${error.message}`); } finally {
          saveBtn_copy.innerText = "L∆∞u";
          saveBtn_copy.disabled = false;
          hideLoading_copy();
        }
      }
      window.handleSave_copy = handleSave_copy;
      
      function showDeleteModal_copy() {
        fileListToDelete_copy.innerHTML = '';
        allPdfs_copy.forEach((item, index) => {
          const itemDiv = document.createElement('div');
          itemDiv.className = 'delete-file-item_copy';
          itemDiv.innerHTML = `<input type="checkbox" id="delete_${index}_copy" class="delete-checkbox_copy" checked><label for="delete_${index}_copy">${item.name || `File ${index + 1}`}</label>`;
          fileListToDelete_copy.appendChild(itemDiv);
        });
        deleteModal_copy.style.display = 'flex';
        deletePasswordInput_copy.focus();
      }
      window.showDeleteModal_copy = showDeleteModal_copy;
      function hideDeleteModal_copy() { deleteModal_copy.style.display = 'none'; deletePasswordInput_copy.value = ''; }
      window.hideDeleteModal_copy = hideDeleteModal_copy;
      function handleDeleteFiles_copy() {
        if (deletePasswordInput_copy.value !== "minhtriet@1973") { alert("Sai m·∫≠t kh·∫©u x√≥a!"); return; }
        const checkboxes = document.querySelectorAll('.delete-checkbox_copy');
        const filesToKeep = [];
        checkboxes.forEach((checkbox, index) => { if (!checkbox.checked) filesToKeep.push(allPdfs_copy[index]); });
        if (filesToKeep.length === allPdfs_copy.length) { alert("B·∫°n ch∆∞a ch·ªçn file n√†o ƒë·ªÉ x√≥a!"); return; }
        if (!confirm(`B·∫°n ch·∫Øc ch·∫Øn mu·ªën x√≥a ${allPdfs_copy.length - filesToKeep.length} m·ª•c ƒë√£ ch·ªçn kh√¥ng?`)) return;
        showLoading_copy('ƒêang x√≥a...');
        db_copy.ref('pdfData').set(filesToKeep).then(() => { loadFromFirebase_copy(); hideDeleteModal_copy(); })
          .catch((error) => { alert('L·ªói khi x√≥a: ' + error.message); hideLoading_copy(); });
      }
      window.handleDeleteFiles_copy = handleDeleteFiles_copy;
      
      function showEditor_copy() {
        editorArea_copy.classList.remove('hidden');
        if (!quillInstance_copy) {
          var Font = Quill.import('formats/font');
          Font.whitelist = ['arial', 'times-new-roman', 'sans-serif', 'serif', 'monospace'];
          Quill.register(Font, true);
          quillInstance_copy = new Quill(quillEditorCopy, {
            modules: { toolbar: [[{ 'font': ['arial', 'times-new-roman', 'sans-serif', 'serif', 'monospace'] }, { 'size': [] }], ['bold', 'italic', 'underline', 'strike'], [{ 'color': [] }, { 'background': [] }], [{ 'header': [1, 2, 3, false] }], [{ 'align': [] }], [{ 'list': 'ordered'}, { 'list': 'bullet' }], [{ 'indent': '-1'}, { 'indent': '+1' }], ['clean']] },
            placeholder: 'Nh·∫≠p n·ªôi dung t·∫°i ƒë√¢y...', theme: 'snow'
          });
          setTimeout(() => { quillInstance_copy.focus(); }, 100);
        }
        if (editingIndex_copy === null) { quillInstance_copy.setContents([]); editorFileName_copy.value = ''; }
      }
      window.showEditor_copy = showEditor_copy;
      function closeEditor_copy() { editorArea_copy.classList.add('hidden'); editingIndex_copy = null; }
      window.closeEditor_copy = closeEditor_copy;
      function saveEditorContent_copy() {
        if (!quillInstance_copy) { alert("Tr√¨nh so·∫°n th·∫£o l·ªói."); return; }
        const htmlContent = quillInstance_copy.root.innerHTML;
        const customName = editorFileName_copy.value.trim() || 'Kh√¥ng ti√™u ƒë·ªÅ';
        if (!quillInstance_copy.getText().trim()) { alert("Vui l√≤ng nh·∫≠p n·ªôi dung!"); return; }
        showLoading_copy('ƒêang l∆∞u n·ªôi dung...');
        try {
          if (editingIndex_copy !== null) { allPdfs_copy[editingIndex_copy].html = htmlContent; allPdfs_copy[editingIndex_copy].name = customName; editingIndex_copy = null; }
          else { allPdfs_copy.push({ type: 'text', name: customName, html: htmlContent }); }
          showPdfContent_copy(allPdfs_copy);
          closeEditor_copy();
          saveBtn_copy.disabled = false;
          deleteBtn_copy.disabled = false;
          alert('ƒê√£ l∆∞u n·ªôi dung t·∫°m th·ªùi. Nh·ªõ b·∫•m "L∆∞u" ƒë·ªÉ c·∫≠p nh·∫≠t l√™n h·ªá th·ªëng!');
        } catch (error) { alert('L·ªói: ' + error.message); } finally { hideLoading_copy(); }
      }
      window.saveEditorContent_copy = saveEditorContent_copy;
      function editEditorContent_copy(index) {
        editingIndex_copy = index;
        editorArea_copy.classList.remove('hidden');
        if (!quillInstance_copy) showEditor_copy();
        quillInstance_copy.root.innerHTML = allPdfs_copy[index].html || "";
        editorFileName_copy.value = allPdfs_copy[index].name || '';
        setTimeout(() => { quillInstance_copy.focus(); }, 100);
      }
      window.editEditorContent_copy = editEditorContent_copy;
      function checkAutoPopup_copy() { if (shouldShowPopup()) openPopupAutomatically_copy(); }
      function openPopupAutomatically_copy() { if (wowup_copy.classList.contains('hidden')) { wowup_copy.classList.remove('hidden'); loadFromFirebase_copy(); } }
      setInterval(checkAutoPopup_copy, 60000);
      document.addEventListener('DOMContentLoaded', function() {
        const now = new Date();
        const todayKey = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')}`;
        if (autoPopupConfig_copy.lastReadDate !== todayKey) { autoPopupConfig_copy.lastReadDate = ''; localStorage.removeItem('popupLastReadDate_copy'); }
        checkAutoPopup_copy();
        const markBtn = document.getElementById('markAsReadBtn_copy');
        if (markBtn) markBtn.onclick = markAsReadAndClose_copy;
        window.closeWowup_copy = closeWowup_copy;
        window.loadFromFirebase_copy = loadFromFirebase_copy;
      });
    })();
  </script>

<script type="module">
(async function() {
    console.log("üîî POPUPTHONGBAO: B·∫Øt ƒë·∫ßu...");
    const firebaseConfig = { apiKey: "AIzaSyCaEzd8OMJ553ETba-M_pxWSe2bDX9fh_I", authDomain: "ideco-f82d4.firebaseapp.com", databaseURL: "https://ideco-f82d4-default-rtdb.firebaseio.com", projectId: "ideco-f82d4", storageBucket: "ideco-f82d4.appspot.com", messagingSenderId: "614324382815", appId: "1:614324382815:web:234ed4873b7156d80fffea" };
    let scheduleConfig = null, isInitialized = false, checkInterval = null;
    async function initializePopup() {
        try {
            const { initializeApp } = await import("https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js");
            const { getDatabase, ref, onValue } = await import("https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js");
            const app = initializeApp(firebaseConfig, 'PopupNotificationApp');
            const database = getDatabase(app);
            const scheduleRef = ref(database, 'scheduleConfig');
            onValue(scheduleRef, (snapshot) => {
                scheduleConfig = snapshot.val();
                if (!scheduleConfig) return;
                if (!isInitialized) { isInitialized = true; checkAndShowPopup(); checkInterval = setInterval(checkAndShowPopup, 60000); }
            });
        } catch (error) { console.error("‚ùå POPUPTHONGBAO: L·ªói:", error); }
    }
    function checkAndShowPopup() {
        if (!scheduleConfig) return;
        const now = new Date();
        const currentDay = now.getDay();
        const nowInMinutes = now.getHours() * 60 + now.getMinutes();
        let timesForToday = [];
        if (scheduleConfig.schedule && scheduleConfig.schedule[currentDay]) timesForToday = scheduleConfig.schedule[currentDay] || [];
        else if (scheduleConfig.days && scheduleConfig.days.includes(currentDay)) timesForToday = scheduleConfig.times || [];
        else return;
        if (timesForToday.length === 0) return;
        let foundTime = null;
        for (const timeStr of timesForToday) {
            const [hour, minute] = timeStr.split(':').map(Number);
            const scheduledTime = hour * 60 + minute;
            if (nowInMinutes >= scheduledTime) {
                const tempKey = `popup_${currentDay}_${timeStr}`;
                if (!sessionStorage.getItem(tempKey)) { foundTime = timeStr; break; }
            }
        }
        if (foundTime) {
            const storageKey = `popup_${currentDay}_${foundTime}`;
            if (!sessionStorage.getItem(storageKey)) {
                setTimeout(() => {
                    if (!sessionStorage.getItem(storageKey)) { sessionStorage.setItem(storageKey, 'true'); showSimplePopup(scheduleConfig.message); }
                }, 5000);
            }
        }
    }
    function showSimplePopup(message) {
        const popup = document.createElement('div');
        popup.id = 'simple-popup-notification';
        popup.style.cssText = `position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.7); display: flex; justify-content: center; align-items: center; z-index: 999999; font-family: Arial, sans-serif;`;
        const content = document.createElement('div');
        content.style.cssText = `background: #ffffff; color: #333333; padding: 40px; border-radius: 15px; border: 5px solid #dc3545; width: 1300px; height: 800px; max-width: 95vw; max-height: 95vh; overflow-y: auto; box-shadow: 0 20px 40px rgba(0,0,0,0.3); position: relative;`;
        const messageDiv = document.createElement('div');
        messageDiv.style.cssText = `font-size: 24px; line-height: 1.6; white-space: pre-wrap; text-align: left; font-weight: bold; color: #333333;`;
        const textSpan = document.createElement('span');
        const cursorSpan = document.createElement('span');
        cursorSpan.innerHTML = '&#9608;';
        cursorSpan.style.cssText = 'animation: blink-cursor 1s step-end infinite; margin-left: 2px; color: #555555;';
        messageDiv.appendChild(textSpan);
        messageDiv.appendChild(cursorSpan);
        content.appendChild(messageDiv);
        popup.appendChild(content);
        document.body.appendChild(popup);
        let i = 0;
        const typingInterval = setInterval(() => {
            if (i < message.length) { textSpan.innerHTML += (message.charAt(i) === '\n') ? '<br>' : message.charAt(i); i++; }
            else { clearInterval(typingInterval); cursorSpan.style.display = 'none'; setTimeout(() => { if (document.body.contains(popup)) popup.remove(); }, 4000); }
        }, 50);
    }
    initializePopup();
    const style = document.createElement('style');
    style.textContent = `@keyframes blink-cursor { 50% { opacity: 0; } }`;
    document.head.appendChild(style);
})();
</script>


<!-- Script TH√îNG B√ÅO GIAO VI·ªÜC TU·∫¶N POPUP -->
<script type="module">
(async function() {
    console.log("üîî POPUPTHONGBAO: B·∫Øt ƒë·∫ßu kh·ªüi ch·∫°y...");

    // 1. Config Firebase
    const firebaseConfig = {
        apiKey: "AIzaSyCaEzd8OMJ553ETba-M_pxWSe2bDX9fh_I", 
        authDomain: "ideco-f82d4.firebaseapp.com",
        databaseURL: "https://ideco-f82d4-default-rtdb.firebaseio.com",
        projectId: "ideco-f82d4",
        storageBucket: "ideco-f82d4.appspot.com",
        messagingSenderId: "614324382815",
        appId: "1:614324382815:web:234ed4873b7156d80fffea"
    };

    // Bi·∫øn to√†n c·ª•c
    let scheduleConfig = null;
    let isInitialized = false;
    let checkInterval = null;

    // --- H√ÄM KH·ªûI T·∫†O ƒê∆†N GI·∫¢N ---
    async function initializePopup() {
        try {
            console.log("üîî POPUPTHONGBAO: ƒêang t·∫£i Firebase...");
            
            const { initializeApp } = await import("https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js");
            const { getDatabase, ref, onValue } = await import("https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js");

            const app = initializeApp(firebaseConfig, 'PopupNotificationApp');
            const database = getDatabase(app);
            const scheduleRef = ref(database, 'scheduleConfig');

            // L·∫Øng nghe d·ªØ li·ªáu Firebase
            onValue(scheduleRef, (snapshot) => {
                scheduleConfig = snapshot.val();
                console.log("üîî POPUPTHONGBAO: D·ªØ li·ªáu t·ª´ Firebase:", scheduleConfig);

                if (!scheduleConfig) {
                    console.error("‚ùå POPUPTHONGBAO: KH√îNG c√≥ d·ªØ li·ªáu tr√™n Firebase!");
                    return;
                }

                if (!isInitialized) {
                    isInitialized = true;
                    
                    // --- THAY ƒê·ªîI: Ki·ªÉm tra ngay khi c√≥ d·ªØ li·ªáu (kh√¥ng ch·ªù 12s v√¥ l√Ω) ---
                    console.log("üîî POPUPTHONGBAO: D·ªØ li·ªáu s·∫µn s√†ng, b·∫Øt ƒë·∫ßu quy tr√¨nh ki·ªÉm tra...");
                    
                    // Ki·ªÉm tra l·∫ßn ƒë·∫ßu
                    checkAndShowPopup();

                    // Thi·∫øt l·∫≠p ki·ªÉm tra ƒë·ªãnh k·ª≥ m·ªói 60 gi√¢y
                    checkInterval = setInterval(checkAndShowPopup, 60000);
                }
            });

        } catch (error) {
            console.error("‚ùå POPUPTHONGBAO: L·ªói kh·ªüi t·∫°o:", error);
        }
    }

    // --- H√ÄM KI·ªÇM TRA V√Ä HI·ªÇN TH·ªä (ƒê√É C·∫¨P NH·∫¨T LOGIC) ---
    function checkAndShowPopup() {
        if (!scheduleConfig) return;

        const now = new Date();
        const currentDay = now.getDay(); // 0 = Ch·ªß Nh·∫≠t
        const nowInMinutes = now.getHours() * 60 + now.getMinutes();
        
        console.log(`üîî Check Time: Th·ª© ${currentDay}, ${now.getHours()}:${now.getMinutes()}`);

        let timesForToday = [];

        // L·∫•y danh s√°ch gi·ªù theo c·∫•u h√¨nh
        if (scheduleConfig.schedule && scheduleConfig.schedule[currentDay]) {
            timesForToday = scheduleConfig.schedule[currentDay] || [];
        } else if (scheduleConfig.days && scheduleConfig.days.includes(currentDay)) {
            timesForToday = scheduleConfig.times || [];
        } else {
            return; // Kh√¥ng c√≥ l·ªãch h√¥m nay
        }

        if (timesForToday.length === 0) return;

        let foundTime = null;

        // *** LOGIC QUAN TR·ªåNG M·ªöI: T√åM GI·ªú ƒê√É QUA M√Ä CH∆ØA HI·ªÇN TH·ªä ***
        // Duy·ªát qua c√°c m·ªëc gi·ªù
        for (const timeStr of timesForToday) {
            const [hour, minute] = timeStr.split(':').map(Number);
            const scheduledTime = hour * 60 + minute;
            
            // Ki·ªÉm tra 1: Th·ªùi gian hi·ªán t·∫°i ƒë√£ qua ho·∫∑c b·∫±ng gi·ªù thi·∫øt l·∫≠p ch∆∞a?
            if (nowInMinutes >= scheduledTime) {
                const tempKey = `popup_${currentDay}_${timeStr}`;
                
                // Ki·ªÉm tra 2: Popup n√†y ƒë√£ t·ª´ng hi·ªÉn th·ªã ch∆∞a?
                if (!sessionStorage.getItem(tempKey)) {
                    // N·∫øu ƒê√É qua gi·ªù V√Ä CH∆ØA hi·ªÉn th·ªã -> ƒê√¢y l√† m·ªëc c·∫ßn hi·ªÉn th·ªã
                    foundTime = timeStr;
                    console.log(`üéØ Ph√°t hi·ªán m·ªëc gi·ªù ${foundTime} c·∫ßn th√¥ng b√°o (Ng∆∞·ªùi d√πng v√†o tr·ªÖ)`);
                    break; // Ch·ªâ l·∫•y m·ªëc quan tr·ªçng nh·∫•t/s·ªõm nh·∫•t ch∆∞a xem ƒë·ªÉ hi·ªÉn th·ªã
                }
            }
        }

        // N·∫øu t√¨m th·∫•y m·ªëc gi·ªù h·ª£p l·ªá
        if (foundTime) {
            const storageKey = `popup_${currentDay}_${foundTime}`;
            
            // Logic hi·ªÉn th·ªã tr·ªÖ 5s nh∆∞ y√™u c·∫ßu
            if (!sessionStorage.getItem(storageKey)) {
                console.log(`‚è≥ ƒêang ch·ªù 5 gi√¢y ƒë·ªÉ hi·ªÉn th·ªã popup cho m·ªëc ${foundTime}...`);
                
                // ƒê√°nh d·∫•u t·∫°m ƒë·ªÉ tr√°nh l·∫∑p trong kho·∫£ng ch·ªù 5s (n·∫øu h√†m check ch·∫°y l·∫°i)
                // Nh∆∞ng ·ªü ƒë√¢y ta ƒë·ªÉ sessionStorage set trong timeout ƒë·ªÉ ch·∫Øc ch·∫Øn
                
                setTimeout(() => {
                    // Ki·ªÉm tra l·∫°i l·∫ßn cu·ªëi tr∆∞·ªõc khi hi·ªán
                    if (!sessionStorage.getItem(storageKey)) {
                        console.log(`üöÄ K√çCH HO·∫†T POPUP: ${foundTime}`);
                        sessionStorage.setItem(storageKey, 'true'); // L∆∞u v·∫øt l√† ƒë√£ hi·ªán
                        showSimplePopup(scheduleConfig.message);
                    }
                }, 5000); // 5000ms = 5 gi√¢y
            }
        }
    }

    // --- H√ÄM HI·ªÇN TH·ªä POPUP (GI·ªÆ NGUY√äN) ---
    function showSimplePopup(message) {
        const popup = document.createElement('div');
        popup.id = 'simple-popup-notification';
        popup.style.cssText = `
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            background: rgba(0,0,0,0.7); display: flex; justify-content: center;
            align-items: center; z-index: 999999; font-family: Arial, sans-serif;
        `;

        const content = document.createElement('div');
        content.style.cssText = `
            background: #ffffff; color: #333333; padding: 40px;
            border-radius: 15px; border: 5px solid #dc3545;
            width: 1300px; height: 800px; max-width: 95vw; max-height: 95vh;
            overflow-y: auto; box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            position: relative;
        `;

        const messageDiv = document.createElement('div');
        messageDiv.style.cssText = `
            font-size: 24px; line-height: 1.6; white-space: pre-wrap;
            text-align: left; font-weight: bold; color: #333333;
        `;
        
        const textSpan = document.createElement('span');
        const cursorSpan = document.createElement('span');
        cursorSpan.innerHTML = '&#9608;';
        cursorSpan.style.cssText = 'animation: blink-cursor 1s step-end infinite; margin-left: 2px; color: #555555;';

        messageDiv.appendChild(textSpan);
        messageDiv.appendChild(cursorSpan);
        content.appendChild(messageDiv);
        popup.appendChild(content);
        document.body.appendChild(popup);

        let i = 0;
        const typingSpeed = 50;
        let autoCloseTimer = null;

        const typingInterval = setInterval(() => {
            if (i < message.length) {
                const char = message.charAt(i);
                textSpan.innerHTML += (char === '\n') ? '<br>' : char;
                i++;
            } else {
                clearInterval(typingInterval);
                cursorSpan.style.display = 'none';
                autoCloseTimer = setTimeout(closePopup, 4000);
            }
        }, typingSpeed);

        function closePopup() {
            clearInterval(typingInterval);
            if (autoCloseTimer) clearTimeout(autoCloseTimer);
            if (document.body.contains(popup)) popup.remove();
        }
    }

    // --- KH·ªûI CH·∫†Y ---
    initializePopup();

    // CSS ph·ª• tr·ª£
    const style = document.createElement('style');
    style.textContent = `@keyframes blink-cursor { 50% { opacity: 0; } }`;
    document.head.appendChild(style);

    // Debug tool
    window.popupDebug = {
        clearHistory: () => {
            Object.keys(sessionStorage).forEach(k => k.startsWith('popup_') && sessionStorage.removeItem(k));
            console.log("‚úÖ ƒê√£ x√≥a l·ªãch s·ª≠ popup.");
        },
        testCheck: () => checkAndShowPopup()
    };

})();
</script>

<!-- ƒêO·∫†N ·ª®NG D·ª§NG TH√îNG TIN ·∫¢NH  -->

<style>
  /* CSS ri√™ng cho App Info - ƒê·ªïi t√™n class/id ƒë·ªÉ kh√¥ng ƒë·ª•ng h√†ng */
  #mainIcon_info { 
    position: fixed; 
    top: 65px; 
    left: 370px; /* V·ªã tr√≠ kh√°c v·ªõi n√∫t c≈© ƒë·ªÉ kh√¥ng b·ªã ƒë√® */
    z-index: 1000; 
    cursor: pointer; 
    transition: all 0.3s ease; 
  }
  #mainIcon_info:hover { transform: scale(1.05); box-shadow: 0 6px 28px 0 rgba(59, 130, 246, 0.3); }
  
  .icon-rectangle-info { 
    width: 230px; height: 55px; 
    border-radius: 16px; 
    background-color: orange; /* M√†u kh√°c ƒë·ªÉ d·ªÖ ph√¢n bi·ªát */
    border: 4px solid white; 
    box-shadow: 0 4px 24px 0 rgba(59, 130, 246, 0.25); 
    display: flex; align-items: center; justify-content: center; padding: 0 15px; 
  }
  .icon-text-info { color: white; font-size: 1.325rem; font-weight: bold; text-align: center; width: 100%; }
  
  #wowup_info { z-index: 9999; }
  
  /* C√°c class _info t∆∞∆°ng ·ª©ng */
  .pdf-viewer-container-info { width: 100%; padding: 0; margin: 0; position: relative; background: none; transition: transform 0.2s ease, box-shadow 0.2s ease; }
  .pdf-viewer-container-info.dragging { opacity: 0.5; border: 2px dashed #3b82f6; background-color: #eff6ff; }
  .pdf-page-container-info { margin: 0; box-shadow: none; display: block; width: 100%; padding: 0; }
  .pdf-page-info { max-width: 100% !important; width: 100% !important; height: auto !important; display: block; margin: 0; padding: 0; }
  .file-title-info { margin-bottom: 6px; font-size: 1.1rem; color: #333; align-self: flex-start; padding-left: 12px; cursor: move; user-select: none; }
  .file-title-info:hover { background-color: #dbeafe; }
  
  .delete-modal_info { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); z-index: 10100; justify-content: center; align-items: center; }
  .delete-modal-content_info { background-color: white; padding: 20px; border-radius: 8px; width: 400px; max-width: 90%; }
  .delete-checkbox_info { margin-right: 10px; }
  .delete-file-item_info { display: flex; align-items: center; padding: 8px 0; border-bottom: 1px solid #eee; }
  
  #popup_info_resizable { 
    width: 99vw !important; height: 98vh !important; 
    max-width: 100vw; max-height: 100vh;
    resize: none; box-sizing: border-box; 
  }
  
  .resize-handle-info { position: absolute; width: 20px; height: 20px; right: 0; bottom: 0; cursor: nwse-resize; z-index: 1000; background: transparent; }
  
  .loading-overlay-info { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); z-index: 20200; justify-content: center; align-items: center; color: white; font-size: 1.5rem; flex-direction: column; }
  .spinner-info { border: 5px solid #f3f3f3; border-top: 5px solid #orange; border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite; margin-bottom: 15px; }

  .footer-buttons-info { padding: 8px 4px; height: 60px; }
  .footer-buttons-info .flex-wrap { gap: 6px; }
  .footer-buttons-info button, .footer-buttons-info input { padding: 4px 8px; font-size: 0.875rem; }
  
  #editorArea_info { box-shadow: 0 8px 30px 0 rgba(0,0,0,0.15); border-radius: 10px; }
  #editorArea_info .ql-toolbar { border-radius: 10px 10px 0 0; }
  #editorArea_info .ql-container { border-radius: 0 0 10px 10px; }
  .quill-content-info ol { list-style-type: decimal; margin-left: 2rem; padding-left: 1rem;}
  .quill-content-info ul { list-style-type: disc; margin-left: 2rem; padding-left: 1rem;}
  
  #quillEditorInfo { background-color: white; min-height: 300px; font-size: 16px; line-height: 1.5; }
  #quillEditorInfo .ql-editor { min-height: 300px; }
</style>

<div id="mainIcon_info">
  <div class="icon-rectangle-info">
    <span class="icon-text-info"> QUY ƒê·ªäNH/QUY TR√åNH </span>
  </div>
</div>

<div id="wowup_info" class="hidden fixed top-0 left-0 w-full h-full flex items-center justify-center bg-black bg-opacity-40">
  <div id="popup_info_resizable" class="relative bg-white custom-shadow-copy border-4 border-yellow-500 flex flex-col">
    <div id="contentArea_info" class="flex-1 overflow-y-scroll p-0 scrollbar-copy border-b border-yellow-200" style="max-height: calc(98vh - 80px);"></div>
    
    <div class="footer-buttons-info flex gap-3 items-center justify-center flex-wrap">
      <input type="file" id="pdfInput_info" accept="application/pdf, image/*" multiple class="rounded-full border-0 bg-yellow-600 text-white py-1 px-3" />
      <button id="uploadBtn_info" class="bg-yellow-500 text-white px-3 py-1 rounded shadow hover:bg-yellow-700">Upload</button>
      <button id="editorBtn_info" class="bg-purple-600 text-white px-3 py-1 rounded shadow hover:bg-purple-800">Nh·∫≠p n·ªôi dung</button>
      <button id="saveBtn_info" class="bg-green-600 text-white px-3 py-1 rounded shadow hover:bg-green-800">L∆∞u</button>
      <button id="deleteBtn_info" class="bg-red-600 text-white px-3 py-1 rounded shadow hover:bg-red-800" disabled>X√≥a file</button>
      <button id="closeWowup_info" title="ƒê√≥ng popup" class="bg-gray-200 text-blue-500 px-3 py-1 rounded-full text-xl font-bold shadow hover:bg-gray-400 flex items-center justify-center">√ó</button>
      <button id="markAsReadBtn_info" class="bg-gray-600 text-white px-3 py-1 rounded shadow hover:bg-gray-800 text-sm">ƒê√£ ƒë·ªçc</button>
    </div>

    <div class="resize-handle-info"></div>
    
    <div id="editorArea_info" class="hidden absolute top-0 left-0 w-full h-full bg-white z-20 flex flex-col rounded-lg border border-yellow-400 shadow-lg">
      <input type="text" id="editorFileName_info" class="border rounded px-3 py-2 m-2 text-lg font-semibold" placeholder="Nh·∫≠p t√™n n·ªôi dung (v√≠ d·ª•: TH√îNG B√ÅO M·ªöI)"/>
      <div id="quillToolbarInfo"></div>
      <div id="quillEditorInfo" style="flex:1; min-height:320px;"></div>
      <div class="flex gap-2 justify-end p-2">
        <button id="saveEditorContent_info" class="bg-green-600 text-white px-3 py-1 rounded shadow hover:bg-green-800">L∆∞u n·ªôi dung</button>
        <button id="closeEditor_info" class="bg-gray-400 text-white px-3 py-1 rounded shadow hover:bg-gray-600">ƒê√≥ng</button>
      </div>
    </div>
  </div>
</div>

<div id="deleteModal_info" class="delete-modal_info">
  <div class="delete-modal-content_info">
    <h2 class="text-xl font-bold mb-4">Ch·ªçn file ƒë·ªÉ x√≥a</h2>
    <input type="password" id="deletePasswordInput_info" placeholder="Nh·∫≠p m·∫≠t kh·∫©u ƒë·ªÉ x√≥a" class="border px-3 py-2 rounded w-full mb-4" />
    <div id="fileListToDelete_info" class="mb-4 max-h-60 overflow-y-auto"></div>
    <div class="flex justify-end gap-2">
      <button id="hideDeleteModal_info" class="bg-gray-500 text-white px-4 py-2 rounded shadow hover:bg-gray-700">H·ªßy</button>
      <button id="handleDeleteFiles_info" class="bg-red-600 text-white px-4 py-2 rounded shadow hover:bg-red-800">X√≥a</button>
    </div>
  </div>
</div>

<div id="loadingOverlayInfo" class="loading-overlay-info">
  <div class="spinner-info"></div>
  <span id="loadingTextInfo">ƒêang x·ª≠ l√Ω...</span>
</div>

<script>
  (function() {
    // --- C·∫§U H√åNH CHO APP INFOGRAPHIC (App_Info) ---
    const firebaseConfig_info = {
      apiKey: "AIzaSyCM_gZ1DEOtUwB0Ii-dm-6jIpxydoJU4-E",
      authDomain: "dulieuthuoc-d532e.firebaseapp.com",
      databaseURL: "https://dulieuthuoc-d532e-default-rtdb.firebaseio.com",
      projectId: "dulieuthuoc-d532e",
      storageBucket: "dulieuthuoc-d532e.firebasestorage.app",
      messagingSenderId: "70002622120",
      appId: "1:70002622120:web:9676e1616a0774bae28c9d",
      measurementId: "G-LQ5P054T97"
    };
    
    // Kh·ªüi t·∫°o Firebase v·ªõi t√™n ri√™ng "app_info"
    if (!firebase.apps.some(app => app.name === "app_info")) {
      firebase.initializeApp(firebaseConfig_info, "app_info");
    }
    const db_info = firebase.app("app_info").database();
    
    // L·∫•y c√°c element theo ID m·ªõi (_info)
    const mainIcon_info = document.getElementById('mainIcon_info');
    const wowup_info = document.getElementById('wowup_info');
    const pdfInput_info = document.getElementById('pdfInput_info');
    const uploadBtn_info = document.getElementById('uploadBtn_info');
    const editorBtn_info = document.getElementById('editorBtn_info');
    const saveBtn_info = document.getElementById('saveBtn_info');
    const deleteBtn_info = document.getElementById('deleteBtn_info');
    const contentArea_info = document.getElementById('contentArea_info');
    const editorArea_info = document.getElementById('editorArea_info');
    const editorFileName_info = document.getElementById('editorFileName_info');
    const quillEditorInfo = document.getElementById('quillEditorInfo');
    const loadingOverlayInfo = document.getElementById('loadingOverlayInfo');
    const loadingTextInfo = document.getElementById('loadingTextInfo');
    const deleteModal_info = document.getElementById('deleteModal_info');
    const fileListToDelete_info = document.getElementById('fileListToDelete_info');
    const deletePasswordInput_info = document.getElementById('deletePasswordInput_info');
    const markAsReadBtn_info = document.getElementById('markAsReadBtn_info');
    
    // C√°c n√∫t Close/H·ªßy/L∆∞u trong Editor/Modal
    const closeWowupBtn_info = document.getElementById('closeWowup_info');
    const saveEditorBtn_info = document.getElementById('saveEditorContent_info');
    const closeEditorBtn_info = document.getElementById('closeEditor_info');
    const hideDeleteModalBtn_info = document.getElementById('hideDeleteModal_info');
    const confirmDeleteBtn_info = document.getElementById('handleDeleteFiles_info');

    let allPdfs_info = [];
    let quillInstance_info = null;
    let editingIndex_info = null;
    let dragSrcEl_info = null;

    // --- S·ª± ki·ªán Click (Ch·ªâ m·ªü khi click v√†o icon) ---
    mainIcon_info.onclick = function() {
      wowup_info.classList.remove('hidden');
      loadFromFirebase_info();
    };
    
    closeWowupBtn_info.onclick = closeWowup_info;
    function closeWowup_info() {
      wowup_info.classList.add('hidden');
    }
    
    // N√∫t "ƒê√£ ƒë·ªçc" ch·ªâ ƒë√≥ng popup, kh√¥ng l∆∞u l·ªãch s·ª≠ t·ª± ƒë·ªông n·ªØa
    if (markAsReadBtn_info) {
        markAsReadBtn_info.onclick = function() {
            closeWowup_info();
        };
    }

    function showLoading_info(message) {
      loadingTextInfo.textContent = message || 'ƒêang x·ª≠ l√Ω...';
      loadingOverlayInfo.style.display = 'flex';
    }
    function hideLoading_info() { loadingOverlayInfo.style.display = 'none'; }
    
    // --- LOAD DATA ---
    function loadFromFirebase_info() {
      showLoading_info('ƒêang t·∫£i d·ªØ li·ªáu Info...');
      db_info.ref('pdfData').once('value').then((snapshot) => {
        const data = snapshot.val();
        if (!data) allPdfs_info = [];
        else if (Array.isArray(data)) allPdfs_info = data;
        else allPdfs_info = Object.values(data);
        
        showPdfContent_info(allPdfs_info);
        deleteBtn_info.disabled = allPdfs_info.length === 0;
        saveBtn_info.disabled = allPdfs_info.length === 0;
        hideLoading_info();
      }).catch((error) => {
        alert('L·ªói t·∫£i Firebase Info: ' + error.message);
        hideLoading_info();
      });
    }
    
    async function showPdfContent_info(pdfDataArr) {
      contentArea_info.innerHTML = '';
      if (!pdfDataArr || pdfDataArr.length === 0) {
        contentArea_info.innerHTML = '<div class="p-4 text-gray-500 text-center">Kh√¥ng c√≥ d·ªØ li·ªáu n√†o.</div>';
        return;
      }
      for (let i = 0; i < pdfDataArr.length; i++) {
        const info = pdfDataArr[i];
        const container = document.createElement('div');
        container.className = "pdf-viewer-container-info mb-4 border-b border-gray-200 pb-2";
        container.setAttribute('draggable', 'true');
        container.setAttribute('data-index', i);
        
        container.addEventListener('dragstart', handleDragStart_info);
        container.addEventListener('dragenter', handleDragEnter_info);
        container.addEventListener('dragover', handleDragOver_info);
        container.addEventListener('dragleave', handleDragLeave_info);
        container.addEventListener('drop', handleDrop_info);
        container.addEventListener('dragend', handleDragEnd_info);

        const title = document.createElement('div');
        title.className = "file-title-info font-bold text-yellow-800 bg-yellow-50 p-2 rounded flex justify-between items-center";
        title.innerHTML = `<span><span style="cursor:move; margin-right:5px;">‚ú¢</span> #${i + 1}: ${info.name || 'Kh√¥ng t√™n'}</span>`;
        
        const btnGroup = document.createElement('div');
        if (info.type === 'text') {
           const editBtn = document.createElement('button');
           editBtn.textContent = "S·ª≠a";
           editBtn.className = "ml-2 bg-blue-500 text-white px-2 py-1 rounded shadow hover:bg-blue-700 text-sm";
           editBtn.onclick = function(e) { e.stopPropagation(); editEditorContent_info(i); };
           btnGroup.appendChild(editBtn);
        }
        title.appendChild(btnGroup);
        container.appendChild(title);

        if (info.type === 'text') {
           const contentDiv = document.createElement('div');
           contentDiv.innerHTML = info.html;
           contentDiv.className = "p-3 border rounded bg-yellow-50 mb-3 quill-content-info";
           container.appendChild(contentDiv);
        } 
        else if (info.type === 'image') {
           const imgDiv = document.createElement('div');
           imgDiv.className = "w-full flex justify-center p-2"; 
           const img = document.createElement('img');
           img.src = info.data;
           img.className = "rounded shadow border";
           img.draggable = false;
           img.onload = function() {
              if (this.naturalWidth > this.naturalHeight) {
                  this.style.width = "100%"; this.style.height = "auto";
              } else {
                  this.style.width = "auto"; this.style.maxHeight = "85vh";
              }
           };
           imgDiv.appendChild(img);
           container.appendChild(imgDiv);
        }
        else {
           // PDF
           const pdfContainer = document.createElement('div');
           pdfContainer.className = "pdf-container";
           container.appendChild(pdfContainer);
           await renderPdf_info(info.data, pdfContainer);
        }
        contentArea_info.appendChild(container);
      }
    }

    // --- DRAG DROP ---
    function handleDragStart_info(e) {
       this.style.opacity = '0.4';
       dragSrcEl_info = this;
       e.dataTransfer.effectAllowed = 'move';
       e.dataTransfer.setData('text/html', this.innerHTML);
       this.classList.add('dragging');
    }
    function handleDragOver_info(e) { if (e.preventDefault) e.preventDefault(); e.dataTransfer.dropEffect = 'move'; return false; }
    function handleDragEnter_info(e) { this.classList.add('over'); }
    function handleDragLeave_info(e) { this.classList.remove('over'); }
    function handleDrop_info(e) {
       if (e.stopPropagation) e.stopPropagation();
       if (dragSrcEl_info !== this) {
          let fromIndex = Number(dragSrcEl_info.getAttribute('data-index'));
          let toIndex = Number(this.getAttribute('data-index'));
          const itemToMove = allPdfs_info.splice(fromIndex, 1)[0];
          allPdfs_info.splice(toIndex, 0, itemToMove);
          showPdfContent_info(allPdfs_info);
          saveBtn_info.disabled = false;
       }
       return false;
    }
    function handleDragEnd_info(e) {
       this.style.opacity = '1';
       this.classList.remove('dragging');
       document.querySelectorAll('.pdf-viewer-container-info').forEach(item => item.classList.remove('over'));
    }

    // --- PDF RENDER ---
    async function renderPdf_info(pdfData, container) {
      try {
        let base64 = pdfData;
        if (pdfData.includes(',')) base64 = pdfData.split(',')[1];
        const binaryString = atob(base64);
        const bytes = new Uint8Array(binaryString.length);
        for (let i = 0; i < binaryString.length; i++) bytes[i] = binaryString.charCodeAt(i);
        const pdf = await pdfjsLib.getDocument({data: bytes}).promise;
        for (let j = 1; j <= pdf.numPages; j++) {
           const page = await pdf.getPage(j);
           const parentWidth = container.clientWidth || 800;
           const viewportRaw = page.getViewport({scale:1});
           const scale = parentWidth / viewportRaw.width;
           const viewport = page.getViewport({ scale: scale });
           
           const canvas = document.createElement('canvas');
           canvas.className = "pdf-page-info";
           canvas.width = viewport.width; 
           canvas.height = viewport.height;
           const context = canvas.getContext('2d');
           container.appendChild(canvas);
           await page.render({canvasContext: context, viewport: viewport}).promise;
        }
      } catch (err) { container.innerHTML = "L·ªói PDF: " + err.message; }
    }

    // --- UPLOAD & RESIZE ---
    uploadBtn_info.onclick = handleUpload_info;
    async function handleUpload_info() {
      const files = pdfInput_info.files;
      if (!files.length) { alert("Ch∆∞a ch·ªçn file!"); return; }
      showLoading_info('ƒêang x·ª≠ l√Ω...');
      try {
        for (let i = 0; i < files.length; i++) {
          const file = files[i];
          if (file.type.startsWith('image/')) {
             const imgData = await resizeImage_info(file);
             allPdfs_info.push({ name: file.name, type: 'image', data: imgData });
          } else if (file.type === 'application/pdf') {
             const pdfData = await readFileBase64_info(file);
             allPdfs_info.push({ name: file.name, type: 'pdf', data: pdfData });
          }
        }
        showPdfContent_info(allPdfs_info);
        saveBtn_info.disabled = false;
        deleteBtn_info.disabled = false;
        pdfInput_info.value = "";
      } catch (e) { alert(e.message); } finally { hideLoading_info(); }
    }
    
    function resizeImage_info(file) {
      return new Promise((resolve, reject) => {
         const reader = new FileReader();
         reader.readAsDataURL(file);
         reader.onload = function(e) {
            const img = new Image();
            img.src = e.target.result;
            img.onload = function() {
               const maxWidth = 1920; 
               let w = img.width, h = img.height;
               if (w > maxWidth) { h *= maxWidth / w; w = maxWidth; }
               const cvs = document.createElement('canvas');
               cvs.width = w; cvs.height = h;
               cvs.getContext('2d').drawImage(img,0,0,w,h);
               resolve(cvs.toDataURL('image/jpeg', 0.8));
            };
            img.onerror = reject;
         };
         reader.onerror = reject;
      });
    }
    function readFileBase64_info(file) {
       return new Promise((resolve, reject) => {
          const r = new FileReader();
          r.onload = () => resolve(r.result.split(',')[1]);
          r.onerror = reject;
          r.readAsDataURL(file);
       });
    }

    // --- SAVE ---
    saveBtn_info.onclick = handleSave_info;
    async function handleSave_info() {
       if (!allPdfs_info.length) return;
       showLoading_info('ƒêang l∆∞u Firebase Info...');
       try {
         await db_info.ref('pdfData').set(allPdfs_info);
         alert("L∆∞u th√†nh c√¥ng!");
       } catch (e) { alert(e.message); } finally { hideLoading_info(); }
    }

    // --- DELETE ---
    deleteBtn_info.onclick = showDeleteModal_info;
    function showDeleteModal_info() {
       fileListToDelete_info.innerHTML = '';
       allPdfs_info.forEach((item, idx) => {
          const div = document.createElement('div');
          div.className = 'delete-file-item_info';
          div.innerHTML = `<input type="checkbox" id="del_info_${idx}" class="delete-checkbox_info" checked>
                           <label for="del_info_${idx}">${item.name || 'File '+ (idx+1)}</label>`;
          fileListToDelete_info.appendChild(div);
       });
       deleteModal_info.style.display = 'flex';
    }
    
    hideDeleteModalBtn_info.onclick = function() { deleteModal_info.style.display = 'none'; deletePasswordInput_info.value=''; };
    confirmDeleteBtn_info.onclick = handleDeleteFiles_info;
    
    function handleDeleteFiles_info() {
       if (deletePasswordInput_info.value !== "minhtriet@1973") { alert("Sai m·∫≠t kh·∫©u!"); return; }
       const cbs = document.querySelectorAll('.delete-checkbox_info');
       const keep = [];
       cbs.forEach((cb, i) => { if (!cb.checked) keep.push(allPdfs_info[i]); });
       if (keep.length === allPdfs_info.length) { alert("Ch∆∞a ch·ªçn file x√≥a!"); return; }
       if (!confirm("Ch·∫Øc ch·∫Øn x√≥a?")) return;
       
       showLoading_info("ƒêang x√≥a...");
       db_info.ref('pdfData').set(keep).then(() => {
          loadFromFirebase_info();
          deleteModal_info.style.display = 'none';
          deletePasswordInput_info.value = '';
       }).catch(e => { alert(e.message); hideLoading_info(); });
    }

    // --- EDITOR ---
    editorBtn_info.onclick = showEditor_info;
    function showEditor_info() {
       editorArea_info.classList.remove('hidden');
       if (!quillInstance_info) {
          var Font = Quill.import('formats/font');
          Font.whitelist = ['arial', 'times-new-roman', 'sans-serif', 'serif', 'monospace'];
          Quill.register(Font, true);
          quillInstance_info = new Quill(quillEditorInfo, {
            modules: { toolbar: [[{ 'font': ['arial', 'times-new-roman', 'sans-serif', 'serif', 'monospace'] }, { 'size': [] }], ['bold', 'italic', 'underline', 'strike'], [{ 'color': [] }, { 'background': [] }], [{ 'header': [1, 2, 3, false] }], [{ 'align': [] }], [{ 'list': 'ordered'}, { 'list': 'bullet' }], [{ 'indent': '-1'}, { 'indent': '+1' }], ['clean']] },
            placeholder: 'Nh·∫≠p n·ªôi dung...', theme: 'snow'
          });
       }
       if (editingIndex_info === null) {
          quillInstance_info.setContents([]);
          editorFileName_info.value = '';
       }
    }
    
    closeEditorBtn_info.onclick = function() { editorArea_info.classList.add('hidden'); editingIndex_info = null; };
    
    saveEditorBtn_info.onclick = function() {
       if (!quillInstance_info) return;
       const html = quillInstance_info.root.innerHTML;
       const name = editorFileName_info.value.trim() || 'Th√¥ng b√°o m·ªõi';
       if (!quillInstance_info.getText().trim()) { alert("Ch∆∞a c√≥ n·ªôi dung!"); return; }
       
       if (editingIndex_info !== null) {
          allPdfs_info[editingIndex_info] = { type: 'text', name: name, html: html };
          editingIndex_info = null;
       } else {
          allPdfs_info.push({ type: 'text', name: name, html: html });
       }
       showPdfContent_info(allPdfs_info);
       editorArea_info.classList.add('hidden');
       saveBtn_info.disabled = false;
       deleteBtn_info.disabled = false;
       alert("ƒê√£ l∆∞u t·∫°m. B·∫•m L∆ØU ƒë·ªÉ c·∫≠p nh·∫≠t Firebase.");
    };

    function editEditorContent_info(index) {
       editingIndex_info = index;
       editorArea_info.classList.remove('hidden');
       if (!quillInstance_info) showEditor_info();
       quillInstance_info.root.innerHTML = allPdfs_info[index].html || "";
       editorFileName_info.value = allPdfs_info[index].name || "";
    }

    // --- ƒê√É LO·∫†I B·ªé T√çNH NƒÇNG T·ª∞ ƒê·ªòNG M·ªû POPUP ---
    // (ƒêo·∫°n code ki·ªÉm tra gi·ªù v√† setInterval ƒë√£ ƒë∆∞·ª£c x√≥a ƒë·ªÉ ch·ªâ m·ªü khi click)

  })();
</script>



<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quy ƒê·ªãnh C√¥ng Ty (Full M√†n H√¨nh)</title>
    <style>
        /* Reset box-sizing ƒë·ªÉ t√≠nh to√°n k√≠ch th∆∞·ªõc chu·∫©n x√°c */
        * {
            box-sizing: border-box;
        }

        /* 1. Icon (kh√¥ng thay ƒë·ªïi) */
        #qd_cty_icon {
            position: fixed; 
            top: 65px;
            left: 200px;
            background-color: red;
            color: white;
            border: 2px solid white;
            padding: 10px 15px;
            border-radius: 5px;
            font-weight: bold;
            font-family: Arial, sans-serif;
            cursor: pointer;
            z-index: 9998; 
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            transition: transform 0.2s;
        }

        #qd_cty_icon:hover {
            transform: scale(1.05);
        }

        /* 2. L·ªõp n·ªÅn m·ªù (Backdrop) */
        #qd_cty_modal_backdrop {
            display: none; /* M·∫∑c ƒë·ªãnh ·∫©n */
            position: fixed; 
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6); 
            z-index: 9999; 
        }

        /* 3. N·ªôi dung Popup (Khung tr·∫Øng) - ƒê√É T·ªêI ∆ØU */
        .qd_cty_modal_content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #fff;
            
            /* K√≠ch th∆∞·ªõc popup */
            width: 98vw;  
            height: 97vh; 
            max-width: none; 
            max-height: none; 

            min-width: 400px;
            min-height: 300px;
            
            border-radius: 5px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);

            /* QUAN TR·ªåNG: Flexbox ƒë·ªÉ iframe co gi√£n h·∫øt c·ª° */
            display: flex;
            flex-direction: column;
            
            /* QUAN TR·ªåNG: X√≥a b·ªè m·ªçi l·ªÅ trong c·ªßa khung */
            padding: 0 !important;
            overflow: hidden; 
        }

        /* 4. Thanh ti√™u ƒë·ªÅ (Header) */
        #qd_cty_modal_header {
            height: 40px; 
            line-height: 40px;
            padding: 0 15px;
            background-color: #f1f1f1;
            font-weight: bold;
            font-family: Arial, sans-serif;
            border-bottom: 1px solid #ccc;
            position: relative; 
            flex-shrink: 0; /* Kh√¥ng cho ph√©p header b·ªã co l·∫°i */
            cursor: move; 
            user-select: none;
        }

        /* 5. N√∫t ƒë√≥ng (d·∫•u 'X') */
        .qd_cty_close_button {
            position: absolute;
            top: 0;
            right: 0;
            width: 40px;
            height: 40px;
            font-size: 28px;
            line-height: 40px; 
            text-align: center; 
            cursor: pointer;
            z-index: 10; 
            color: #333;
        }

        .qd_cty_close_button:hover {
            background: #ffdddd;
            color: red;
        }

        /* 6. Iframe - ƒê√É T·ªêI ∆ØU S√ÅT M√âP */
        #qd_cty_iframe {
            border: none;
            width: 100%;
            height: 100%; /* ƒê·∫£m b·∫£o chi·∫øm h·∫øt chi·ªÅu cao c√≤n l·∫°i */
            flex-grow: 1; /* T·ª± ƒë·ªông l·∫•p ƒë·∫ßy kho·∫£ng tr·ªëng c√≤n l·∫°i */
            display: block; /* Lo·∫°i b·ªè kho·∫£ng tr·∫Øng d√≤ng inline */
            margin: 0;
            padding: 0;
        }
    </style>
</head>
<body>

    <div id="qd_cty_icon">
       T·ªîNG QUAN IDECO
    </div>

    <div id="qd_cty_modal_backdrop">
        <div class="qd_cty_modal_content">
            
            <div id="qd_cty_modal_header">
                Quy ƒê·ªãnh C√¥ng Ty
                <span class="qd_cty_close_button">&times;</span>
            </div>
            
            <iframe id="qd_cty_iframe" src="about:blank" 
                    allowfullscreen>
            </iframe>
            
        </div>
    </div>

    <script>
        (function() {
            const iconButton = document.getElementById('qd_cty_icon');
            const modalBackdrop = document.getElementById('qd_cty_modal_backdrop');
            const modalContent = document.querySelector('.qd_cty_modal_content');
            const modalHeader = document.getElementById('qd_cty_modal_header');
            const closeButton = document.querySelector('.qd_cty_close_button');
            const iframe = document.getElementById('qd_cty_iframe');
            
            const websiteUrl = 'https://bo-quy-inh-quy-che-va-ph-iegqhd6.gamma.site/';

            let isDragging = false;
            let offsetX, offsetY;

            function openModal() {
                iframe.src = websiteUrl;
                
                // Reset style khi m·ªü l·∫°i
                modalContent.style.width = '';
                modalContent.style.height = '';
                modalContent.style.top = '50%';
                modalContent.style.left = '50%';
                modalContent.style.transform = 'translate(-50%, -50%)';
                
                modalBackdrop.style.display = 'block';
            }

            function closeModal() {
                modalBackdrop.style.display = 'none';
                iframe.src = 'about:blank';
            }

            // Logic K√©o Th·∫£
            modalHeader.addEventListener('mousedown', function(e) {
                if (e.button !== 0) return;
                if (e.target.closest('.qd_cty_close_button')) return; // Tr√°nh k√©o khi b·∫•m n√∫t ƒë√≥ng

                isDragging = true;

                let rect = modalContent.getBoundingClientRect();
                modalContent.style.transform = ''; 
                modalContent.style.left = rect.left + 'px';
                modalContent.style.top = rect.top + 'px';

                offsetX = e.clientX - rect.left;
                offsetY = e.clientY - rect.top;

                iframe.style.pointerEvents = 'none';
                document.body.style.userSelect = 'none';
            });

            document.addEventListener('mousemove', function(e) {
                if (!isDragging) return;
                let newX = e.clientX - offsetX;
                let newY = e.clientY - offsetY;
                modalContent.style.left = newX + 'px';
                modalContent.style.top = newY + 'px';
            });

            document.addEventListener('mouseup', function(e) {
                if (!isDragging) return;
                isDragging = false;
                iframe.style.pointerEvents = 'auto';
                document.body.style.userSelect = '';
            });

            iconButton.addEventListener('click', openModal);
            closeButton.addEventListener('click', closeModal);
            modalBackdrop.addEventListener('click', function(event) {
                if (event.target === modalBackdrop) {
                    closeModal();
                }
            });

        })(); 
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Th√¥ng B√°o T·ª± ƒê·ªông</title>
  <style>
    .totup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      border: 5px solid red;
      box-shadow: 0 0 30px rgba(0, 0, 0, 0.5);
      padding: 30px;
      font-size: 35px;
      font-weight: bold;
      color: green;
      text-align: center;
      z-index: 9999;
      display: none;
      border-radius: 15px;
    }

    .okBtn {
      margin-top: 20px;
      font-size: 20px;
      padding: 10px 30px;
      background-color: #007BFF;
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
    }
  </style>
</head>
<body>

  <!-- Popup 1 -->
  <div id="totup1" class="totup">
    L·∫¨P CHECKLIST - K·∫æ HO·∫†CH ƒê·ªÇ THEO D√ïI HO√ÄN TH√ÄNH NHI·ªÜM V·ª§ ƒê∆Ø·ª¢C GIAO <br>
	NH·ªö XEM L·∫†I ƒê·ªäNH H∆Ø·ªöNG GIAO VI·ªÜC - TU·∫¶N  ƒê·ªÇ C√ôNG B√ÅM S√ÅT- TR√ÅNH TR√îI VI·ªÜC<br>
   
    <div><button class="okBtn" onclick="hideTotup('totup1')">V√¢ng ·∫°</button></div>
  </div>

  <!-- Popup 2 -->
  <div id="totup2" class="totup">
   C√ÅC EM KINH DOANH: QU·∫¢N L√ù K·∫æ HO·∫†CH PH·∫¢I THEO M·ª§C TI√äU C·ª§ TH·ªÇ V√Ä C√ì T√çNH TH√öC ƒê·∫¶Y CH·ªêT DOANH THU - KH√ÅCH H√ÄNG <br>
   N√™n t·ª± nh·ªß: n·∫øu m√¨nh kh√¥ng g·ªçi t√¨m √≠t nh·∫•t 3 kh√°ch h·∫£ng m·ªõi khai b√°o c√°o giao d·ªãch c√≥ kh·∫£ th√¨ h√¥m n√†y xem nh∆∞ ch∆∞a xong<br>
   N√™n ki·ªÉm tra l·∫°i khai b√°o c√°o giao d·ªãch - qu·∫£n l√Ω kh√°ch h√†ng ƒë·∫∑t h√†ng ƒë·ªÉ b·∫•m ch·ªçn - theo s√°t ƒë∆°n h√†ng x·ª≠ l√Ω cho nhanh  <br>
   
    <br> 
	Qu·∫£n l√Ω k·∫ø ho·∫°ch - b√°m s√°t ƒë·ªãnh h∆∞·ªõng - ƒëi·ªÅu ch·ªânh k·∫ø ho·∫°ch - ki·ªÉm so√°t gi·ªù l√†m vi·ªác hi·ªáu qu·∫£<br>
    <div><button class="okBtn" onclick="hideTotup('totup2')">V√¢ng ·∫°</button></div>
  </div>

  <!-- Popup 3 (M·ªõi th√™m) -->
  <div id="totup3" class="totup">
  B·ªò PH·∫¨N KHO -V·∫¨N : LU√îN KI·ªÇM TRA L·∫†I T·ªíN CU·ªêI K·ª≤ ERP-·ª®NG D·ª§NG CHO CH√çNH X√ÅC <br>
  M·ªñI L√î H√ÄNG NH·∫¨P V·ªÄ PH·∫¢I L·∫¨P BI√äN B·∫¢N NH·∫¨P- IN - L∆ØU ƒê·ªäNH K·ª≤ CH√çNH X√ÅC L√î H·∫†N <br>
  QU·∫¢N L√ù FORM KHAI THEO SOP ƒê·ª¶: PHI·∫æU XU·∫§T NH·∫¨P- ƒê√ìNG - GIAO H√ÄNG N√äN KHAI K·ª∏ <br>
 
    <div><button class="okBtn" onclick="hideTotup('totup3')">V√¢ng ·∫°</button></div>
  </div>

  <!-- Popup 4 (M·ªõi th√™m) -->
  <div id="totup4" class="totup">
 - K·∫ø to√°n : tu√¢n th·ªß khai b√°o ph√°t sinh ch·ª©ng t·ª´ tr√™n MISA -ERP kh·ª£p v√† h·∫°ch to√°n ngay ph√°t sinh<br>
 - Vi·ªác checklist c√¥ng vi·ªác l√† ti√™u chu·∫©n ƒë√°nh gi√° nghi·ªáp v·ª• ho√†n th√†nh c·ªßa m·ªçi nh√¢n vi√™n k·∫ø to√°n trong k·ª≥<br>
 - B√°o c√°o cu·ªëi k·ª≥ k·∫ø to√°n: s·∫Ω ch·ªâ b√°o c√°o ho·∫°t ƒë·ªông nghi·ªáp v·ª• khai- b√°o c√°o tr√™n MISA - xu·∫•t file g·ªüi BGD<br>

    <div><button class="okBtn" onclick="hideTotup('totup4')">V√¢ng ·∫°</button></div>
  </div>

 <script>
  const schedules = [
    {
      hour: 14,
      minute: 00,
      totupId: 'totup3',
      shown: false
    },
    {
      hour: 11,
      minute: 45,
      totupId: 'totup2',
      shown: false
    },
    {
      hour: 16,
      minute: 45,
      totupId: 'totup4',
      shown: false
    },
    {
      hour: 8,
      minute: 50,
      totupId: 'totup1',
      shown: false
    }
  ];

  function checkTotups() {
    const now = new Date();
    schedules.forEach(schedule => {
      if (now.getHours() === schedule.hour && now.getMinutes() === schedule.minute) {
        if (!schedule.shown) {
          document.getElementById(schedule.totupId).style.display = 'block';
          schedule.shown = true;
        }
      } else {
        schedule.shown = false;
      }
    });
  }

  function hideTotup(id) {
    document.getElementById(id).style.display = 'none';
  }

  setInterval(checkTotups, 30000); // Ki·ªÉm tra m·ªói 30 gi√¢y
</script>
   
</body>
</html>

<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Board Pro (ƒê√£ S·ª≠a L·ªói)</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">

    <style>
        /* CSS n√†y s·∫Ω kh√¥ng ·∫£nh h∆∞·ªüng website g·ªëc v√¨ m·ªçi th·ª©
           ƒë·ªÅu n·∫±m b√™n trong #aib-container */

        /* C√†i ƒë·∫∑t font v√† m√†u s·∫Øc ch√≠nh qua CSS Variables */
        #aib-container {
            font-family: 'Inter', Arial, sans-serif;
            
            /* M√†u s·∫Øc ch·ªß ƒë·ªÅ AI */
            --aib-bg-color: #0d0f2b;
            --aib-surface-color: #1a1e4a;
            --aib-primary-color: #00f0ff;
            --aib-text-primary: #ffffff;
            --aib-text-secondary: #a0b3f0;
        }

        /* C·∫ßn thi·∫øt ƒë·ªÉ kh√≥a cu·ªôn trang n·ªÅn khi popup m·ªü */
        body.aib-modal-open {
            overflow: hidden;
        }

        /* --- 1. N√∫t K√≠ch Ho·∫°t (Trigger) --- */
        #aib-container #aib-trigger {
            position: fixed;
            top: 65px;
            right:450px;
            padding: 12px 20px;
            font-size: 16px;
            font-weight: 500;
            color: var(--aib-text-primary);
            background: linear-gradient(145deg, var(--aib-surface-color), #2a2e6a);
            border: 2px solid var(--aib-primary-color);
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 0 15px var(--aib-primary-color), 0 5px 20px rgba(0,0,0,0.4);
            transition: all 0.3s ease;
            z-index: 998;
            font-family: 'Inter', Arial, sans-serif;
        }

        #aib-container #aib-trigger:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 0 25px var(--aib-primary-color), 0 5px 30px rgba(0,0,0,0.5);
        }

        /* --- 2. L·ªõp N·ªÅn M·ªù (Overlay) --- */
        #aib-container #aib-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            z-index: 999;
            
            display: none;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        /* --- 3. Popup (Modal) - G·∫ßn Full M√†n H√¨nh --- */
        #aib-container #aib-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            width: 90vw;
            height: 90vh;
            
            background: radial-gradient(circle, var(--aib-surface-color) 0%, var(--aib-bg-color) 100%);
            border: 1px solid var(--aib-primary-color);
            border-radius: 20px;
            box-shadow: 0 0 40px rgba(0, 240, 255, 0.5);
            
            z-index: 1600;
            color: var(--aib-text-primary);
            
            display: flex;
            flex-direction: column;
            padding: 25px;
            
            opacity: 0;
            visibility: hidden;
            transform: translate(-50%, -50%) scale(0.95);
            transition: opacity 0.3s ease, visibility 0.3s ease, transform 0.3s ease;
        }

        /* Khi active, L·ªöP N·ªÄN M·ªú s·∫Ω hi·ªán ra */
        #aib-container #aib-overlay.aib-active {
            display: block;
            opacity: 1;
        }
        
        /* Khi active, POPUP s·∫Ω hi·ªán ra */
        #aib-container #aib-modal.aib-active {
            opacity: 1;
            visibility: visible;
            transform: translate(-50%, -50%) scale(1);
        }

        /* N√∫t ƒë√≥ng (X) */
        #aib-container #aib-close {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 36px;
            font-weight: bold;
            color: var(--aib-text-secondary);
            cursor: pointer;
            text-decoration: none;
            transition: color 0.2s, transform 0.2s;
        }
        
        #aib-container #aib-close:hover {
            color: var(--aib-primary-color);
            transform: rotate(90deg);
        }

        /* Ti√™u ƒë·ªÅ c·ªßa Popup */
        #aib-container #aib-modal h2 {
            text-align: center;
            font-size: 28px;
            color: var(--aib-text-primary);
            margin: 0;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--aib-primary-color);
            flex-shrink: 0;
        }

        /* --- 4. L∆∞·ªõi ch·ª©a Icon --- */
        #aib-container .aib-grid-wrapper {
            overflow-y: auto; /* Cho ph√©p cu·ªôn n·∫øu kh√¥ng ƒë·ªß ch·ªó */
            flex-grow: 1;
            padding-top: 20px;
        }

        #aib-container .aib-grid {
            display: grid;
            gap: 25px;
            grid-template-columns: repeat(2, 1fr); /* 2 c·ªôt tr√™n mobile */
        }

        /* --- 5. T·ª´ng Icon --- */
        #aib-container .aib-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-decoration: none;
            color: var(--aib-text-secondary);
            background-color: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 15px;
            transition: background-color 0.3s, transform 0.3s;
        }
        
        #aib-container .aib-item:hover {
            background-color: rgba(0, 240, 255, 0.1);
            transform: translateY(-5px);
        }

        #aib-container .aib-icon {
            width: 100px;
            height: 100px;
            border-radius: 50%; 
            margin-bottom: 12px;
            
            border: 2px solid var(--aib-primary-color);
            box-shadow: 
                inset 0 0 10px rgba(0, 240, 255, 0.5),
                0 0 15px rgba(0, 240, 255, 0.5);

            /* === PH·∫¶N S·ª¨A L·ªñI 1 === */
            /* ·∫¢nh m·∫∑c ƒë·ªãnh ƒë√£ b·ªã V√î HI·ªÜU H√ìA ƒë·ªÉ ∆∞u ti√™n ·∫£nh ri√™ng */
            /* background-image: url('https://cdn.imgpile.com/f/vg813er_xl.jpeg'); */
            
            background-size: cover;
            background-position: center;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        #aib-container .aib-item:hover .aib-icon {
            transform: scale(1.1) rotate(5deg);
            box-shadow: 
                inset 0 0 15px rgba(0, 240, 255, 0.7),
                0 0 25px rgba(0, 240, 255, 8);
        }

        /* === PH·∫¶N S·ª¨A L·ªñI 2 === */
        /* Kh·ªëi code n√†y ƒë√£ ƒë∆∞·ª£c K√çCH HO·∫†T (x√≥a b·ªè /* b·ªã l·ªói) */
        #aib-container .aib-icon-1 { background-image: url('https://cdn.imgpile.com/f/1UiGSHo_xl.jpg'); }
        #aib-container .aib-icon-2 { background-image: url('https://cdn.imgpile.com/f/Mp1aYLX_xl.jpg'); }
        #aib-container .aib-icon-3 { background-image: url('https://cdn.imgpile.com/f/6CauYxv_xl.jpg'); }
        #aib-container .aib-icon-4 { background-image: url('https://cdn.imgpile.com/f/PSAD1X9_xl.jpg'); }
        #aib-container .aib-icon-5 { background-image: url('https://cdn.imgpile.com/f/9xD5hF3_xl.jpg'); }
        #aib-container .aib-icon-6 { background-image: url('https://cdn.imgpile.com/f/ff6aL6c_xl.jpg'); }
        #aib-container .aib-icon-7 { background-image: url('https://cdn.imgpile.com/f/gdbuIQP_xl.jpg'); }
        #aib-container .aib-icon-8 { background-image: url('https://cdn.imgpile.com/f/T0AxrIH_xl.jpg'); }
        #aib-container .aib-icon-9 { background-image: url('https://cdn.imgpile.com/f/gyRxseP_xl.jpg'); }
        #aib-container .aib-icon-10 { background-image: url('https://cdn.imgpile.com/f/mAU1ZD6_xl.jpg'); }
		#aib-container .aib-icon-11 { background-image: url('https://cdn.imgpile.com/f/mAU1ZD6_xl.jpg'); }
		 #aib-container .aib-icon-12 { background-image: url('https://cdn.imgpile.com/f/mAU1ZD6_xl.jpg'); }
		 #aib-container .aib-icon-13 { background-image: url('https://cdn.imgpile.com/f/mAU1ZD6_xl.jpg'); }
        #aib-container .aib-icon-14 { background-image: url('https://cdn.imgpile.com/f/4sPHL4H_xl.jpg'); }
		#aib-container .aib-icon-15 { background-image: url('https://cdn.imgpile.com/f/mAU1ZD6_xl.jpg'); }
	 #aib-container .aib-icon-16 { background-image: url('https://cdn.imgpile.com/f/mAU1ZD6_xl.jpg'); }
	  #aib-container .aib-icon-17 { background-image: url('https://cdn.imgpile.com/f/mAU1ZD6_xl.jpg'); }
	   #aib-container .aib-icon-18 { background-image: url('https://cdn.imgpile.com/f/mAU1ZD6_xl.jpg'); }
	  #aib-container .aib-icon-19 { background-image: url('https://cdn.imgpile.com/f/mAU1ZD6_xl.jpg'); }

	/* === H·∫æT PH·∫¶N S·ª¨A L·ªñI === */


        #aib-container .aib-title {
            font-size: 16px;
            font-weight: 500;
            text-align: center;
            color: var(--aib-text-primary);
        }
        
        /* --- Responsive cho Desktop --- */
        @media (min-width: 768px) {
            #aib-container .aib-grid {
                grid-template-columns: repeat(4, 1fr); /* 4 c·ªôt */
            }
            
            #aib-container #aib-modal h2 {
                font-size: 32px;
            }
        }

    </style>
</head>
<body>

    <div id="aib-container">

        <button id="aib-trigger">üöÄ M·ªü AI Board</button>

        <div id="aib-overlay"></div>

        <div id="aib-modal">
            <a href="#" id="aib-close">&times;</a>
            <h2>H·ªÜ TH·ªêNG IDECO AI - ƒêƒÇNG NH·∫¨P: baocaoideco@gmail.com</h2>
            
            <div class="aib-grid-wrapper">
                
                <div class="aib-grid">
                    
                    <a href="https://aistudio.google.com/apps/drive/1jOh3bvGXViUSx8lLEw9lDuGCuogH7om1?showPreview=true&showAssistant=true" target="_blank" class="aib-item">
                        <div class="aib-icon aib-icon-1"></div> 
                        <span class="aib-title">1.B·ªò PH·∫¨N PH√ÅP L√ù C√îNG TY </span>
                    </a>
                    <a href="https://tracuuthuoc.netlify.app/" target="_blank" class="aib-item">
                        <div class="aib-icon aib-icon-2"></div>
                        <span class="aib-title">2.TRA C·ª®U TH√îNG TIN THU·ªêC - GI√Å THU·ªêC - GI√Å K√ä KHAI THU·ªêC </span>
                    </a>
					
					<a href="https://phantichdonhangthuoc.netlify.app/" target="_blank" class="aib-item">
                        <div class="aib-icon aib-icon-3"></div>
                        <span class="aib-title">3.PH√ÇN T√çCH T·ªîNG H·ª¢P ƒê∆†N THU·ªêC -D·ª∞ B√ÅO ƒê∆†N - G·ªûI ƒê∆†N ƒê·∫∂T NCC CHO K·∫æ TO√ÅN</span>
                    </a>

				<a href="https://aistudio.google.com/apps/drive/1GLirexPXzFXhfDblEs-cXNS8VF-Jv84a?showPreview=true&showAssistant=true&fullscreenApplet=true" target="_blank" class="aib-item">
                        <div class="aib-icon aib-icon-4"></div>
                        <span class="aib-title">4.PH√ÇN T√çCH T·ªîNG H·ª¢P ƒê∆†N THU·ªêC- D·ª∞ B√ÅO ƒê∆†N -G·ªûI ƒê∆†N ƒê·∫∂T NCC CHO K·∫æ TO√ÅN(B·∫¢N D·ª∞ PH√íNG) </span>
                    </a>

				   <a href="https://kiemtracnt-dathang.netlify.app/" target="_blank" class="aib-item">
                        <div class="aib-icon aib-icon-5"></div>
                        <span class="aib-title">5.KI·ªÇM TRA GI√Å CNT -ƒê·ªÄ XU·∫§T THU·ªêC C·∫¶N MUA </span>
                    </a>
					
                    <a href="https://aistudio.google.com/apps/drive/1shNnk8jYFKkzL-inpvpIKjkP6gc_PvN0?showPreview=true&showAssistant=true&fullscreenApplet=true" target="_blank" class="aib-item">
                        <div class="aib-icon aib-icon-6"></div>
                        <span class="aib-title">6.KI·ªÇM TRA GI√Å CNT- ƒê·ªÄ XU·∫§T  THU·ªêC C·∫¶N MUA ( B·∫¢N D·ª∞ PH√íNG) </span>
                    </a>
                     	
		                     <a href="https://phantichphieu.netlify.app/" target="_blank" class="aib-item">
                        <div class="aib-icon aib-icon-7"></div> 
                        <span class="aib-title">7.PH√ÇN T√çCH PHI·∫æU GIAO THU·ªêC - BI√äN B·∫¢N NH·∫¨N - NH·∫¨P LI·ªÜU KHO FEFO </span>
                    </a>     
                    
					 <a href="https://aistudio.google.com/apps/drive/1fHglOZ1s6mOb0TivIkHPiV8jQVlcurf-?showPreview=true&showAssistant=true&fullscreenApplet=true" target="_blank" class="aib-item">
                        <div class="aib-icon aib-icon-8"></div> 
                        <span class="aib-title">8.PH√ÇN T√çCH PHI·∫æU GIAO THU·ªêC- BI√äN B·∫¢N NH·∫¨N- NH·∫¨P LI·ªÜU KHO FEFO ( B·∫¢N D·ª∞ PH√íNG)  </span>
                    </a>
					  <a href="https://lancuoi.netlify.app" target="_blank" class="aib-item">
                        <div class="aib-icon aib-icon-9"></div> 
                        <span class="aib-title">9.IDECO AI T·ªîNG H·ª¢P ƒê∆†N - PH√ÇN T√çCH XU·∫§T H√ìA ƒê∆†N VAT  MISA</span>
                    </a>
					<a href="https://aistudio.google.com/apps/drive/16fG5pi7OBeO2wYWnr4syfWs0Vv_nh4CH?showAssistant=true&showPreview=true" target="_blank" class="aib-item">
                        <div class="aib-icon aib-icon-11"></div>
                        <span class="aib-title">10.IDECO AI T·ªîNG H·ª¢P ƒê∆†N  - PH√ÇN T√çCH XU·∫§T HD VAT THU·ªêC MISA (B·∫¢N D·ª∞ PH√íNG)</span>
                    </a>
                            
				<a href="https://timnpp.netlify.app/" target="_blank" class="aib-item">
                        <div class="aib-icon aib-icon-11"></div>
                        <span class="aib-title">11. T√åM KI·∫æM KH√ÅCH H√ÄNG ( TRA SƒêT KHI D√ÅN TH√îNG TIN KH ) 01 CHO KINH DOANH</span>
                    </a>
				<a href="https://lockhachhang.netlify.app/" target="_blank" class="aib-item">
                        <div class="aib-icon aib-icon-12"></div>
                        <span class="aib-title">12. T√åM KI·∫æM - L·ªåC KH√ÅCH H√ÄNG  CHO KINH DOANH 02 CHO KINH DOANH</span>
                    </a>
						  <a href="https://ideco-prompt.netlify.app" target="_blank" class="aib-item">
                        <div class="aib-icon aib-icon-13"></div> 
                        <span class="aib-title">13.IDECO AI - T·∫†O PROMPT T·∫†O POSTER </span>
                    </a>
					 <a href="https://aistudio.google.com/apps/drive/1jp1htMUYctILOb5BJ-jwEBMHl37Oje5P?showAssistant=true&resourceKey=&showPreview=true&fullscreenApplet=true" target="_blank" class="aib-item">
                        <div class="aib-icon aib-icon-14"></div> 
                        <span class="aib-title">14.IDECO AI - T·∫†O PROMPT T·∫†O POSTER (B·∫¢N D·ª∞ PH√íNG) </span>
                    </a>	
					 <a href="https://idecoweb.netlify.app/" target="_blank" class="aib-item">
                        <div class="aib-icon aib-icon-15"></div> 
                        <span class="aib-title">15.IDECO AI T·∫†O ·∫¢NH ƒê·∫∏P - T·∫†O VIDEO FREE !</span>
                    </a>		
							
                    <a href="https://aistudio.google.com/apps/drive/1iBckdjf_VCut2LVzFzBfegtF06yJcbFK?showPreview=true&showAssistant=true " target="_blank" class="aib-item">
                        <div class="aib-icon aib-icon-16"></div>
                        <span class="aib-title">16.T·∫†O ·∫¢NH ƒê·∫∏P - THI·∫æT K√ä (B·∫¢N D·ª∞ PH√íNG) </span>
                    </a>
                    
                    <a href="https://trochuyen.netlify.app/" target="_blank" class="aib-item">
                        <div class="aib-icon aib-icon-17"></div>
                        <span class="aib-title">17. T∆Ø V·∫§N TO√ÅN - KHO - B√ÅN H√ÄNG B·ªûI VOICE</span>
                    </a>
                     <a href="https://ketoanideco.netlify.app" target="_blank" class="aib-item">
                        <div class="aib-icon aib-icon-18"></div> 
                        <span class="aib-title">18. IDECO AI NGHI·ªÜP V·ª§ K·∫æ TO√ÅN - T√ÄI CH√çNH</span>
                    </a>
                    

                    <a href="https://idecoaibaogia.netlify.app/" target="_blank" class="aib-item">
                        <div class="aib-icon aib-icon-19"></div> 
                        <span class="aib-title">19 T·∫†O B√ÅO GI√Å RI√äNG B·ªûI AI </span>
                    </a>

                   
									
					
					
					



                </div> </div> </div> </div> <script>
        document.addEventListener('DOMContentLoaded', function() {
            
            const container = document.getElementById('aib-container');
            if (!container) return;

            const triggerButton = document.getElementById('aib-trigger');
            const overlay = document.getElementById('aib-overlay');
            const modal = document.getElementById('aib-modal');
            const closeButton = document.getElementById('aib-close');

            if (!triggerButton || !overlay || !modal || !closeButton) {
                console.error('AI Board: Thi·∫øu m·ªôt s·ªë element HTML quan tr·ªçng.');
                return;
            }

            function openPopup() {
                overlay.classList.add('aib-active');
                modal.classList.add('aib-active');
                document.body.classList.add('aib-modal-open');
            }

            function closePopup(event) {
                if(event) {
                    event.preventDefault();
                }
                overlay.classList.remove('aib-active');
                modal.classList.remove('aib-active');
                document.body.classList.remove('aib-modal-open');
            }

            triggerButton.addEventListener('click', openPopup);
            closeButton.addEventListener('click', closePopup);
            
            overlay.addEventListener('click', function(event) {
                if (event.target === overlay) {
                    closePopup(null);
                }
            });

            document.addEventListener('keydown', function(event) {
                if (event.key === 'Escape' && modal.classList.contains('aib-active')) {
                    closePopup(null);
                }
            });
            
        });
    </script>

</body>
</html>






<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D·ªÆ LI·ªÜU KH√ÅCH H√ÄNG</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 0;
        }
        
        .customer-data-btn {
            position: fixed;
            top: 62px;
            right: 240px;
            width: 160px;
            height: 45px;
            background-color: white;
            border: 2px solid red;
            border-radius: 6px;
            box-shadow: 2px 2px 8px rgba(0, 0, 0, 0.15);
            text-align: center;
            line-height: 45px;
            font-weight: bold;
            font-size: 14px;
            color: #333;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 1000;
        }
        
        .customer-data-btn:hover {
            background-color: #f8f8f8;
            box-shadow: 3px 3px 10px rgba(0, 0, 0, 0.2);
            transform: translateY(-2px);
        }
        
        .jopup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .jopup-content {
            width: 1300px;
            height: 800px;
            background-color: white;
            border: 3px solid red;
            border-radius: 10px;
            box-shadow: 0 0 25px rgba(0, 0, 0, 0.4);
            padding: 15px;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .jopup-close-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 24px;
            cursor: pointer;
            color: #555;
            z-index: 1001;
            background: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid #ddd;
        }
        
        .jopup-close-btn:hover {
            background: #f0f0f0;
        }
        
        .drive-container {
            width: 100%;
            flex-grow: 1;
            border: none;
            margin-top: 10px;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .jopup-title {
            text-align: center;
            color: red;
            margin: 5px 0 15px 0;
            font-size: 18px;
        }
        
        .search-container {
            padding: 10px;
            background: #f5f5f5;
            border-radius: 5px;
            margin-bottom: 10px;
        }
        
        .search-box {
            width: 100%;
            padding: 8px 15px;
            border: 1px solid #ddd;
            border-radius: 20px;
            font-size: 14px;
            outline: none;
        }
        
        .search-box:focus {
            border-color: red;
            box-shadow: 0 0 5px rgba(255, 0, 0, 0.3);
        }
        
        .view-options {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .view-btn {
            padding: 5px 10px;
            background: #f0f0f0;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
        }
        
        .view-btn.active {
            background: red;
            color: white;
            border-color: red;
        }
    </style>
</head>
<body>
    <div class="customer-data-btn" id="customerDataBtn">D·ªØ li·ªáu kh√°ch h√†ng</div>
    
    <div class="jopup-overlay" id="jopupOverlay">
        <div class="jopup-content">
            <span class="jopup-close-btn" id="jopupCloseBtn">&times;</span>
            <h2 class="jopup-title"> N√äN ƒê·∫∂T M·ª§C TI√äU M·ªñI NG√ÄY PH·∫¢I TI·∫æP C·∫¨N √çT NH·∫§T 3 KH M·ªöI - √ÅP D·ª§NG ·ª®NG D·ª§NG PH√ÅT TRI·ªÇN KH√ÅCH H√ÄNG M·ªöI</h2>
            
            <div class="search-container">
                <input type="text" class="search-box" id="searchBox" placeholder="T√¨m ki·∫øm t√™n file...">
                <div class="view-options">
                    <button class="view-btn active" data-view="list">Danh s√°ch</button>
                    <button class="view-btn" data-view="grid">L∆∞·ªõi</button>
                </div>
            </div>
            
            <div class="drive-container">
                <iframe src="https://drive.google.com/embeddedfolderview?id=1DB7wxD1fVSaCbVBRTY4sptZwqEwp7bjU#list" 
                        frameborder="0" 
                        width="100%" 
                        height="100%"
                        allowfullscreen
                        id="driveIframe">
                </iframe>
            </div>
        </div>
    </div>
    
    <script>
        const customerDataBtn = document.getElementById('customerDataBtn');
        const jopupOverlay = document.getElementById('jopupOverlay');
        const jopupCloseBtn = document.getElementById('jopupCloseBtn');
        const searchBox = document.getElementById('searchBox');
        const driveIframe = document.getElementById('driveIframe');
        const viewBtns = document.querySelectorAll('.view-btn');
        
        // M·ªü jopup khi click icon
        customerDataBtn.addEventListener('click', function() {
            jopupOverlay.style.display = 'flex';
            document.body.style.overflow = 'hidden';
        });
        
        // ƒê√≥ng jopup
        function closeJopup() {
            jopupOverlay.style.display = 'none';
            document.body.style.overflow = 'auto';
        }
        
        jopupCloseBtn.addEventListener('click', closeJopup);
        
        jopupOverlay.addEventListener('click', function(e) {
            if (e.target === jopupOverlay) {
                closeJopup();
            }
        });
        
        // ƒê√≥ng b·∫±ng ph√≠m ESC
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && jopupOverlay.style.display === 'flex') {
                closeJopup();
            }
        });
        
        // Chuy·ªÉn ƒë·ªïi ch·∫ø ƒë·ªô xem
        viewBtns.forEach(btn => {
            btn.addEventListener('click', function() {
                viewBtns.forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                
                const viewType = this.getAttribute('data-view');
                const currentSrc = driveIframe.src;
                const newSrc = viewType === 'list' 
                    ? currentSrc.replace(/#grid|#list/, '#list')
                    : currentSrc.replace(/#grid|#list/, '#grid');
                
                driveIframe.src = newSrc;
            });
        });
        
        // T√¨m ki·∫øm (ch·ª©c nƒÉng n√†y y√™u c·∫ßu quy·ªÅn truy c·∫≠p API Google Drive ƒë·ªÉ ho·∫°t ƒë·ªông ƒë·∫ßy ƒë·ªß)
        searchBox.addEventListener('input', function() {
            // Trong th·ª±c t·∫ø, c·∫ßn t√≠ch h·ª£p API Google Drive ƒë·ªÉ t√¨m ki·∫øm ch√≠nh x√°c
            // ƒê√¢y ch·ªâ l√† demo UI
            console.log('T√¨m ki·∫øm:', this.value);
        });
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>C√îNG C·ª§ QU·∫¢N L√ù</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #2c6fd1;
            --primary-dark: #1a56b4;
            --light: #f8fafc;
            --dark: #1e293b;
            --gray: #64748b;
            --light-gray: #e2e8f0;
            --shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --radius: 8px;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f1f5f9;
            color: var(--dark);
            line-height: 1.6;
            min-height: 100vh;
        }
        
        .icon-container {
            position: fixed;
            bottom: 130px;
            right: 20px;
            z-index: 1000;
        }
        
        .icon {
            display: inline-block;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            padding: 12px 18px;
            border: 2px solid white;
            border-radius: var(--radius);
            cursor: pointer;
            font-weight: bold;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
            font-size: 15px;
        }
        
        .icon:hover {
            background: linear-gradient(135deg, var(--primary-dark), #0047ab);
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }
        
        .dropdown-content {
            display: none;
            position: absolute;
            right: 0;
            bottom: 100%;
            background-color: white;
            min-width: 450px; /* TƒÉng chi·ªÅu r·ªông */
            max-height: 500px; /* TƒÉng chi·ªÅu cao t·ªëi ƒëa */
            overflow-y: auto;
            box-shadow: var(--shadow);
            z-index: 1;
            border-radius: var(--radius);
            margin-bottom: 15px;
            padding: 15px 0; /* Th√™m padding cho ƒë·∫πp h∆°n */
        }
        
        .dropdown-content a {
            display: flex;
            align-items: center;
            color: #333;
            padding: 16px 22px; /* TƒÉng padding cho d·ªÖ nh√¨n */
            text-decoration: none;
            border-bottom: 1px solid var(--light-gray);
            transition: all 0.3s;
            font-size: 15px; /* TƒÉng k√≠ch th∆∞·ªõc ch·ªØ */
        }
        
        .dropdown-content a:hover {
            background-color: #f0f7ff;
            padding-left: 28px; /* TƒÉng kho·∫£ng c√°ch khi hover */
        }
        
        .dropdown-content a i {
            margin-right: 15px; /* TƒÉng kho·∫£ng c√°ch icon */
            color: var(--primary);
            font-size: 18px; /* TƒÉng k√≠ch th∆∞·ªõc icon */
            width: 24px; /* TƒÉng chi·ªÅu r·ªông icon */
            text-align: center;
        }
        
        .dropdown-content a:last-child {
            border-bottom: none;
        }
        
        .show {
            display: block;
            animation: fadeIn 0.3s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* ·∫®n th√¥ng b√°o */
        .notification {
            display: none;
        }
        
        @media (max-width: 600px) {
            .icon-container {
                bottom: 100px;
                right: 15px;
            }
            
            .dropdown-content {
                min-width: 320px; /* TƒÉng chi·ªÅu r·ªông cho mobile */
                right: -10px;
            }
            
            .icon {
                padding: 10px 15px;
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <div class="icon-container">
        <div class="icon" onclick="toggleDropdown()">
            <i class="fas fa-link"></i>C√îNG C·ª§ QU·∫¢N L√ù
        </div>
        <div id="dropdown" class="dropdown-content">
            <a href="https://congtyideco.github.io/ketoanchecklist" target="_blank">
                <i class="fas fa-newspaper"></i>
                <span>1. CHECKLIST C√îNG VI·ªÜC K·∫æ TO√ÅN TRONG K·ª≤</span>
            </a>
            <a href="https://congtyideco.github.io/kdchecklist" target="_blank">
                <i class="fas fa-newspaper"></i>
                <span>2. CHECKLIST C√îNG VI·ªÜC KINH DOANH TRONG K·ª≤</span>
            </a>
            <a href="https://congtyideco.github.io/khovanchecklist" target="_blank">
                <i class="fas fa-newspaper"></i>
                <span>3. CHECKLIST C√îNG VI·ªÜC KHO - GIAO NH·∫¨N - SOP</span>
            </a>
             <a href="https://congtyideco.github.io/xemdmp/" target="_blank">
                <i class="fas fa-desktop"></i>
                <span>4. TRA C·ª®U GI√Å D∆Ø·ª¢C M·ª∏ PH·∫®M UVS -B√ÅO GI√Å GI√Å</span>
            </a>
			<a href="https://congtyideco.github.io/xemthuoc/" target="_blank">
                <i class="fas fa-desktop"></i>
                <span>5 TRA C·ª®U THU·ªêC - T·∫†O B√ÅO GI√Å</span>
            </a>
            <a href="https://congtyideco.github.io/banggia/" target="_blank">
                <i class="fas fa-desktop"></i>
                <span>6. B√ÅO GI√Å ƒêI·ªÜN T·ª¨ THU·ªêC- G·ªûI CHO KH√ÅCH H√ÄNG QUA POSTER</span>
            </a>
  <a href="https://congtyideco.github.io/quanlydathang/" target="_blank">
                <i class="fas fa-desktop"></i>
                <span>7.QU·∫¢N L√ù KH√ÅCH H√ÄNG ƒê·∫∂T H√ÄNG - THEO D√ïI S√ÅT ( KINH DOANH)</span>
            </a>


		   <a href="https://congtyideco.github.io/kiemtracongno/" target="_blank">
                <i class="fas fa-desktop"></i>
                <span>8. B·∫¢NG B√ÅO N·ª¢ QU√Å H·∫†N CHU·ªñI NT KI·ªÇM TRA ( KINH DOANH)</span>
            </a>
            <a href="https://congtyideco.github.io/kiemtragiaCNT/" target="_blank">
                <i class="fas fa-desktop"></i>
                <span>9. KI·ªÇM TRA SOI CHI·∫æU GI√Å CHU·ªñI NT ƒê·ªÇ L√äN ƒê∆†N (KINH DOANH)</span>
            </a>
           
            <a href="https://congtyideco.github.io/quanlyphieunhapthuoc/" target="_blank">
                <i class="fas fa-newspaper"></i>
                <span>10. PH√ÇN T√çCH PHI·∫æU H√ÄNG THU·ªêC- L·∫¨P BI√äN B·∫¢NG NH·∫¨N H√ÄNG 2 IN 1 SOP)</span>
            </a>
			<a href="https://congtyideco.github.io/quanlykhofefo/" target="_blank">
                <i class="fas fa-newspaper"></i>
                <span>11. QU·∫¢N L√ù XU·∫§T - NH·∫¨P KHO FEFO (BETA)</span>
            </a>
			
			<a href="https://congtyideco.github.io/giaonhan" target="_blank">
                <i class="fas fa-truck-loading"></i>
                <span>12. QU·∫¢N L√ù ƒê√ìNG H√ÄNG- GIAO H√ÄNG TRONG K·ª≤(KHO -GIAO NH·∫¨N)</span>
            </a>
            <a href="https://congtyideco.github.io/khuyenmai" target="_blank">
                <i class="fas fa-desktop"></i>
                <span>13. TRA C·ª®U CH∆Ø∆†NG TR√åNH KHUY·∫æN M·∫†I</span>
            </a>
            <a href="https://congtyideco.github.io/truhangmuaCNT-KH" target="_blank">
                <i class="fas fa-truck-loading"></i>
                <span>14. D·ª∞ TR√ô ƒê∆†N MUA THU·ªêC TR·ªÆ CNT-KH</span>
            </a>
            <a href="https://congtyideco.github.io/baocaokpi-kd/" target="_blank">
                <i class="fas fa-desktop"></i>
                <span>15. PH√ÇN T√çCH CU·ªêI TH√ÅNG - KPI -B√ÅO C√ÅO KPI</span>
            </a>
            <a href="https://congtyideco.github.io/phantichDSKHkynaykytruoc/" target="_blank">
                <i class="fas fa-desktop"></i>
                <span>16. XEM PH√ÇN T√çCH DS KH K·ª≤ N√ÄY vs K·ª≤ TR∆Ø·ªöC</span>
            </a>
            <a href="https://congtyideco.github.io/dubaophantichAI/" target="_blank">
                <i class="fas fa-desktop"></i>
                <span>17 D·ª∞ B√ÅO S·∫¢N L∆Ø·ª¢NG B·ªûI AI</span>
            </a>
            <a href="https://duocphamideco.github.io/quantribanggia" target="_blank">
                <i class="fas fa-desktop"></i>
                <span>18. QU·∫¢N TR·ªä ·∫¢NH THU·ªêC L√äN WEBSITE</span>
            </a>
            <a href="https://congtyideco.github.io/tachanh/" target="_blank">
                <i class="fas fa-desktop"></i>
                <span>19. T√ÅCH ·∫¢NH SP THEO KHU√îN KH·ªî CH·ªåN CHUY√äN NGHI·ªÜP</span>
            </a>
            <a href="https://congtyideco.github.io/baogiaanhchuyennghiep/" target="_blank">
                <i class="fas fa-desktop"></i>
                <span>10. L√ÄM B√ÅO GI√Å B·∫∞NG ·∫¢NH CHUY√äN NGHI·ªÜP - IDECO</span>
            </a>
            <a href="https://congtyideco.github.io/giavonthuoc" target="_blank">
                <i class="fas fa-desktop"></i>
                <span>21. TRA C·ª®U GI√Å V√îN THU·ªêC - BGD- K·∫æ TO√ÅN</span>
            </a>
        </div>
    </div>

    <script>
        function toggleDropdown() {
            document.getElementById("dropdown").classList.toggle("show");
        }
        
        // ƒê√≥ng dropdown khi click b√™n ngo√†i
        window.onclick = function(event) {
            if (!event.target.matches('.icon') && !event.target.matches('.icon *')) {
                var dropdown = document.getElementById("dropdown");
                if (dropdown.classList.contains('show')) {
                    dropdown.classList.remove('show');
                }
            }
        }
    </script>
</body>
</html>



<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>IDECO BOT</title>
  <style>
    :root {
      --green: #16a34a;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, "Helvetica Neue", Helvetica, "Apple Color Emoji", "Segoe UI Emoji";
      background: #fff;
      color: #111;
    }
    .chat-icon {
      position: fixed;
      /* ƒê·∫∑t ·ªü g√≥c d∆∞·ªõi b√™n ph·∫£i ƒë·ªÉ tr√°nh tr√πng v·ªõi popup (n·∫øu popup kh√¥ng qu√° l·ªõn) */
      bottom: 0.4cm;
      left: 1.6cm;
      color: #fff;
      background: var(--green);
      padding: 10px 20px;
      border-radius: 15px;
      font-size: 16px;
      font-weight: 700;
      cursor: pointer;
      z-index: 1100;
      border: 2px solid #fff;
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.5);
      user-select: none;
    }
    .popup {
      display: none;
      position: fixed;
      top: 50%; /* CƒÉn gi·ªØa */
      left: 50%; /* CƒÉn gi·ªØa */
      transform: translate(-50%, -50%); /* D·ªãch chuy·ªÉn ƒë·ªÉ cƒÉn gi·ªØa ho√†n h·∫£o */
      width: 85vw; /* 85% chi·ªÅu r·ªông m√†n h√¨nh */
      height: 85vh; /* 85% chi·ªÅu cao m√†n h√¨nh */
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 8px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.4); /* Shadow n·ªïi b·∫≠t h∆°n */
      z-index: 1800;
      /* ƒê√£ lo·∫°i b·ªè resize: both; v√¨ y√™u c·∫ßu 85%, nh∆∞ng c√≥ th·ªÉ th√™m l·∫°i n·∫øu mu·ªën */
      overflow: hidden; 
    }
    .popup iframe {
      width: 100%;
      height: 100%;
      border: 0;
      /* Th√™m allow cho ƒë√≠nh k√®m nh∆∞ y√™u c·∫ßu tr∆∞·ªõc */
    }
    .overlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.5);
      z-index: 1100;
    }
    /* ƒê·∫£m b·∫£o v·∫´n ho·∫°t ƒë·ªông t·ªët tr√™n thi·∫øt b·ªã di ƒë·ªông */
    @media (max-width: 768px) {
      .popup {
        width: 95vw; /* V·∫´n l·ªõn h∆°n tr√™n di ƒë·ªông */
        height: 90vh;
      }
      .chat-icon { 
        right: 16px; 
        left: auto;
      }
    }
  </style>
</head>
<body>
  <div id="chat-icon-2" class="chat-icon" role="button" aria-controls="popup-2" aria-expanded="false" aria-label="M·ªü IDECO BOT"> H·ªéI T√îI NH√â</div>
  <div id="popup-2" class="popup" role="dialog" aria-modal="true" aria-label="C·ª≠a s·ªï IDECO BOT">
    <iframe src="https://bots.easy-peasy.ai/bot/963fe505-9199-43b5-bcb4-a5d2edc6ca52" title="IDECO BOT" allow="camera; microphone; display-capture; file-system; geolocation"></iframe>
  </div>
  <div id="overlay-2" class="overlay" aria-hidden="true"></div>

  <script>
    (function () {
      const chatIcon2 = document.getElementById('chat-icon-2');
      const popup2 = document.getElementById('popup-2');
      const overlay2 = document.getElementById('overlay-2');

      function toggle(open) {
        // X√°c ƒë·ªãnh tr·∫°ng th√°i m·ªü m·ªõi
        const isOpen = open ?? popup2.style.display !== 'block';
        
        // C·∫≠p nh·∫≠t hi·ªÉn th·ªã
        popup2.style.display = isOpen ? 'block' : 'none';
        overlay2.style.display = isOpen ? 'block' : 'none';
        
        // C·∫≠p nh·∫≠t thu·ªôc t√≠nh Accessibility
        chatIcon2.setAttribute('aria-expanded', String(isOpen));
        overlay2.setAttribute('aria-hidden', String(!isOpen));
        
        // Th√™m/lo·∫°i b·ªè class ƒë·ªÉ ngƒÉn cu·ªôn trang ch√≠nh khi popup m·ªü
        document.body.classList.toggle('popup-open', isOpen);
      }

      // X·ª≠ l√Ω s·ª± ki·ªán
      chatIcon2.addEventListener('click', () => toggle());
      
      // N√∫t t·∫Øt popup: Nh·∫•p v√†o overlay (v√πng x√°m b√™n ngo√†i)
      overlay2.addEventListener('click', () => toggle(false)); 
      
      // N√∫t t·∫Øt popup: Nh·∫•n ph√≠m Escape
      window.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && popup2.style.display === 'block') toggle(false);
      });
      
      // Th√™m style ngƒÉn cu·ªôn trang v√†o head
      const style = document.createElement('style');
      style.textContent = '.popup-open { overflow: hidden !important; }';
      document.head.append(style);
    })();
  </script>
</body>
</html>



<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LINK KPI</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --lm-primary: #3b82f6;
            --lm-primary-dark: #2563eb;
            --lm-light: #f8fafc;
            --lm-dark: #1e293b;
            --lm-gray: #64748b;
            --lm-light-gray: #e2e8f0;
            --lm-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --lm-radius: 8px;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f1f5f9;
            color: var(--lm-dark);
            line-height: 1.6;
            min-height: 100vh;
        }
        
        .lm-icon-container {
            position: fixed;
            top: 65px;
            left: 750px;
            z-index: 1000;
        }
        
        .lm-icon {
            display: inline-block;
            background: linear-gradient(135deg, var(--lm-primary), var(--lm-primary-dark));
            color: white;
            padding: 12px 18px;
            border: 2px solid white;
            border-radius: var(--lm-radius);
            cursor: pointer;
            font-weight: bold;
            box-shadow: var(--lm-shadow);
            transition: all 0.3s ease;
            font-size: 15px;
        }
        
        .lm-icon:hover {
            background: linear-gradient(135deg, var(--lm-primary-dark), #1d4ed8);
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }
        
        .lm-dropdown-content {
            display: none;
            position: absolute;
            left: 0;
            top: 100%;
            background-color: white;
            min-width: 320px;
            max-height: 400px;
            overflow-y: auto;
            box-shadow: var(--lm-shadow);
            z-index: 1;
            border-radius: var(--lm-radius);
            margin-top: 10px;
        }
        
        .lm-dropdown-content a {
            display: flex;
            align-items: center;
            color: #333;
            padding: 14px 18px;
            text-decoration: none;
            border-bottom: 1px solid var(--lm-light-gray);
            transition: all 0.3s;
        }
        
        .lm-dropdown-content a:hover {
            background-color: #f0f7ff;
            padding-left: 22px;
        }
        
        .lm-dropdown-content a i {
            margin-right: 12px;
            color: var(--lm-primary);
            font-size: 16px;
            width: 20px;
            text-align: center;
        }
        
        .lm-dropdown-content a:last-child {
            border-bottom: none;
        }
        
        .lm-show {
            display: block;
            animation: lm-fadeIn 0.3s;
        }
        
        @keyframes lm-fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* ·∫®n th√¥ng b√°o */
        .lm-notification {
            display: none;
        }
        
        @media (max-width: 1200px) {
            .lm-icon-container {
                left: 50%;
                transform: translateX(-50%);
            }
        }
        
        @media (max-width: 600px) {
            .lm-icon-container {
                top: 50px;
                left: 50%;
                transform: translateX(-50%);
            }
            
            .lm-dropdown-content {
                min-width: 280px;
                left: 50%;
                transform: translateX(-50%);
            }
            
            .lm-icon {
                padding: 10px 15px;
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <div class="lm-icon-container">
        <div class="lm-icon" onclick="lmToggleDropdown()">
            <i class="fas fa-link"></i> H·ªÜ TH·ªêNG KPI  
        </div>
        <div id="lm-dropdown" class="lm-dropdown-content">
           			
            <a href="https://idecopharma.github.io/ketoanth/" target="_blank">
                <i class="fas fa-comments"></i>
                <span>KPI QU·∫¢N L√ù K·∫æ TO√ÅN- KHO V·∫¨N</span>
            </a>
            <a href="https://idecopharma.github.io/kpiketoan01/" target="_blank">
                <i class="fas fa-truck-loading"></i>
                <span>KPI K·∫æ TO√ÅN B√ÅN H√ÄNG- K·∫æ TO√ÅN MUA- K·∫æ T√ìAn KHO</span>
            </a>
            <a href="https://idecopharma.github.io/kpiKhovan" target="_blank">
                <i class="fas fa-desktop"></i>
                <span>KPI QU·∫¢N L√ù KHO V·∫¨N</span>
            </a>
           <a href="https://idecopharma.github.io/kpitroly01" target="_blank">
                <i class="fas fa-desktop"></i>
                <span>KPI PH·ª§ TR√ÅCH KHO </span>
            </a>


		  <a href="https://idecopharma.github.io/kpihuong" target="_blank">
                <i class="fas fa-desktop"></i>
                <span>KPI QU·∫¢N L√ù KINH DOANH </span>
            </a>
		    <a href="https://idecopharma.github.io/kpikd01" target="_blank">
                <i class="fas fa-newspaper"></i>
                <span>KPI PH·ª§ TR√ÅCH KINH DOANH-</span>
            </a>
		   
        </div>
    </div>

    <script>
        function lmToggleDropdown() {
            document.getElementById("lm-dropdown").classList.toggle("lm-show");
        }
        
        // ƒê√≥ng dropdown khi click b√™n ngo√†i
        window.onclick = function(event) {
            if (!event.target.matches('.lm-icon') && !event.target.matches('.lm-icon *')) {
                var dropdown = document.getElementById("lm-dropdown");
                if (dropdown.classList.contains('lm-show')) {
                    dropdown.classList.remove('lm-show');
                }
            }
        }
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>XEM GI√Å THU G·ªåN </title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        /* CSS CHO B·ªò KHUNG WIDGET */
        #xgt-widget-trigger {
            position: fixed; bottom: 20px; right: 20px; width: 120px; height: 50px;
            background-color: #4285f4; color: white; border-radius: 8px; border: none;
            font-size: 16px; font-weight: bold; cursor: pointer; box-shadow: 0 5px 15px rgba(0,0,0,0.25);
            z-index: 99998; transition: all 0.3s ease; display: flex; justify-content: center; align-items: center;
        }
        #xgt-widget-trigger:hover { background-color: #3367d6; transform: scale(1.05); }

        #xgt-popup-container {
            display: none; 
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 1250px; height: 800px; max-width: 95vw; max-height: 90vh; min-width: 450px; min-height: 400px;
            background-color: #fff; border-radius: 12px; box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            z-index: 99999; overflow: hidden; font-family: Arial, sans-serif;
            flex-direction: column;
        }

        /* --- B·∫ÆT ƒê·∫¶U CSS SCOPED CHO ·ª®NG D·ª§NG --- */
        #xgt-popup-container .xgt-app-wrapper { width: 100%; height: 100%; display: flex; flex-direction: column; }
        #xgt-popup-container .xgt-popup-header { 
            display:flex; justify-content:space-between; align-items:center; 
            padding: 15px 20px; border-bottom:1px solid #eee; cursor: move;
            background-color: #f7f9fc; flex-shrink: 0;
        }
        #xgt-popup-container .xgt-popup-title { font-size:20px; color:#4285f4; margin:0; user-select: none; }
        #xgt-popup-container .xgt-close-btn { background:none; border:none; font-size:28px; cursor:pointer; color:#666 }

        #xgt-popup-container .xgt-popup-content { 
            padding: 15px 20px 20px 20px; display:flex; flex-direction:column; 
            flex-grow: 1; overflow: hidden;
        }

        #xgt-popup-container .xgt-search-section { display:flex; gap:8px; flex-shrink: 0; margin-bottom: 10px; }
        #xgt-popup-container .xgt-search-input { flex:1; min-width:220px; padding:10px; border:1px solid #ddd; border-radius:4px; font-size:16px }
        #xgt-popup-container .xgt-btn { padding:10px 12px; border:none; border-radius:6px; font-weight:700; cursor:pointer }
        #xgt-popup-container .xgt-btn-filter { background:#8e24aa; color:#fff }
        #xgt-popup-container .xgt-btn-clear { background:#9e9e9e; color:#fff }

        #xgt-popup-container .xgt-controls-panel {
            transition: all 0.3s ease-in-out; overflow: hidden; flex-shrink: 0;
            max-height: 500px; opacity: 1; border: 1px solid #e0e0e0; border-radius: 5px; padding: 10px;
        }
        #xgt-popup-container .xgt-controls-panel.collapsed { max-height: 0; opacity: 0; padding: 0 10px; border: none; }

        #xgt-popup-container .xgt-toggle-bar { text-align: center; border-top: 1px dashed #ddd; padding: 8px 0 0 0; margin-top: 10px; flex-shrink: 0; }
        #xgt-popup-container #xgt-toggle-controls-btn { background: none; border: none; color: #4285f4; cursor: pointer; font-size: 14px; font-weight: bold; }

        #xgt-popup-container .xgt-upload-section { margin-bottom: 10px; }
        #xgt-popup-container .xgt-file-input-container { display:flex; align-items:center; gap:10px }
        #xgt-popup-container .xgt-file-input-label { padding:8px 15px; background:#4285f4; color:#fff; border-radius:4px; cursor:pointer; }
        #xgt-popup-container .xgt-file-input { display:none }
        #xgt-popup-container .xgt-file-name { flex-grow:1; color:#666; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

        #xgt-popup-container .xgt-toolbar { display:flex; flex-direction: column; gap:8px; align-items:flex-start; margin: 10px 0; }
        #xgt-popup-container .xgt-column-list { display:flex; flex-wrap:wrap; gap:8px; max-height:80px; overflow:auto; padding:8px; border:1px dashed #cfe1ff; border-radius:6px; background:#fff; width: 100%; }
        #xgt-popup-container .xgt-column-chip { display:inline-flex; align-items:center; gap:6px; background:#eef4ff; border:1px solid #cfe1ff; border-radius:999px; padding:6px 10px; font-size:13px; user-select: none; }
        #xgt-popup-container .xgt-toolbar-actions { display: flex; gap: 8px; }
        #xgt-popup-container .xgt-toolbar button { padding:8px 12px; border:none; border-radius:6px; cursor:pointer; font-weight:600 }
        #xgt-popup-container .xgt-btn-hide { background:#ff7043; color:#fff } 
        #xgt-popup-container .xgt-btn-unhide { background:#43a047; color:#fff } 
        #xgt-popup-container .xgt-btn-showall { background:#546e7a; color:#fff }

        #xgt-popup-container .xgt-table-container { flex-grow: 1; overflow: auto; margin-top: 10px; border: 1px solid #ddd; border-radius: 4px; }
        /* C·∫¨P NH·∫¨T: Th√™m 'table-layout: fixed' ƒë·ªÉ co gi√£n c·ªôt ho·∫°t ƒë·ªông t·ªët h∆°n */
        #xgt-popup-container .xgt-price-table { width:100%; border-collapse:collapse; table-layout: fixed; }
        #xgt-popup-container .xgt-price-table th, #xgt-popup-container .xgt-price-table td { border:1px solid #ddd; padding:8px; text-align:left; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        #xgt-popup-container .xgt-price-table th { background:#4285f4; color:#fff; position:sticky; top:0; z-index:2 }
        
        /* CSS CHO T√çNH NƒÇNG CO GI√ÉN C·ªòT */
        #xgt-popup-container .xgt-price-table .xgt-th-resizable { position: relative; }
        #xgt-popup-container .xgt-price-table .xgt-col-resizer { position:absolute; right:0; top:0; height:100%; width:5px; cursor:col-resize; z-index: 3;}
        #xgt-popup-container .xgt-price-table .xgt-col-resizer:hover { background: rgba(255,255,255,0.3); }

        /* CSS M·ªöI: D√†nh cho co gi√£n Popup */
        #xgt-popup-container .xgt-popup-resizer {
            position: absolute;
            width: 15px; height: 15px;
            z-index: 100000;
            bottom: 0; right: 0;
            cursor: se-resize;
        }

        #xgt-popup-container .xgt-footer-actions { display:flex; justify-content:flex-end; gap:10px; margin-top:15px; flex-shrink: 0; padding-top: 15px; border-top: 1px solid #eee; }
        #xgt-popup-container .xgt-export-btn:disabled { background-color: #ccc; cursor: not-allowed; }
        
        #xgt-popup-container .xgt-dialog-overlay { display:none; position:absolute; inset:0; background:rgba(0,0,0,.5); z-index:1001; justify-content: center; align-items: center; }
        #xgt-popup-container .xgt-dialog-content { background:#fff; padding:20px; border-radius:8px; box-shadow:0 5px 15px rgba(0,0,0,.3); }
    </style>
</head>
<body>
    <button id="xgt-widget-trigger">Xem Gi√°</button>
    <div id="xgt-popup-container">
        <div class="xgt-app-wrapper">
            <div class="xgt-popup-header" id="xgt-popup-header">
                <h2 class="xgt-popup-title">B·∫£ng Gi√° Thu·ªëc</h2>
                <button class="xgt-close-btn" id="xgt-closePopupBtn">&times;</button>
            </div>
            <div class="xgt-popup-content">
                <div class="xgt-search-section">
                    <input type="text" id="xgt-searchInput" class="xgt-search-input" placeholder="T√¨m ki·∫øm trong b·∫£ng gi√°..." />
                    <button class="xgt-btn xgt-btn-filter" id="xgt-filterSelectedBtn">L·ªçc ƒë√£ ch·ªçn</button>
                    <button class="xgt-btn xgt-btn-clear" id="xgt-clearSelectionBtn">L√†m m·ªõi</button>
                </div>
                <div class="xgt-toggle-bar">
                    <button id="xgt-toggle-controls-btn">Hi·ªán b·∫£ng ƒëi·ªÅu khi·ªÉn</button>
                </div>
                <div id="xgt-controls-panel" class="xgt-controls-panel collapsed">
                    <div class="xgt-upload-section">
                        <div class="xgt-file-input-container">
                            <label for="xgt-excelFileInput" class="xgt-file-input-label">Ch·ªçn file Excel</label>
                            <input type="file" id="xgt-excelFileInput" class="xgt-file-input" accept=".xlsx, .xls" multiple />
                            <span class="xgt-file-name" id="xgt-fileNameDisplay">Ch∆∞a ch·ªçn file</span>
                        </div>
                    </div>
                    <div class="xgt-toolbar" id="xgt-columnToolbar" style="display:none">
                        <div id="xgt-columnList" class="xgt-column-list"></div>
                        <div class="xgt-toolbar-actions">
                             <button class="xgt-btn-hide" id="xgt-btnHide">·∫®n c·ªôt ƒë√£ ch·ªçn</button>
                             <button class="xgt-btn-unhide" id="xgt-btnUnhide">Hi·ªán c·ªôt ƒë√£ ch·ªçn</button>
                             <button class="xgt-btn-showall" id="xgt-btnShowAll">Hi·ªán t·∫•t c·∫£</button>
                        </div>
                    </div>
                    <div id="xgt-filesList" class="xgt-files-list"></div>
                </div>
                <div class="xgt-table-container" id="xgt-tableContainer">
                    </div>
                <div class="xgt-footer-actions">
                    <button class="xgt-btn" id="xgt-addNewRowBtn" style="background: #4caf50;">Th√™m h√†ng</button>
                    <button class="xgt-btn" id="xgt-editRowBtn" style="background: #ffc107;" disabled>S·ª≠a h√†ng</button>
                    <button class="xgt-btn" id="xgt-deleteRowBtn" style="background: #f44336;" disabled>X√≥a h√†ng</button>
                    <button class="xgt-btn" id="xgt-exportBtn" style="background:#1976d2; color:#fff;">Xu·∫•t Excel</button>
                </div>
            </div>
            <div class="xgt-dialog-overlay" id="xgt-passwordDialog">
                 <div class="xgt-dialog-content" style="width: 300px;">
                    <div style="font-size:18px; margin-bottom:15px">Nh·∫≠p password ƒë·ªÉ x√≥a file</div>
                    <input type="password" id="xgt-passwordInput" placeholder="Nh·∫≠p password..." style="width:100%; padding:10px; border:1px solid #ddd; border-radius:4px; font-size:16px" />
                    <div style="display:flex; justify-content:flex-end; gap:10px; margin-top: 15px;">
                        <button class="xgt-btn" id="xgt-passwordDialogCancel" style="background:#f5f5f5">H·ªßy</button>
                        <button class="xgt-btn" id="xgt-passwordDialogConfirm" style="background:#4285f4; color:#fff">X√°c nh·∫≠n</button>
                    </div>
                 </div>
            </div>
        </div>
        <div class="xgt-popup-resizer" id="xgt-popup-resizer-se"></div>
    </div>

<script>
(function() {
    const widgetTrigger = document.getElementById("xgt-widget-trigger");
    const popupContainer = document.getElementById("xgt-popup-container");
    const popupHeader = document.getElementById("xgt-popup-header");
    const closePopupBtn = document.getElementById("xgt-closePopupBtn");
    const controlsPanel = document.getElementById("xgt-controls-panel");
    const toggleControlsBtn = document.getElementById("xgt-toggle-controls-btn");

    let isDataLoaded = false;
    
    widgetTrigger.addEventListener('click', () => {
        const isVisible = popupContainer.style.display === "flex";
        popupContainer.style.display = isVisible ? "none" : "flex";
        if (!isVisible && !isDataLoaded) {
            loadInitialData();
            isDataLoaded = true;
        }
    });

    closePopupBtn.addEventListener("click", () => { popupContainer.style.display = "none"; });

    toggleControlsBtn.addEventListener('click', () => {
        controlsPanel.classList.toggle('collapsed');
        toggleControlsBtn.textContent = controlsPanel.classList.contains('collapsed') ? 'Hi·ªán b·∫£ng ƒëi·ªÅu khi·ªÉn' : '·∫®n b·∫£ng ƒëi·ªÅu khi·ªÉn';
    });

    // K√©o-th·∫£ ƒë·ªÉ di chuy·ªÉn popup
    let isDragging = false, offsetX, offsetY;
    popupHeader.addEventListener('mousedown', (e) => {
        isDragging = true; 
        if (popupContainer.style.transform !== 'none') {
            const rect = popupContainer.getBoundingClientRect();
            popupContainer.style.transform = 'none';
            popupContainer.style.left = `${rect.left}px`;
            popupContainer.style.top = `${rect.top}px`;
        }
        offsetX = e.clientX - popupContainer.offsetLeft;
        offsetY = e.clientY - popupContainer.offsetTop;
        document.addEventListener('mousemove', onMouseMove);
        document.addEventListener('mouseup', onMouseUp);
    });
    function onMouseMove(e) { if (!isDragging) return; popupContainer.style.left = `${e.clientX - offsetX}px`; popupContainer.style.top = `${e.clientY - offsetY}px`; }
    function onMouseUp() { isDragging = false; document.removeEventListener('mousemove', onMouseMove); document.removeEventListener('mouseup', onMouseUp); }

    const firebaseConfig = { 
  apiKey : "AIzaSyDKNLLhisemYQJeCW8QCOwfbvVsvUur-60" , 
  authDomain : "quetbarcode-2361a.firebaseapp.com" , 
  databaseURL : "https://quetbarcode-2361a-default-rtdb.firebaseio.com" , 
  projectId : "quetbarcode-2361a" , 
  storageBucket : "quetbarcode-2361a.firebasestorage.app" , 
  messagingSenderId : "209619008657" , 
  appId : "1:209619008657:web:ee4af6f6ec567a1d745330" , 
  measurementId : "G-2TRYH9DYK5" 
};
    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const database = firebase.database();
    
    let uploadedFiles = [], currentData = [], fileIndexToRemove = null, headersCache = [], columnWidths = {},
        hiddenColumns = new Set(), selectedRowIdx = new Set(), showingOnlySelected = false, 
        rowIndexMap = [], editingRowState = { index: null, originalData: [] };
    const CORRECT_PASSWORD = "minhtriet1973";

    // ... (DOM element selections - kh√¥ng thay ƒë·ªïi) ...
    const excelFileInput = document.getElementById("xgt-excelFileInput"),
          fileNameDisplay = document.getElementById("xgt-fileNameDisplay"),
          filesList = document.getElementById("xgt-filesList"),
          searchInput = document.getElementById("xgt-searchInput"),
          tableContainer = document.getElementById("xgt-tableContainer"),
          passwordDialog = document.getElementById("xgt-passwordDialog"),
          passwordInput = document.getElementById("xgt-passwordInput"),
          passwordDialogCancel = document.getElementById("xgt-passwordDialogCancel"),
          passwordDialogConfirm = document.getElementById("xgt-passwordDialogConfirm"),
          columnToolbar = document.getElementById("xgt-columnToolbar"),
          columnList = document.getElementById("xgt-columnList"),
          btnHide = document.getElementById("xgt-btnHide"),
          btnUnhide = document.getElementById("xgt-btnUnhide"),
          btnShowAll = document.getElementById("xgt-btnShowAll"),
          exportBtn = document.getElementById("xgt-exportBtn"),
          filterSelectedBtn = document.getElementById("xgt-filterSelectedBtn"),
          clearSelectionBtn = document.getElementById("xgt-clearSelectionBtn"),
          addNewRowBtn = document.getElementById("xgt-addNewRowBtn"),
          editRowBtn = document.getElementById("xgt-editRowBtn"),
          deleteRowBtn = document.getElementById("xgt-deleteRowBtn");
          
    // ... (Event listener setup - kh√¥ng thay ƒë·ªïi) ...
    excelFileInput.addEventListener("change", handleFileSelect);
    searchInput.addEventListener("input", () => { showingOnlySelected = false; performSearch(); });
    passwordDialogCancel.addEventListener("click", () => { passwordDialog.style.display = "none"; passwordInput.value = ""; });
    passwordDialogConfirm.addEventListener("click", () => {
        if (passwordInput.value === CORRECT_PASSWORD) {
            if (fileIndexToRemove !== null) removeFile(fileIndexToRemove);
            passwordDialog.style.display = "none"; passwordInput.value = "";
        } else { alert("Password kh√¥ng ƒë√∫ng."); }
    });
    btnHide.addEventListener("click", () => applyColumnSelection("hide"));
    btnUnhide.addEventListener("click", () => applyColumnSelection("unhide"));
    btnShowAll.addEventListener("click", () => { hiddenColumns.clear(); redrawWithFilters(); });
    exportBtn.addEventListener("click", exportCurrentViewToExcel);
    filterSelectedBtn.addEventListener('click', () => { if(selectedRowIdx.size === 0){ alert('Ch∆∞a c√≥ h√†ng n√†o ƒë∆∞·ª£c ch·ªçn.'); return; } showingOnlySelected = true; renderSelectedOnly(); });
    clearSelectionBtn.addEventListener('click', () => { selectedRowIdx.clear(); showingOnlySelected = false; searchInput.value = ''; createTable(currentData); updateActionButtonsState(); });
    addNewRowBtn.addEventListener("click", handleAddNewRow);
    editRowBtn.addEventListener("click", handleEditRow);
    deleteRowBtn.addEventListener("click", handleDeleteRows);

    // ... (C√°c h√†m x·ª≠ l√Ω d·ªØ li·ªáu ch√≠nh - kh√¥ng thay ƒë·ªïi) ...
    function loadInitialData() { loadDataFromFirebase(); }
    function updateActionButtonsState() {
        const hasSelection = selectedRowIdx.size > 0;
        const isSingleSelection = selectedRowIdx.size === 1;
        const isEditing = editingRowState.index !== null;
        addNewRowBtn.disabled = isEditing;
        editRowBtn.disabled = !isSingleSelection || isEditing;
        deleteRowBtn.disabled = !hasSelection || isEditing;
        editRowBtn.textContent = isEditing ? 'L∆∞u' : 'S·ª≠a h√†ng';
        editRowBtn.style.background = isEditing ? '#4caf50' : '#ffc107';
    }
    async function handleAddNewRow() {
        if (headersCache.length === 0) { alert("Vui l√≤ng t·∫£i file Excel ƒë·ªÉ c√≥ c·∫•u tr√∫c c·ªôt."); return; }
        const userFile = uploadedFiles.find(f => f.name === "User Added Data") || { name: "User Added Data", data: [headersCache] };
        if (!uploadedFiles.includes(userFile)) { uploadedFiles.push(userFile); addFileToList(userFile.name, uploadedFiles.length - 1); }
        userFile.data.push(Array(headersCache.length).fill(''));
        await saveDataToFirebase();
        await displayAllData();
        tableContainer.scrollTop = tableContainer.scrollHeight;
        const newRowIndex = currentData.length - 1;
        selectedRowIdx.clear(); selectedRowIdx.add(newRowIndex); handleEditRow();
    }
    function handleEditRow() {
        const cancelEdit = () => {
            const tr = tableContainer.querySelector(`tr[data-row-index='${editingRowState.index}']`);
            if (tr) {
                const cells = tr.querySelectorAll('td');
                const visibleIdx = visibleColumnIndexes();
                visibleIdx.forEach((colIdx, i) => { cells[i].textContent = editingRowState.originalData[colIdx] || ''; });
                cells.forEach(td => { td.contentEditable = 'false'; td.classList.remove('editing-cell'); });
            }
            editingRowState = { index: null, originalData: [] };
            document.getElementById('xgt-cancelEditBtn')?.remove();
            updateActionButtonsState();
        };

        if (editingRowState.index !== null) { // Save changes
            const rowIndex = editingRowState.index;
            const tr = tableContainer.querySelector(`tr[data-row-index='${rowIndex}']`);
            if (!tr) return;
            const cells = tr.querySelectorAll('td');
            const visibleIdx = visibleColumnIndexes();
            let fullNewRow = [...currentData[rowIndex]];
            visibleIdx.forEach((colIdx, i) => { fullNewRow[colIdx] = cells[i].textContent.trim(); });
            const mapping = rowIndexMap[rowIndex];
            if (mapping) {
                uploadedFiles[mapping.fileIndex].data[mapping.rowIndexInFile] = fullNewRow;
                saveDataToFirebase().then(() => {
                    currentData[rowIndex] = fullNewRow;
                    cells.forEach(td => { td.contentEditable = 'false'; td.classList.remove('editing-cell'); });
                    editingRowState = { index: null, originalData: [] };
                    updateActionButtonsState();
                    document.getElementById('xgt-cancelEditBtn')?.remove();
                });
            }
        } else { // Start editing
            if (selectedRowIdx.size !== 1) { alert('Vui l√≤ng ch·ªçn m·ªôt h√†ng ƒë·ªÉ s·ª≠a.'); return; }
            const rowIndex = selectedRowIdx.values().next().value;
            const tr = tableContainer.querySelector(`tr[data-row-index='${rowIndex}']`);
            if (!tr) return;
            editingRowState = { index: rowIndex, originalData: [...currentData[rowIndex]] };
            const cells = tr.querySelectorAll('td');
            cells.forEach((td, i) => { if (i < cells.length - 1) { td.contentEditable = 'true'; td.classList.add('editing-cell'); } });
            cells[0].focus();
            const cancelBtn = document.createElement('button');
            cancelBtn.id = 'xgt-cancelEditBtn';
            cancelBtn.textContent = 'H·ªßy';
            cancelBtn.className = 'xgt-btn';
            cancelBtn.style.background = '#9e9e9e'; cancelBtn.style.color = 'white';
            cancelBtn.onclick = cancelEdit;
            editRowBtn.parentNode.insertBefore(cancelBtn, editRowBtn.nextSibling);
            updateActionButtonsState();
        }
    }
    async function handleDeleteRows() {
        if (selectedRowIdx.size === 0 || !confirm(`B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a ${selectedRowIdx.size} h√†ng ƒë√£ ch·ªçn?`)) return;
        const toDeleteByFile = {};
        selectedRowIdx.forEach(rowIndex => {
            const mapping = rowIndexMap[rowIndex];
            if (mapping) {
                if (!toDeleteByFile[mapping.fileIndex]) toDeleteByFile[mapping.fileIndex] = [];
                toDeleteByFile[mapping.fileIndex].push(mapping.rowIndexInFile);
            }
        });
        for (const fileIndex in toDeleteByFile) {
            toDeleteByFile[fileIndex].sort((a, b) => b - a).forEach(rowIndexInFile => uploadedFiles[fileIndex].data.splice(rowIndexInFile, 1));
        }
        selectedRowIdx.clear();
        await saveDataToFirebase(); await displayAllData(); updateActionButtonsState();
    }
    async function handleFileSelect(event){
        const files = event.target.files; if(!files.length) return;
        tableContainer.innerHTML = `<div class="xgt-loading" style="display: block;"><div class="xgt-spinner"></div></div>`;
        for(let file of files){
            try {
                const data = await readExcelFile(file);
                uploadedFiles.push({ name: file.name, data });
                addFileToList(file.name, uploadedFiles.length - 1);
            } catch(error){ alert(`L·ªói ƒë·ªçc file ${file.name}: ${error.message}`); }
        }
        updateFileNameDisplay(); displayAllData(); saveDataToFirebase();
    }
    function readExcelFile(file){
        return new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.onload = e => {
                try {
                    const workbook = XLSX.read(new Uint8Array(e.target.result), { type: "array" });
                    const worksheet = workbook.Sheets[workbook.SheetNames[0]];
                    let jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, defval: "", raw: false });
                    resolve(jsonData.filter(row => row.some(cell => String(cell).trim() !== '')));
                } catch(error) { reject(error); }
            };
            reader.onerror = error => reject(error);
            reader.readAsArrayBuffer(file);
        });
    }
    function addFileToList(fileName, index){
        const fileItem = document.createElement("div");
        fileItem.className = "xgt-file-item";
        fileItem.innerHTML = `<span>${fileName}</span><button class="xgt-delete-file-btn" data-index="${index}">X√≥a</button>`;
        filesList.appendChild(fileItem);
        fileItem.querySelector(".xgt-delete-file-btn").addEventListener("click", (e)=>{
            fileIndexToRemove = parseInt(e.target.getAttribute("data-index"));
            passwordDialog.style.display = "flex"; passwordInput.focus();
        });
    }
    function removeFile(index){
        uploadedFiles.splice(index, 1);
        filesList.innerHTML = "";
        uploadedFiles.forEach((file, i) => addFileToList(file.name, i));
        updateFileNameDisplay(); displayAllData(); saveDataToFirebase();
    }
    function updateFileNameDisplay(){
        fileNameDisplay.textContent = uploadedFiles.length === 0 ? "Ch∆∞a ch·ªçn file" : `${uploadedFiles.length} file ƒë√£ ch·ªçn`;
    }
    function displayAllData(){
        if (editingRowState.index !== null) handleEditRow();
        currentData = []; rowIndexMap = [];
        let isFirstFile = true;
        uploadedFiles.forEach((file, fileIndex) => {
            if (!file.data || file.data.length === 0) return;
            let dataSlice = file.data;
            if (isFirstFile) { headersCache = dataSlice[0] || []; isFirstFile = false; }
            for (let i = 0; i < dataSlice.length; i++) {
                if (i === 0 && fileIndex > 0) continue;
                currentData.push(dataSlice[i]);
                rowIndexMap.push({ fileIndex, rowIndexInFile: i });
            }
        });
        selectedRowIdx.clear(); showingOnlySelected = false; searchInput.value = '';
        createTable(currentData); updateActionButtonsState(); renderColumnSelector();
    }
    function visibleColumnIndexes(){ return (headersCache || []).map((_, idx) => idx).filter(idx => !hiddenColumns.has(idx)); }
    
    function createTable(data){
        tableContainer.innerHTML = "";
        if(!data || data.length <= 1){ tableContainer.innerHTML = `<p style="text-align: center; padding: 40px; color: #888;">Kh√¥ng c√≥ d·ªØ li·ªáu.</p>`; return; }
        headersCache = data[0] || [];
        const visibleIdx = visibleColumnIndexes();
        const table = document.createElement("table");
        table.className = "xgt-price-table";
        const thead = document.createElement("thead");
        const headerRow = document.createElement("tr");

        visibleIdx.forEach(colIdx => { 
            const th = document.createElement("th");
            th.className = 'xgt-th-resizable';
            th.textContent = headersCache[colIdx] || "";
            th.style.width = columnWidths[colIdx] ? `${columnWidths[colIdx]}px` : 'auto';
            th.dataset.colIndex = colIdx;
            const resizer = document.createElement('div'); 
            resizer.className = 'xgt-col-resizer';
            th.appendChild(resizer);
            headerRow.appendChild(th); 
        });
        const thChoose = document.createElement('th'); thChoose.textContent = 'Ch·ªçn'; headerRow.appendChild(thChoose);
        thead.appendChild(headerRow); table.appendChild(thead);

        const tbody = document.createElement("tbody");
        for(let i=1; i < data.length; i++){
            const tr = document.createElement("tr");
            tr.dataset.rowIndex = i;
            visibleIdx.forEach(colIdx => {
                const td = document.createElement("td"); td.textContent = data[i][colIdx] || ''; tr.appendChild(td);
            });
            const tdChoose = document.createElement('td');
            const cb = document.createElement('input'); cb.type = 'checkbox';
            cb.addEventListener('change', () => { if(cb.checked) selectedRowIdx.add(i); else selectedRowIdx.delete(i); updateActionButtonsState(); });
            tdChoose.style.textAlign = 'center'; tdChoose.appendChild(cb); tr.appendChild(tdChoose);
            tbody.appendChild(tr);
        }
        table.appendChild(tbody);
        tableContainer.appendChild(table);
        enableColumnResizing();
    }
    
    // H√ÄM M·ªöI (VI·∫æT L·∫†I): X·ª≠ l√Ω logic co gi√£n c·ªôt m·ªôt c√°ch ·ªïn ƒë·ªãnh
    function enableColumnResizing() {
        const headers = document.querySelectorAll('#xgt-tableContainer .xgt-th-resizable');
        headers.forEach(header => {
            const resizer = header.querySelector('.xgt-col-resizer');
            if (!resizer) return;

            const onMouseDown = (e) => {
                e.preventDefault();
                const startX = e.clientX;
                const startWidth = header.offsetWidth;

                const onMouseMove = (moveEvent) => {
                    const newWidth = startWidth + (moveEvent.clientX - startX);
                    if (newWidth > 50) { // ƒê·∫∑t gi·ªõi h·∫°n t·ªëi thi·ªÉu
                        header.style.width = `${newWidth}px`;
                    }
                };

                const onMouseUp = () => {
                    document.removeEventListener('mousemove', onMouseMove);
                    document.removeEventListener('mouseup', onMouseUp);
                    // L∆∞u l·∫°i ƒë·ªô r·ªông m·ªõi c·ªßa c·ªôt
                    columnWidths[header.dataset.colIndex] = header.offsetWidth;
                };

                document.addEventListener('mousemove', onMouseMove);
                document.addEventListener('mouseup', onMouseUp);
            };

            resizer.addEventListener('mousedown', onMouseDown);
        });
    }

    // H√ÄM M·ªöI: X·ª≠ l√Ω logic co gi√£n popup
    function enablePopupResizing() {
        const resizer = document.getElementById('xgt-popup-resizer-se');
        
        const onMouseDown = (e) => {
            e.preventDefault();
            const startX = e.clientX;
            const startY = e.clientY;
            const startWidth = popupContainer.offsetWidth;
            const startHeight = popupContainer.offsetHeight;

            // Khi b·∫Øt ƒë·∫ßu resize, chuy·ªÉn t·ª´ transform sang top/left ƒë·ªÉ t√≠nh to√°n ·ªïn ƒë·ªãnh
            if (popupContainer.style.transform !== 'none') {
                const rect = popupContainer.getBoundingClientRect();
                popupContainer.style.transform = 'none';
                popupContainer.style.left = `${rect.left}px`;
                popupContainer.style.top = `${rect.top}px`;
            }

            const onMouseMove = (moveEvent) => {
                const newWidth = startWidth + (moveEvent.clientX - startX);
                const newHeight = startHeight + (moveEvent.clientY - startY);
                popupContainer.style.width = `${newWidth}px`;
                popupContainer.style.height = `${newHeight}px`;
            };

            const onMouseUp = () => {
                document.removeEventListener('mousemove', onMouseMove);
                document.removeEventListener('mouseup', onMouseUp);
            };

            document.addEventListener('mousemove', onMouseMove);
            document.addEventListener('mouseup', onMouseUp);
        };

        resizer.addEventListener('mousedown', onMouseDown);
    }
    
    // ... (C√°c h√†m ti·ªán √≠ch kh√°c - kh√¥ng thay ƒë·ªïi) ...
    function renderColumnSelector(){
        columnList.innerHTML = ""; if(!headersCache.length){ columnToolbar.style.display = 'none'; return; }
        columnToolbar.style.display = 'flex';
        headersCache.forEach((name, idx) => {
            const chip = document.createElement('label'); chip.className = 'xgt-column-chip';
            const cb = document.createElement('input'); cb.type = 'checkbox'; cb.dataset.index = idx; cb.checked = !hiddenColumns.has(idx);
            const span = document.createElement('span'); span.textContent = name || `C·ªôt ${idx+1}`;
            chip.appendChild(cb); chip.appendChild(span); columnList.appendChild(chip);
        });
    }
    function applyColumnSelection(mode) {
        columnList.querySelectorAll('input:checked').forEach(cb => {
            const idx = parseInt(cb.dataset.index);
            if (mode === 'hide') hiddenColumns.add(idx);
            else if (mode === 'unhide') hiddenColumns.delete(idx);
        });
        redrawWithFilters();
    }
    function redrawWithFilters(){
        if (showingOnlySelected) renderSelectedOnly();
        else if (searchInput.value.trim()) performSearch();
        else createTable(currentData);
        renderColumnSelector();
    }
    function renderSelectedOnly(){
        const indices = Array.from(selectedRowIdx).sort((a,b)=>a-b);
        const aoa = [currentData[0], ...indices.map(idx => currentData[idx])];
        createTable(aoa);
    }
    function performSearch(){
        const term = searchInput.value.trim().toLowerCase();
        if (!term) { createTable(currentData); return; }
        const filtered = [currentData[0], ...currentData.slice(1).filter(row => row.some(cell => String(cell).toLowerCase().includes(term)))];
        createTable(filtered);
    }
    async function saveDataToFirebase(){
        const userFile = uploadedFiles.find(f => f.name === "User Added Data");
        if(userFile) userFile.data = userFile.data.filter((row, i) => i === 0 || row.some(cell => String(cell).trim() !== ''));
        try { await database.ref("priceData").set({ files: uploadedFiles }); }
        catch (err) { alert("L·ªói khi l∆∞u d·ªØ li·ªáu l√™n server."); }
    }
    function loadDataFromFirebase(){
        tableContainer.innerHTML = `<div class="xgt-loading" style="display: block;"><div class="xgt-spinner"></div><p>ƒêang t·∫£i d·ªØ li·ªáu...</p></div>`;
        database.ref('priceData').once('value').then(snapshot => {
            const data = snapshot.val();
            if(data && data.files && data.files.length > 0){ 
                uploadedFiles = data.files;
                filesList.innerHTML = '';
                uploadedFiles.forEach((file,index) => addFileToList(file.name, index));
                updateFileNameDisplay(); displayAllData();
            } else { tableContainer.innerHTML = `<p style="text-align:center; padding: 40px; color: #888;">Ch∆∞a c√≥ d·ªØ li·ªáu.</p>`; }
        }).catch(error => {
            tableContainer.innerHTML = `<p style="text-align:center; padding: 40px; color: #888;">L·ªói t·∫£i d·ªØ li·ªáu.</p>`;
        });
    }
    function exportCurrentViewToExcel(){
        const table = tableContainer.querySelector('.xgt-price-table');
        if(!table){ alert('Kh√¥ng c√≥ d·ªØ li·ªáu ƒë·ªÉ xu·∫•t.'); return; }
        const aoa = [];
        table.querySelectorAll('tr').forEach(tr => {
            const row = [];
            tr.querySelectorAll('th, td').forEach((cell, index) => { if (index < tr.cells.length - 1) row.push(cell.textContent.trim()); });
            if(row.length > 0) aoa.push(row);
        });
        if (aoa.length <= 1) { alert('Kh√¥ng c√≥ d·ªØ li·ªáu ƒë·ªÉ xu·∫•t.'); return; }
        const ws = XLSX.utils.aoa_to_sheet(aoa);
        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, 'BangGia');
        XLSX.writeFile(wb, `BangGia_Xuat_${new Date().toISOString().slice(0,10)}.xlsx`);
    }

    // K√≠ch ho·∫°t ch·ª©c nƒÉng co gi√£n popup ngay khi script ch·∫°y
    enablePopupResizing();

})();
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Ch·ªØ ch·∫°y ch√¢n trang - ƒë·ªôc l·∫≠p</title>
  <style>
    #marquee-ideco-footer {
      position: fixed;
      left: 0;
      bottom: 1.5cm;
      width: 100vw;
      background: transparent;
      z-index: 2147483000; /* r·∫•t cao, nh∆∞ng kh√¥ng block app v√¨ pointer-events: none */
      overflow: hidden;
      pointer-events: none;
    }
    #marquee-ideco-text {
      display: inline-block;
      white-space: nowrap;
      font-size: 2em;
      color: #d61a1a;
      font-weight: bold;
      text-shadow: 1px 1px 0 #fff, 2px 2px 4px #fa8686;
      user-select: none;
      cursor: pointer;
      transition: filter 0.2s;
      pointer-events: auto;
      padding: 0 18px;
      background: transparent;
    }
    #marquee-ideco-text:hover {
      filter: brightness(1.2) drop-shadow(0 0 8px #fbc2c2);
    }
  </style>
</head>
<body>
  <!-- Ch·ªØ ch·∫°y ƒë·ªôc l·∫≠p, kh√¥ng d√≠nh app -->
  <div id="marquee-ideco-footer">
    <div id="marquee-ideco-text">
 
C√ôNG NHAU L√ÄM CHUY√äN NGHI·ªÜP - H·ªñ TR·ª¢ NHAU QU·∫¢N L√ù C√îNG VI·ªÜC - CH·ª¶ ƒê·ªòNG L·∫¨P CHECKLIST- K·∫æ HO·∫†CH ƒê·ªÇ L√ÄM T·ªêT H∆†N , THEO M·ª§C TI√äU T·ªêT H∆†N.
- KI·ªÇM TRA H·∫†CH TO√ÅN S·ªê LI·ªÜU K·ª∏ TR∆Ø·ªöC KHI BAN H√ÄNH - T·∫¨N D·ª§NG AI ƒê·ªÇ H·ªñ TR·ª¢ X·ª¨ L√ù NHANH H∆†N -T·ªêT H∆†N ƒê·ªÇ C√ì TH·ªúI GIAN CHO B√ÅN H√ÄNG - KINH DOANH ƒê·ªÇ C√ì DOANH THU
- TH√ô T·ª§C QUY ƒê·ªäNH KHO D∆Ø·ª¢C PH·∫¢I ƒê·∫¢M B·∫¢O ƒê·ª¶ KHAI B√ÅO M·ªåI PH√ÅT SINH : NH·∫¨P - XU·∫§T - TR·∫¢ - ƒê·ªîI K·ª∏ L∆Ø·ª†NG , C·∫®N TH·∫¨N
- ƒê·ªäNH K·ª≤ XEM L·∫†I QUY ƒê·ªäNH - M·ª§C TI√äU KINH DOANH - M·ª§C TI√äU GIAO VI·ªÜC TH√ÅNG: C√ôNG NHAU B√ÅM S√ÅT, NH·∫ÆC NH·ªû NHAU ƒê·ªÇ HO√ÄN TH√ÄNH V√Ä B√ÅO C√ÅO

   
	</div>
  </div>
  <script>
    // Ch·ªânh t·ªëc ƒë·ªô ·ªü ƒë√¢y (px/gi√¢y)
    const speed = 120;
    const textEl = document.getElementById('marquee-ideco-text');
    const wrapEl = document.getElementById('marquee-ideco-footer');
    let timeoutMarquee;

    function startMarquee() {
      // Reset v·ªã tr√≠ ban ƒë·∫ßu
      textEl.style.transition = 'none';
      textEl.style.transform = `translateX(${wrapEl.offsetWidth}px)`;

      // T√≠nh to√°n th·ªùi gian ch·∫°y d·ª±a tr√™n t·ªëc ƒë·ªô
      const textWidth = textEl.offsetWidth;
      const containerWidth = wrapEl.offsetWidth;
      const totalDistance = textWidth + containerWidth;
      const duration = totalDistance / speed;

      // B·∫Øt ƒë·∫ßu animation
      setTimeout(() => {
        textEl.style.transition = `transform ${duration}s linear`;
        textEl.style.transform = `translateX(-${textWidth}px)`;

        // L·∫∑p l·∫°i animation sau khi k·∫øt th√∫c
        timeoutMarquee = setTimeout(startMarquee, duration * 1000);
      }, 40);
    }

    // B·∫Øt ƒë·∫ßu ch·∫°y ch·ªØ khi t·∫£i trang
    window.addEventListener('load', startMarquee);

    // ƒêi·ªÅu ch·ªânh l·∫°i khi resize c·ª≠a s·ªï
    window.addEventListener('resize', () => {
      clearTimeout(timeoutMarquee);
      startMarquee();
    });
  </script>
</body>
</html>


<!-- ========== C·∫¢NH B√ÅO T·ªíN KHO THEO NHI·ªÄU KHUNG GI·ªú ========== -->


    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

    <style>
        /* CSS GIAO DI·ªÜN (KH√îNG XUNG ƒê·ªòT V·ªöI WEB KH√ÅC) */
        body { margin: 0; padding: 0; font-family: 'Segoe UI', sans-serif; background: #f4f6f8; }

        #ideco-notify-overlay {
            display: none; /* M·∫∑c ƒë·ªãnh ·∫©n */
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.75);
            z-index: 999999; /* ƒê·∫£m b·∫£o n·∫±m tr√™n c√πng */
            align-items: center; justify-content: center;
        }

        #ideco-notify-box {
            width: 1000px; max-width: 95%; height: 800px; max-height: 90vh;
            background: #fff; border-radius: 8px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            display: flex; flex-direction: column; overflow: hidden;
            animation: idecoZoom 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes idecoZoom { from {transform: scale(0.8); opacity: 0;} to {transform: scale(1); opacity: 1;} }

        .ideco-n-header {
            background: linear-gradient(to right, #b91c1c, #c2410c);
            color: white; padding: 15px 20px;
            display: flex; justify-content: space-between; align-items: center;
        }

        .ideco-n-title { font-size: 1.1rem; font-weight: bold; text-transform: uppercase; line-height: 1.4; }
        .ideco-n-body { flex: 1; padding: 0; overflow-y: auto; background: #f8fafc; }

        /* Table Style */
        .ideco-n-table { width: 100%; border-collapse: collapse; font-size: 0.95rem; }
        .ideco-n-table th { background: #e2e8f0; position: sticky; top: 0; padding: 12px; text-align: left; border-bottom: 2px solid #cbd5e1; color: #334155; }
        .ideco-n-table td { padding: 10px 12px; border-bottom: 1px solid #e2e8f0; color: #1e293b; }
        .ideco-n-table tr:nth-child(even) { background: #f1f5f9; }
        .ideco-n-table tr:hover { background: #fff7ed; }
        .ideco-n-qty { color: #dc2626; font-weight: bold; text-align: right; }

        .ideco-n-footer {
            padding: 15px; background: white; border-top: 1px solid #e2e8f0;
            text-align: right; display: flex; justify-content: space-between; align-items: center;
        }

        .ideco-n-btn {
            background: #2563eb; color: white; border: none; padding: 10px 25px;
            border-radius: 5px; cursor: pointer; font-weight: bold; font-size: 1rem;
        }
        .ideco-n-btn:hover { background: #1d4ed8; }
    </style>
</head>
<body>
  

    <div id="ideco-notify-overlay">
        <div id="ideco-notify-box">
            <div class="ideco-n-header">
                <div>
                    <div class="ideco-n-title">üîî T·ªíN KHO CU·ªêI K·ª≤ - K·∫æ TO√ÅN & KHO KI·ªÇM SO√ÅT S·ªê LI·ªÜU</div>
                    <div style="font-size: 0.8rem; opacity: 0.9; font-weight: normal;">H·ªá th·ªëng MISA-ERP-FEFO</div>
                </div>
                <div style="text-align:right">
                    <span id="ideco-n-clock" style="font-family: monospace; font-size: 1.1rem; background: rgba(0,0,0,0.2); padding: 5px 10px; border-radius: 4px;">--:--</span>
                    <div style="font-size:0.75rem; margin-top:2px; opacity:0.9">Khung gi·ªù: <span id="ideco-sched-time"></span></div>
                </div>
            </div>
            <div class="ideco-n-body">
                <table class="ideco-n-table">
                    <thead>
                        <tr>
                            <th width="50">STT</th>
                            <th width="100">M√£ SP</th>
                            <th>T√™n H√†ng H√≥a</th>
                            <th width="80">ƒê∆°n V·ªã</th>
                            <th width="120">S·ªë L√¥</th>
                            <th width="120">H·∫°n D√πng</th>
                            <th width="80" style="text-align:right">T·ªìn</th>
                        </tr>
                    </thead>
                    <tbody id="ideco-n-list"></tbody>
                </table>
                
                <div id="ideco-n-loader" style="text-align: center; padding: 50px; color: #64748b; font-style: italic; display:none;">
                    ‚è≥ ƒêang k·∫øt n·ªëi m√°y ch·ªß c·∫≠p nh·∫≠t d·ªØ li·ªáu m·ªõi nh·∫•t...
                </div>
            </div>
            <div class="ideco-n-footer">
                <small style="color: #d97706; font-weight:600;">‚ö†Ô∏è L∆∞u √Ω: In phi·∫øu XNT c·∫©n th·∫≠n - B√°o c√°o BGƒê - Qu·∫£n l√Ω k·∫ø to√°n kho v·∫≠n cu·ªëi th√°ng</small>
                <button class="ideco-n-btn" onclick="closeIdecoNotify()">‚úÖ ƒê√É XEM & ƒê√ìNG</button>
            </div>
        </div>
    </div>

    <script>
        // --- 1. C·∫§U H√åNH L·ªäCH TR√åNH (ƒê√É S·ª¨A L·ªñI C√ö PH√ÅP) ---
        // 0: CN, 1: Th·ª© 2 ... 6: Th·ª© 7
        const SCHEDULE = {
            1: ['09:00', '10:00', '14:00', '16:00'], 
            2: ['09:00', '10:00', '13:30', '16:00'], // ƒê√£ th√™m d·∫•u ph·∫©y
            3: ['09:00', '16:00'],                   
            4: ['08:40', '9:30', '11:30', '14:00', '16:00'],          
            5: ['08:45', '10:00', '11:30', '14:00', '16:00'],          
            6: ['09:00', '10:00', '11:30', '14:00', '16:00'] // ƒê√£ s·ª≠a 11"30 th√†nh 11:30
        };

        // C·∫•u h√¨nh Firebase c·ªßa b·∫°n
        const FB_CONFIG = {
            apiKey: "AIzaSyB54vAqmLmkMPq-L0X69oRS2DdVxxtrLPc",
            authDomain: "quanlykho-5c64f.firebaseapp.com",
            projectId: "quanlykho-5c64f",
            storageBucket: "quanlykho-5c64f.firebasestorage.app",
            messagingSenderId: "106024120320",
            appId: "1:106024120320:web:ede1dae16cb6cccd42e8e5"
        };

        let notifyDb = null;
        let isNotifyOpen = false;
        let isWaitingDelay = false;

        // --- H√ÄM KH·ªûI T·∫†O (CH·∫†Y ƒê·∫¶U TI√äN) ---
        function initApp() {
            // Ki·ªÉm tra th∆∞ vi·ªán Firebase ƒë√£ t·∫£i xong ch∆∞a
            if (typeof firebase === 'undefined') { 
                console.warn("ƒêang t·∫£i th∆∞ vi·ªán Firebase...");
                setTimeout(initApp, 500); 
                return; 
            }
            
            // K·∫øt n·ªëi Firebase
            if (!firebase.apps.length) {
                firebase.initializeApp(FB_CONFIG);
            }
            notifyDb = firebase.database();
            
            // K√≠ch ho·∫°t b·ªô ƒë·∫øm th·ªùi gian (1 gi√¢y/l·∫ßn)
            setInterval(checkSmartSchedule, 1000);
            console.log("‚úÖ H·ªá th·ªëng b√°o c√°o t·ªìn kho: S·∫¥N S√ÄNG (Ch·∫ø ƒë·ªô tr·ªÖ 10s)");
        }

        // --- LOGIC KI·ªÇM TRA GI·ªú (TH√îNG MINH) ---
        function checkSmartSchedule() {
            if (isNotifyOpen || isWaitingDelay) return;

            const now = new Date();
            const day = now.getDay();
            const currentTimeVal = now.getHours() * 60 + now.getMinutes(); // T·ªïng s·ªë ph√∫t trong ng√†y
            const dateStr = now.toISOString().slice(0,10); // YYYY-MM-DD

            const todaySched = SCHEDULE[day];
            if (!todaySched) return; // H√¥m nay kh√¥ng c√≥ l·ªãch

            // 1. T√¨m khung gi·ªù QUAN TR·ªåNG NH·∫§T (G·∫ßn nh·∫•t ƒë√£ qua ho·∫∑c ƒëang di·ªÖn ra)
            let targetTimeStr = null;
            let maxTimeVal = -1;

            todaySched.forEach(time => {
                const [h, m] = time.split(':').map(Number);
                const schedVal = h * 60 + m;

                // Ch·ªâ x√©t c√°c gi·ªù nh·ªè h∆°n ho·∫∑c b·∫±ng gi·ªù hi·ªán t·∫°i
                if (schedVal <= currentTimeVal) {
                    // L·∫•y gi·ªù l·ªõn nh·∫•t trong s·ªë ƒë√≥ (t·ª©c l√† gi·ªù g·∫ßn nh·∫•t)
                    if (schedVal > maxTimeVal) {
                        maxTimeVal = schedVal;
                        targetTimeStr = time;
                    }
                }
            });

            // 2. X·ª≠ l√Ω hi·ªÉn th·ªã
            if (targetTimeStr) {
                const sessionKey = `ideco_seen_${dateStr}_${targetTimeStr}`;
                
                // N·∫øu ch∆∞a xem l·∫ßn n√†o trong phi√™n n√†y
                if (!sessionStorage.getItem(sessionKey)) {
                    const timeDiff = currentTimeVal - maxTimeVal; // Ch√™nh l·ªách ph√∫t
                    
                    // A. N·∫øu ƒê√öNG GI·ªú (trong ph√∫t ƒë·∫ßu ti√™n v√† 5 gi√¢y ƒë·∫ßu) -> Hi·ªán ngay
                    if (timeDiff === 0 && now.getSeconds() < 5) {
                        showPopup(sessionKey, targetTimeStr);
                    } 
                    // B. N·∫øu V√ÄO MU·ªòN (ƒë√£ qua gi·ªù quy ƒë·ªãnh) -> ƒê·ª£i 10 gi√¢y
                    else {
                        console.log(`üïí Ph√°t hi·ªán v√†o mu·ªôn sau gi·ªù b√°o c√°o ${targetTimeStr}. Ch·ªù 10s...`);
                        isWaitingDelay = true;
                        
                        setTimeout(() => {
                            showPopup(sessionKey, targetTimeStr);
                            isWaitingDelay = false;
                        }, 10000); // 10000 mili gi√¢y = 10 gi√¢y
                    }
                }
            }
        }

        // --- H√ÄM HI·ªÇN TH·ªä POPUP ---
        function showPopup(key, schedTime) {
            if (!notifyDb) return;
            
            isNotifyOpen = true;
            const overlay = document.getElementById('ideco-notify-overlay');
            const tbody = document.getElementById('ideco-n-list');
            const loader = document.getElementById('ideco-n-loader');
            
            // Hi·ªÉn th·ªã khung
            overlay.style.display = 'flex';
            overlay.setAttribute('data-key', key);
            tbody.innerHTML = ''; 
            loader.style.display = 'block'; // Hi·ªán loading
            
            // C·∫≠p nh·∫≠t gi·ªù tr√™n giao di·ªán
            document.getElementById('ideco-n-clock').innerText = new Date().toLocaleString('vi-VN');
            document.getElementById('ideco-sched-time').innerText = schedTime;

            // K·∫æT N·ªêI FIREBASE L·∫§Y D·ªÆ LI·ªÜU TH·ª∞C T·∫æ
            notifyDb.ref('pharmaceuticals').once('value').then(snap => {
                loader.style.display = 'none'; // T·∫Øt loading
                const data = snap.val();
                
                if (!data) { 
                    tbody.innerHTML = '<tr><td colspan="7" style="text-align:center; padding:20px">Kho ƒëang tr·ªëng</td></tr>'; 
                    return; 
                }

                // X·ª≠ l√Ω d·ªØ li·ªáu: L·ªçc t·ªìn > 0 v√† s·∫Øp x·∫øp t√™n
                const arr = Object.values(data)
                    .filter(i => parseInt(i.quantity) > 0)
                    .sort((a,b) => (a.productName||'').localeCompare(b.productName||''));
                
                if(arr.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="7" style="text-align:center; padding:20px; font-weight:bold; color:green">H·∫øt h√†ng t·ªìn kho!</td></tr>';
                } else {
                    // Render ra b·∫£ng
                    tbody.innerHTML = arr.map((item, i) => `
                        <tr>
                            <td>${i+1}</td>
                            <td style="color:#2563eb; font-weight:bold">${item.productCode||'--'}</td>
                            <td>${item.productName}</td>
                            <td>${item.unit||''}</td>
                            <td>${item.lotNumber}</td>
                            <td>${item.expiryDate}</td>
                            <td class="ideco-n-qty">${item.quantity}</td>
                        </tr>
                    `).join('');
                }
            }).catch(err => {
                loader.style.display = 'none';
                tbody.innerHTML = `<tr><td colspan="7" style="color:red; text-align:center; padding:20px">‚ùå L·ªói k·∫øt n·ªëi Server: ${err.message}</td></tr>`;
            });
        }

        // --- H√ÄM ƒê√ìNG POPUP ---
        function closeIdecoNotify() {
            const overlay = document.getElementById('ideco-notify-overlay');
            const key = overlay.getAttribute('data-key');
            
            // L∆∞u l·∫°i ƒë√£ xem ƒë·ªÉ kh√¥ng hi·ªán l·∫°i
            if (key) sessionStorage.setItem(key, 'true');
            
            overlay.style.display = 'none';
            isNotifyOpen = false;
        }

        // B·∫Øt ƒë·∫ßu ch·∫°y
        initApp();
    </script>








<!-- Script TH√îNG B√ÅO KH√ÅCH H√ÄNG ƒê·∫†T H√ÄNG -->
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

<script>
(function() {
    // === PH·∫¶N C·∫§U H√åNH ===

    // 1. C·∫•u h√¨nh Firebase c·ªßa b·∫°n
    const firebaseConfig = {
        apiKey: "AIzaSyDKNLLhisemYQJeCW8QCOwfbvVsvUur-60",
        authDomain: "quetbarcode-2361a.firebaseapp.com",
        databaseURL: "https://quetbarcode-2361a-default-rtdb.firebaseio.com",
        projectId: "quetbarcode-2361a",
        storageBucket: "quetbarcode-2361a.firebasestorage.app",
        messagingSenderId: "209619008657",
        appId: "1:209619008657:web:ee4af6f6ec567a1d745330",
        measurementId: "G-2TRYH9DYK5"
    };

    // 2. C·∫•u h√¨nh l·ªãch tr√¨nh popup (D·ªÖ d√†ng ch·ªânh s·ª≠a)
    const popupSchedule = {
        // 0:CN, 1:T2, 2:T3, 3:T4, 4:T5, 5:T6, 6:T7
        days: [0, 1, 2, 3, 4, 5, 6], // Ch·∫°y t·∫•t c·∫£ c√°c ng√†y
        
        times: [
            { hour: 9, minute: 15 },
            { hour: 10, minute: 30 }, 
            { hour: 11, minute: 30 },
			{ hour: 13, minute: 30 },
			{ hour: 14, minute: 30 },
			{ hour: 15, minute: 30 },
            { hour: 17, minute: 00 }
        ]
    };
    
    // 3. C·∫•u h√¨nh t√≠nh nƒÉng N√ÇNG C·∫§P (Ki·ªÉm tra ƒë·ªçc nhanh)
    const MIN_READ_TIME_SECONDS = 8; // S·ªë gi√¢y t·ªëi thi·ªÉu ph·∫£i xem popup danh s√°ch
    const DEFAULT_HEADER = "üîî B·∫†N ∆†I ! C√íN NHI·ªÄU KH√ÅCH H√ÄNG CH∆ØA C√ì ƒê∆†N K√åA- KH·∫®N TR∆Ø∆†NG NH√â!";
    
    // === K·∫æT TH√öC C·∫§U H√åNH ===

    let customers = [];
    let shadowRoot;
    let database;
    // popupDisplayTime s·∫Ω l∆∞u th·ªùi ƒëi·ªÉm popup ch√≠nh ƒë∆∞·ª£c hi·ªÉn th·ªã L·∫¶N ƒê·∫¶U.
    let popupDisplayTime = null; 
    
    // Bi·∫øn m·ªõi: Theo d√µi m·ªëc th·ªùi gian g·∫ßn nh·∫•t ƒë√£ hi·ªÉn th·ªã trong ng√†y.
    // D·∫°ng: 'HH:mm' (v√≠ d·ª•: '09:30'). ƒê·∫£m b·∫£o popup kh√¥ng l·∫∑p l·∫°i li√™n t·ª•c cho c√πng m·ªôt m·ªëc.
    let lastDisplayedTime = null; 


    // ===================================================
    // TEMPLATE POPUP CH√çNH V√Ä NH·∫ÆC NH·ªû (GI·ªÆ NGUY√äN)
    // ===================================================
    const mainPopupTemplate = `
        <style>
            /* Style chung cho Host v√† c√°c th√†nh ph·∫ßn */
            :host {
                font-family: Arial, sans-serif;
                color: #333;
                line-height: 1.5;
            }
            * {
                box-sizing: border-box;
                margin: 0;
                padding: 0;
            }
            /* Overlay ph·ªß to√†n m√†n h√¨nh, n·∫±m d∆∞·ªõi 2 popup */
            #reminderOverlay {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.6);
                z-index: 2147483645;
            }
            
            /* Style cho Popup Ch√≠nh (Danh s√°ch) */
            #reminderPopup {
                display: none; /* M·∫∑c ƒë·ªãnh ·∫©n */
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                
                /* <<< THAY ƒê·ªîI 1: TƒÇNG CHI·ªÄU R·ªòNG T·ª™ 600px L√äN 850px */
                width: 850px; 
                
                max-width: 90%;
                height: auto;
                max-height: 80vh;
                background-color: #ffffe0;
                border: 2px solid #f44336;
                padding: 0;
                border-radius: 8px;
                z-index: 2147483646;
                box-shadow: 0 5px 15px rgba(0,0,0,0.3);
                flex-direction: column;
            }
            .popup-header {
                background-color: #f44336;
                color: white;
                padding: 10px 15px;
                border-radius: 6px 6px 0 0;
                display: flex;
                justify-content: space-between;
                align-items: center;
                flex-shrink: 0;
            }
            .popup-header h3 {
                color: white;
                font-size: 18px;
                font-weight: bold;
            }
            .popup-content {
                padding: 20px;
                overflow-y: auto;
                flex-grow: 1;
            }
            .popup-content h4 {
                color: #d9534f;
                border-bottom: 1px solid #ccc;
                padding-bottom: 5px;
                margin-top: 15px;
                margin-bottom: 10px;
                font-size: 17px;
                font-weight: bold;
            }
            .popup-content p {
                 margin-top: 0;
                 margin-bottom: 10px;
                 font-size: 15px;
            }
            .popup-content ul {
                list-style-type: decimal;
                padding-left: 25px;
                margin: 0;
                max-height: 200px; /* B·∫°n c√≥ th·ªÉ tƒÉng gi√° tr·ªã n√†y n·∫øu mu·ªën danh s√°ch d√†i h∆°n */
                overflow-y: auto;
                border: 1px solid #eee;
                padding-top: 10px;
                padding-bottom: 10px;
                background: #fff;
            }
            .popup-content li {
                margin-bottom: 8px;
                font-size: 14px;
            }
            .popup-content li strong {
                font-weight: bold;
            }
            .popup-footer {
                text-align: center;
                padding: 15px;
                border-top: 1px solid #ddd;
                background-color: #f9f9f9;
                border-radius: 0 0 6px 6px;
                flex-shrink: 0;
            }
            .popup-footer button {
                background-color: #4CAF50;
                color: white;
                padding: 10px 20px;
                font-size: 16px;
                border: none;
                border-radius: 5px;
                cursor: pointer;
                font-weight: bold;
            }
            .popup-footer button:hover {
                background-color: #45a049;
            }

            /* Style cho Popup Nh·∫Øc Nh·ªü (M·ªõi) */
            #snoozePopup {
                display: none; /* M·∫∑c ƒë·ªãnh ·∫©n */
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                width: 1200px; 
                height: 700px; 
                max-width: 95%;
                background-color: white; 
                border: 5px solid #009688; 
                padding: 30px;
                border-radius: 15px;
                z-index: 2147483647; /* ƒê·∫£m b·∫£o N·∫∞M TR√äN popup ch√≠nh */
                box-shadow: 0 8px 25px rgba(0,0,0,0.5);
                text-align: center;
                /* Khi hi·ªÉn th·ªã, n√≥ s·∫Ω d√πng flex-direction: column */
                flex-direction: column; 
                justify-content: center;
                align-items: center;
            }
            #snoozePopup h2 {
                color: #009688;
                font-size: 26px;
                margin-bottom: 15px;
                font-weight: bold;
            }
            #snoozePopup p {
                font-size: 20px;
                color: #388e3c;
                margin-bottom: 25px;
            }
            #snoozePopup button {
                 background-color: #009688;
                 color: white;
                 padding: 12px 25px;
                 font-size: 18px;
                 border: none;
                 border-radius: 8px;
                 cursor: pointer;
                 font-weight: bold;
            }
            #snoozePopup button:hover {
                 background-color: #00796b;
            }
            
        </style>
        
        <div id="reminderOverlay"></div>

        <div id="reminderPopup">
            <div class="popup-header">
                <h3 id="popupHeaderTitle">${DEFAULT_HEADER}</h3>
            </div>
            <div class="popup-content" id="reminderContent">
                </div>
            <div class="popup-footer">
                <button id="closeReminderButton">ƒê√£ ƒë·ªçc</button>
            </div>
        </div>

        <div id="snoozePopup">
             <h2>üòä B·∫†N C√ì L·∫∫ CH∆ØA ƒê·ªåC K·ª∏ DANH S√ÅCH PH·∫¢I KH√îNG!</h2> 
             <p>B·∫°n h√£y xem l·∫°i kh√°ch h√†ng ch∆∞a c√≥ ƒë∆°n - hay b·∫°n qu√™n b·∫•m ƒë·ªÉ ch·ªß ƒë·ªông t∆∞∆°ng t√°c nhanh l·∫°i c√≥ ƒë∆°n nh√©</p>
             <p>Khi t∆∞∆°ng t√°c l·∫°i- n√™n g·ªçi ƒëi·ªán thay v√¨ chat: lu√¥n t√¨m c·ªõ gi·ªõi thi·ªáu m·ªõi UVS- Thu·ªëc- CTMK ƒë·ªÉ tƒÉng c∆° h·ªôi m·ªü r·ªông</p>
			 <p>Khi h·ªèi thƒÉm ƒë∆°n h√†ng- lu√¥n khuy·∫øn kh√≠ch l·∫•y th√™m - tƒÉng th√™m gia tr·ªã ƒë∆°n h√†ng c√†ng t·ªët - ƒë·ª´ng h·ªèi " H√†ng anh/ch·ªã b√°n ƒë∆∞·ª£c kh√¥ng?</p>
		     <p>Trong icon D·ªÆ LI·ªÜU KH√ÅCH H√ÄNG- Lu√¥n t√¨m poster thu·ªëc- poster UVS Silicone gel - UVS Nailcare chia s·∫Ω n·∫øu c√≥ d·ªãp m·ªçi giao th·ª©c</p>
			 <p>ƒê·∫∑t m·ª•c ti√™u c·ª• th·ªÉ trong tu·∫ßn c·∫ßn ph·∫£i ch·ªët ƒë∆°n kh√°ch h√†ng ch∆∞a l√™n- m·ªü ·ª®ng d·ª•ng Qu·∫£n l√Ω kh√°ch h√†ng ki·ªÉm tra cu·ªëi ng√†y</p>
			 <p>L∆ØU √ù KPI TH∆Ø·ªûNG C√ì S·ªê ƒê∆†N L·∫¨P TRONG K·ª≤ TH√ÄNH C√îNG -n√™n h√£y ch√∫ √Ω</p>
			 <p>C√°c b·∫°n b·ªô ph·∫≠n kh√°c ch·ªù ch√∫t nh√© - m√¨nh s·∫Ω m·ªü l·∫°i t∆∞∆°ng t√°c ngay!</p>
			<button id="closeSnoozeButton">Quay l·∫°i danh s√°ch</button>
        </div>
    `;
    
    // ===================================================
    // H√ÄM CH√çNH
    // ===================================================

    /**
     * Kh·ªüi t·∫°o v√† nh√∫ng HTML/CSS (GI·ªÆ NGUY√äN)
     */
    function createPopupDOM() {
        const shadowHost = document.createElement('div');
        shadowHost.id = 'gemini-popup-host';
        document.body.appendChild(shadowHost);
        shadowRoot = shadowHost.attachShadow({ mode: 'open' });
        shadowRoot.innerHTML = mainPopupTemplate;
        
        // G√°n s·ª± ki·ªán cho c√°c n√∫t
        shadowRoot.getElementById('closeReminderButton').addEventListener('click', handleMainPopupClose);
        shadowRoot.getElementById('closeSnoozeButton').addEventListener('click', closeSnoozePopup);
    }

    /**
     * T·∫£i d·ªØ li·ªáu Firebase (tr·∫£ v·ªÅ Promise) (GI·ªÆ NGUY√äN)
     */
    function loadFromFirebase() {
        return new Promise((resolve, reject) => {
            try {
                if (!database) {
                   console.error('Gemini Popup: K·∫øt n·ªëi Firebase ch∆∞a s·∫µn s√†ng.');
                   return reject('Firebase not ready');
                }
                database.ref('customerManagement/customers').once('value')
                    .then((snapshot) => {
                        const data = snapshot.val();
                        if (data && Array.isArray(data)) {
                            customers = data;
                            console.log('Gemini Popup: ƒê√£ t·∫£i ' + data.length + ' kh√°ch h√†ng.');
                        } else {
                            customers = [];
                            console.log('Gemini Popup: Kh√¥ng c√≥ d·ªØ li·ªáu ho·∫∑c d·ªØ li·ªáu kh√¥ng h·ª£p l·ªá.');
                        }
                        resolve(); // B√°o hi·ªáu ƒë√£ t·∫£i xong
                    })
                    .catch((error) => {
                        console.error('Gemini Popup: L·ªói t·∫£i Firebase:', error);
                        reject(error);
                    });
            } catch (error) {
                console.error('Gemini Popup: L·ªói th·ª±c thi t·∫£i Firebase:', error);
                reject(error);
            }
        });
    }

    /**
     * Ki·ªÉm tra xem c√≥ kh√°ch h√†ng c·∫ßn nh·∫Øc nh·ªü hay kh√¥ng. (GI·ªÆ NGUY√äN)
     * @returns {boolean} True n·∫øu c√≥ kh√°ch h√†ng ch∆∞a ƒë·∫∑t h√†ng.
     */
    function hasReminders() {
        return customers.some(c => 
            (c.staff && c.staff.trim()) && // Ph·∫£i c√≥ nh√¢n vi√™n
            !c.ordered && 
            !c.medicineOrdered
        );
    }

    /**
     * Hi·ªÉn th·ªã popup ch√≠nh (lu√¥n ƒëi k√®m overlay)
     * @param {string} scheduledTimeStr - M·ªëc th·ªùi gian k√≠ch ho·∫°t popup (d·∫°ng 'HH:mm')
     */
    function showReminderPopup(scheduledTimeStr) {
        if (!shadowRoot) {
             console.error("Gemini Popup: Shadow DOM ch∆∞a s·∫µn s√†ng, kh√¥ng th·ªÉ hi·ªÉn th·ªã.");
             return;
        }

        // ... (Logic t·∫°o n·ªôi dung gi·ªØ nguy√™n) ...
        const reminderContent = shadowRoot.getElementById('reminderContent');
        if (!reminderContent) return;

        let htmlContent = '';
        let staffWithReminders = 0;

        const staffNames = [...new Set(customers.map(c => c.staff ? c.staff.trim() : '').filter(name => name))];
        
        if (!hasReminders()) {
            console.log("Gemini Popup: T·∫•t c·∫£ nh√¢n vi√™n ƒë√£ ho√†n th√†nh. Kh√¥ng hi·ªÉn th·ªã popup ch√≠nh.");
            return;
        }
        
        // Ch·ªâ t·∫°o n·ªôi dung n·∫øu c√≥ kh√°ch h√†ng ƒë·ªÉ hi·ªÉn th·ªã
        staffNames.forEach(staffName => {
            const staffNameLower = staffName.toLowerCase();
            const customersToRemind = customers.filter(c => 
                (c.staff ? c.staff.trim().toLowerCase() : '') === staffNameLower &&
                !c.ordered &&
                !c.medicineOrdered
            );

            if (customersToRemind.length > 0) {
                staffWithReminders++;
                htmlContent += `<div style="margin-top: ${staffWithReminders > 1 ? '20px' : '0'};">`;
                htmlContent += `<h4>Nh√¢n vi√™n: ${staffName}</h4>`;
                htmlContent += `<p>B·∫°n c√≤n <strong>${customersToRemind.length}</strong> kh√°ch h√†ng ch∆∞a ƒë·∫∑t h√†ng:</p>`;
                htmlContent += '<ul>';
                customersToRemind.forEach(c => {
                    // <<< THAY ƒê·ªîI 2: TH√äM S·ªê ƒêI·ªÜN THO·∫†I (c.phone)
                    // N·∫øu tr∆∞·ªùng SƒêT c·ªßa b·∫°n t√™n kh√°c (v√≠ d·ª•: c.sdt), h√£y s·ª≠a "c.phone" ·ªü d√≤ng d∆∞·ªõi
                    htmlContent += `<li><strong>${c.name || 'N/A'}</strong> (M√£: ${c.code || 'N/A'}) - SƒêT: <strong>${c.phone || 'Ch∆∞a c√≥'}</strong></li>`;
                });
                htmlContent += '</ul></div>';
            }
        });
        
        reminderContent.innerHTML = htmlContent;
        
        // ƒê·∫£m b·∫£o popup nh·∫Øc nh·ªü LU√îN ·∫®N khi popup ch√≠nh ƒë∆∞·ª£c hi·ªÉn th·ªã.
        shadowRoot.getElementById('snoozePopup').style.display = 'none';
        
        // Hi·ªÉn th·ªã popup ch√≠nh v√† overlay
        shadowRoot.getElementById('reminderOverlay').style.display = 'block';
        shadowRoot.getElementById('reminderPopup').style.display = 'flex';
        
        // Ch·ªâ ghi l·∫°i th·ªùi ƒëi·ªÉm hi·ªÉn th·ªã L·∫¶N ƒê·∫¶U
        if (popupDisplayTime === null) {
            popupDisplayTime = Date.now();
            lastDisplayedTime = scheduledTimeStr; // Ghi l·∫°i m·ªëc th·ªùi gian v·ª´a k√≠ch ho·∫°t
            console.log(`Gemini Popup: Popup ƒë√£ hi·ªÉn th·ªã theo m·ªëc ${lastDisplayedTime}`);
        }
    }
    
    /**
     * Hi·ªÉn th·ªã popup nh·∫Øc nh·ªü (snooze) (GI·ªÆ NGUY√äN)
     */
    function showSnoozePopup() {
        shadowRoot.getElementById('snoozePopup').style.display = 'flex'; 
    }
    
    /**
     * ƒê√≥ng popup nh·∫Øc nh·ªü v√† quay l·∫°i popup ch√≠nh (ƒë·ªÉ ti·∫øp t·ª•c ƒë·ªçc) (GI·ªÆ NGUY√äN)
     */
    function closeSnoozePopup() {
        shadowRoot.getElementById('snoozePopup').style.display = 'none';
        console.log("Gemini Popup: Ti·∫øp t·ª•c t√≠nh th·ªùi gian ƒë·ªçc l≈©y ti·∫øn...");
    }


    /**
     * X·ª≠ l√Ω khi n√∫t "ƒê√£ ƒë·ªçc" c·ªßa popup ch√≠nh ƒë∆∞·ª£c b·∫•m (GI·ªÆ NGUY√äN)
     */
    function handleMainPopupClose() {
        if (!shadowRoot) return;

        // Ch·ªâ x·ª≠ l√Ω n·∫øu popup ch√≠nh ƒëang hi·ªÉn th·ªã
        if (shadowRoot.getElementById('reminderPopup').style.display !== 'flex') {
             return;
        }

        if (popupDisplayTime) {
            const timeElapsed = (Date.now() - popupDisplayTime) / 1000; // Th·ªùi gian ƒë√£ tr√¥i qua (gi√¢y)

            if (timeElapsed < MIN_READ_TIME_SECONDS) {
                // Th·ªùi gian xem qu√° nhanh (< 8s), hi·ªÉn th·ªã popup nh·∫Øc nh·ªü
                console.log(`Gemini Popup: ƒê√£ ƒë√≥ng qu√° nhanh (${timeElapsed.toFixed(2)}s). K√≠ch ho·∫°t popup nh·∫Øc nh·ªü.`);
                showSnoozePopup();
            } else {
                // Th·ªùi gian xem ƒë·ªß (>= 8s), cho ph√©p ƒë√≥ng popup ch√≠nh v√† overlay
                console.log(`Gemini Popup: ƒê√£ xem ƒë·ªß th·ªùi gian (${timeElapsed.toFixed(2)}s). ƒê√≥ng ho√†n to√†n.`);
                shadowRoot.getElementById('reminderOverlay').style.display = 'none';
                shadowRoot.getElementById('reminderPopup').style.display = 'none';
                shadowRoot.getElementById('snoozePopup').style.display = 'none'; 
                popupDisplayTime = null; // Reset th·ªùi ƒëi·ªÉm ch·ªâ khi ƒë√≥ng HO√ÄN TO√ÄN
            }
        } else {
             // Tr∆∞·ªùng h·ª£p kh√¥ng c√≥ popup ƒëang m·ªü
             shadowRoot.getElementById('reminderOverlay').style.display = 'none';
             shadowRoot.getElementById('reminderPopup').style.display = 'none';
             shadowRoot.getElementById('snoozePopup').style.display = 'none';
             popupDisplayTime = null;
        }
    }

    /**
     * H√ÄM M·ªöI: Ki·ªÉm tra xem c√≥ m·ªëc th·ªùi gian n√†o ƒë√£ tr√¥i qua m√† popup ch∆∞a hi·ªÉn th·ªã kh√¥ng.
     * Logic: K√≠ch ho·∫°t n·∫øu th·ªùi gian hi·ªán t·∫°i >= m·ªëc l·ªãch tr√¨nh g·∫ßn nh·∫•t ƒê√É QUA trong ng√†y.
     */
    function checkForPendingReminder() {
        const now = new Date();
        const dayOfWeek = now.getDay();
        
        if (!shadowRoot) return;
        
        // 1. Ki·ªÉm tra xem popup ch√≠nh c√≥ ƒëang hi·ªÉn th·ªã kh√¥ng.
        const popupIsOpen = shadowRoot.getElementById('reminderPopup').style.display === 'flex';
        if (popupIsOpen) {
            return; // ƒê√£ m·ªü, kh√¥ng k√≠ch ho·∫°t l·∫°i
        }
        
        const isScheduledDay = popupSchedule.days.includes(dayOfWeek);

        if (isScheduledDay) {
            let latestScheduledTime = null;
            let latestScheduledTimeStr = null;
            
            // 2. T√¨m m·ªëc th·ªùi gian g·∫ßn nh·∫•t (ch·ªâ gi·ªù/ph√∫t) ƒë√£ tr√¥i qua trong ng√†y h√¥m nay
            popupSchedule.times.forEach(time => {
                // T·∫°o ƒë·ªëi t∆∞·ª£ng Date cho m·ªëc l·ªãch tr√¨nh trong ng√†y h√¥m nay
                const scheduledDate = new Date(now.getFullYear(), now.getMonth(), now.getDate(), time.hour, time.minute, 0);
                
                // N·∫øu m·ªëc n√†y ƒë√£ tr√¥i qua HO·∫∂C ƒëang tr√πng kh·ªõp
                if (now.getTime() >= scheduledDate.getTime()) {
                    // ƒê·ªãnh d·∫°ng HH:mm ƒë·ªÉ so s√°nh v·ªõi lastDisplayedTime
                    const timeStr = `${String(time.hour).padStart(2, '0')}:${String(time.minute).padStart(2, '0')}`;
                    
                    if (!latestScheduledTime || scheduledDate.getTime() > latestScheduledTime.getTime()) {
                        latestScheduledTime = scheduledDate;
                        latestScheduledTimeStr = timeStr;
                    }
                }
            });
            
            // 3. N·∫øu t√¨m th·∫•y m·ªëc ƒë√£ qua V√Ä m·ªëc ƒë√≥ ch∆∞a t·ª´ng ƒë∆∞·ª£c hi·ªÉn th·ªã
            if (latestScheduledTimeStr && latestScheduledTimeStr !== lastDisplayedTime) {
                console.log(`Gemini Popup: ƒêang k√≠ch ho·∫°t popup theo L·ªäCH ƒë√£ qua: ${latestScheduledTimeStr}...`);
                
                // T·∫£i d·ªØ li·ªáu ƒë·ªÉ ki·ªÉm tra v√† hi·ªÉn th·ªã
                loadFromFirebase()
                    .then(() => {
                        // Ch·ªâ hi·ªÉn th·ªã n·∫øu c√≥ kh√°ch h√†ng c·∫ßn nh·∫Øc nh·ªü
                        if (hasReminders()) {
                           // Truy·ªÅn m·ªëc th·ªùi gian v√†o h√†m hi·ªÉn th·ªã
                           showReminderPopup(latestScheduledTimeStr); 
                        } else {
                           // R·∫•t quan tr·ªçng: N·∫øu kh√¥ng c√≥ kh√°ch h√†ng, v·∫´n ghi nh·∫≠n m·ªëc n√†y ƒë√£ "x·ª≠ l√Ω" (coi nh∆∞ ƒë√£ hi·ªÉn th·ªã)
                           // ƒë·ªÉ tr√°nh k√≠ch ho·∫°t l·∫°i sau 60s
                           lastDisplayedTime = latestScheduledTimeStr;
                           console.log("Gemini Popup: ƒê√£ qua m·ªëc, nh∆∞ng kh√¥ng c√≥ kh√°ch h√†ng c·∫ßn nh·∫Øc nh·ªü. C·∫≠p nh·∫≠t lastDisplayedTime.");
                        }
                    })
                    .catch((err) => {
                        console.error("Gemini Popup: Kh√¥ng th·ªÉ hi·ªÉn th·ªã popup do l·ªói t·∫£i data.", err);
                    });
            }
        }
    }

    /**
     * H√†m kh·ªüi ch·∫°y ch√≠nh
     */
    function initialize() {
        try {
            firebase.initializeApp(firebaseConfig);
            database = firebase.database();
        } catch (e) {
            console.warn("Gemini Popup: L·ªói kh·ªüi t·∫°o Firebase (C√≥ th·ªÉ ƒë√£ ƒë∆∞·ª£c kh·ªüi t·∫°o):", e.message);
            if (!database) {
                 database = firebase.database();
            }
        }

        createPopupDOM();
        
        // ƒê·∫£m b·∫£o c·∫£ hai popup v√† overlay ƒë·ªÅu ·∫©n khi kh·ªüi t·∫°o DOM
        shadowRoot.getElementById('reminderOverlay').style.display = 'none';
        shadowRoot.getElementById('reminderPopup').style.display = 'none';
        shadowRoot.getElementById('snoozePopup').style.display = 'none';
        
        // T·∫£i d·ªØ li·ªáu l·∫ßn ƒë·∫ßu ƒë·ªÉ s·∫µn s√†ng
        loadFromFirebase(); 

        // B·∫Øt ƒë·∫ßu b·ªô ƒë·∫øm th·ªùi gian (ch·∫°y sau m·ªói 60s)
        // D√πng h√†m m·ªõi
        setInterval(checkForPendingReminder, 60000);
        
        // Ki·ªÉm tra ngay khi t·∫£i trang ƒë·ªÉ b·∫Øt c√°c m·ªëc th·ªùi gian ƒë√£ tr√¥i qua
        // D√πng h√†m m·ªõi
        checkForPendingReminder();
        
        // *** ƒê√É X√ìA LOGIC setTimeout 10 GI√ÇY ·ªû ƒê√ÇY THEO Y√äU C·∫¶U ***
        
        console.log("Gemini Popup Script ƒë√£ kh·ªüi ch·∫°y.");
    }

    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initialize);
    } else {
        initialize();
    }
})();
</script>


<!-- Script PH√ÇN T√çCH DOANH S·ªê KH√ÅCH H√ÄNG L·ª≤ N√ÄY V√Ä K·ª≤ TR∆Ø·ªöC  -->
<script>
(function() {
    // --- KHAI B√ÅO BI·∫æN TO√ÄN C·ª§C M·ªöI ---
    let popupDisplayTime = null; // Th·ªùi ƒëi·ªÉm popup ch√≠nh ƒë∆∞·ª£c hi·ªÉn th·ªã (d√πng ƒë·ªÉ t√≠nh th·ªùi gian ƒë·ªçc)
    const MIN_READ_TIME_SECONDS = 8; // S·ªë gi√¢y t·ªëi thi·ªÉu ph·∫£i xem popup danh s√°ch
    
    // --- PH·∫¶N 1: T·∫¢I TH∆Ø VI·ªÜN FIREBASE ---
    function loadScript(src, callback) {
        var script = document.createElement('script');
        script.type = 'text/javascript';
        script.async = true;
        script.src = src;
        if (callback) {
            script.onload = callback;
        }
        document.head.appendChild(script);
    }

    loadScript('https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js', function() {
        loadScript('https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js', function() {
            initializeAppLogic();
        });
    });

    // --- PH·∫¶N 2: LOGIC ·ª®NG D·ª§NG CH√çNH ---
    
    function initializeAppLogic() {
        // --- C·∫•u h√¨nh Firebase ---
        const firebaseConfig = {
            apiKey: "AIzaSyCAytujYZAr8jNDeeuXj66iz-1b4dwzZWE",
            authDomain: "quanlykh-8fe2b.firebaseapp.com",
            projectId: "quanlykh-8fe2b",
            storageBucket: "quanlykh-8fe2b.firebasestorage.app",
            messagingSenderId: "285582822541",
            appId: "1:285582822541:web:1465fe68cce97bd830a6c4"
        };
        
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const db = firebase.firestore();

        // --- L·ªãch tr√¨nh popup ---
        const popupSchedule = {
            days: [0, 1, 2, 3, 4, 5, 6],
            times: [
                { hour: 9, minute: 45 },
                { hour: 11, minute: 30 },
                { hour: 14, minute: 36 },
                { hour: 15, minute: 38 },
				{ hour: 16, minute: 38 }
            ]
        };

        // --- C√°c h√†m tr·ª£ gi√∫p ---
        function getCurrentTimeSlot(now = new Date()) {
            const currentHour = now.getHours();
            const currentMinute = now.getMinutes();
            const currentDay = now.getDay();
            if (!popupSchedule.days.includes(currentDay)) return null;
            for (const time of popupSchedule.times) {
                if (currentHour === time.hour && currentMinute === time.minute) {
                    return time;
                }
            }
            return null;
        }

        // --- Ki·ªÉm tra xem ƒë√£ qua b·∫•t k·ª≥ th·ªùi gian thi·∫øt l·∫≠p n√†o trong ng√†y ch∆∞a (Gi·ªØ nguy√™n) ---
        function hasPassedAnyScheduledTime() {
            const now = new Date();
            const dayOfWeek = now.getDay();
            const nowInMinutes = now.getHours() * 60 + now.getMinutes();
            const isScheduledDay = popupSchedule.days.includes(dayOfWeek);

            if (!isScheduledDay) {
                return false;
            }

            return popupSchedule.times.some(time => {
                const scheduledTimeInMinutes = time.hour * 60 + time.minute;
                return nowInMinutes >= scheduledTimeInMinutes; 
            });
        }

        function getCookie(name) {
            const value = `; ${document.cookie}`;
            const parts = value.split(`; ${name}=`);
            if (parts.length === 2) return parts.pop().split(';').shift();
        }

        function formatCurrency(amount) {
            if (typeof amount !== 'number') amount = Number(amount) || 0;
            return new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(amount);
        }

        // --- H√ÄM M·ªöI: ƒê√≥ng Popup Nh·∫Øc Nh·ªü v√† ti·∫øp t·ª•c ƒë·∫øm th·ªùi gian ƒë·ªçc ---
        function closeSnoozePopup() {
            const snoozePopup = document.getElementById('ideco-snooze-popup');
            if (snoozePopup) {
                snoozePopup.style.display = 'none';
            }
            // KH√îNG RESET popupDisplayTime: cho ph√©p t√≠nh th·ªùi gian ƒë·ªçc l≈©y ti·∫øn
            console.log("IDECO Analysis: Ti·∫øp t·ª•c t√≠nh th·ªùi gian ƒë·ªçc l≈©y ti·∫øn sau nh·∫Øc nh·ªü.");
        }

        // --- H√ÄM THAY TH·∫æ closeAndSetCookie: X·ª≠ l√Ω ƒë√≥ng Popup Ch√≠nh ---
        function handleMainPopupClose() {
            const mainPopupOverlay = document.getElementById('ideco-analysis-overlay');
            const snoozePopup = document.getElementById('ideco-snooze-popup');
            
            if (!mainPopupOverlay || mainPopupOverlay.style.display !== 'flex' || !popupDisplayTime) return;

            const timeElapsed = (Date.now() - popupDisplayTime) / 1000;
            
            if (timeElapsed < MIN_READ_TIME_SECONDS) {
                // ƒê·ªçc qu√° nhanh: Hi·ªÉn th·ªã popup nh·∫Øc nh·ªü (l·ªõp ph·ªß 700x300)
                console.log(`IDECO Analysis: ƒê√≥ng qu√° nhanh (${timeElapsed.toFixed(2)}s). K√≠ch ho·∫°t nh·∫Øc nh·ªü.`);
                if (snoozePopup) {
                    snoozePopup.style.display = 'flex'; 
                }
            } else {
                // ƒê·ªçc ƒë·ªß th·ªùi gian: ƒê√≥ng ho√†n to√†n v√† ƒë·∫∑t cookie
                console.log(`IDECO Analysis: ƒê√£ xem ƒë·ªß th·ªùi gian (${timeElapsed.toFixed(2)}s). ƒê√≥ng ho√†n to√†n.`);
                mainPopupOverlay.style.display = 'none';
                if (snoozePopup) {
                    snoozePopup.style.display = 'none';
                }
                popupDisplayTime = null; // Reset th·ªùi gian

                // ƒê·∫∑t cookie
                const now = new Date();
                const timeSlot = getCurrentTimeSlot(now);
                if (timeSlot) {
                    const cookieName = `idecoAnalysisRead_${now.toDateString()}_${timeSlot.hour}_${timeSlot.minute}`;
                    document.cookie = `${cookieName}=true; max-age=86400; path=/`; 
                }
            }
        }
        
        // --- Logic ki·ªÉm tra popup theo l·ªãch m·ªói ph√∫t (Gi·ªØ nguy√™n) ---
        function checkAutoAnalysisPopup() {
            const now = new Date();
            const timeSlot = getCurrentTimeSlot(now);
            
            if (timeSlot) {
                const cookieName = `idecoAnalysisRead_${now.toDateString()}_${timeSlot.hour}_${timeSlot.minute}`;
                const readCookie = getCookie(cookieName);
                
                if (!readCookie) {
                    console.log(`IDECO Analysis: Auto-popup triggered at ${timeSlot.hour}:${timeSlot.minute.toString().padStart(2, '0')}`);
                    showAutoAnalysisPopup(db, now);
                }
            }
        }

        // --- Logic hi·ªÉn th·ªã popup (C·∫≠p nh·∫≠t vi·ªác ghi nh·∫≠n th·ªùi gian) ---
        function showAutoAnalysisPopup(db, now) {
            const analysisRef = db.collection('analysis').doc('latest');
            
            analysisRef.get().then((doc) => {
                if (doc.exists) {
                    const data = doc.data();
                    populatePopupContent(data.analysis, data.summary, new Date(data.lastUpdated), now);
                    
                    // 1. Hi·ªÉn th·ªã popup ch√≠nh
                    document.getElementById('ideco-analysis-overlay').style.display = 'flex';
                    
                    // 2. ·∫®n popup nh·∫Øc nh·ªü (ƒê·∫£m b·∫£o ·∫©n khi popup ch√≠nh m·ªü)
                    const snoozePopup = document.getElementById('ideco-snooze-popup');
                    if(snoozePopup) snoozePopup.style.display = 'none';
                    
                    // 3. Ghi nh·∫≠n th·ªùi gian hi·ªÉn th·ªã L·∫¶N ƒê·∫¶U
                    if (popupDisplayTime === null) {
                        popupDisplayTime = Date.now();
                    }
                    
                } else {
                    console.log('IDECO Analysis: No analysis data found.');
                }
            }).catch((error) => {
                console.error('IDECO Analysis: Error fetching data:', error);
            });
        }

        // --- Logic ƒë·ªï d·ªØ li·ªáu v√†o HTML (Gi·ªØ nguy√™n) ---
        function populatePopupContent(analysisResult, summary, lastUpdated, now) {
            const statsElement = document.getElementById('ideco-analysis-stats');
            const tableBody = document.getElementById('ideco-analysis-table-body');
            const timeString = `${now.getHours()}:${now.getMinutes().toString().padStart(2, '0')}`;
            if (!statsElement || !tableBody) return;

            statsElement.innerHTML = `
                <h3>üìä TI·∫æP C·∫¨N NHANH L·∫†I KH√ÅCH H√ÄNG - ${now.toLocaleDateString('vi-VN')} ${timeString}</h3>
                <div class="ideco-stats-grid">
                    <div class="ideco-stat-item ideco-stat-total"><div class="ideco-stat-number">${analysisResult.length}</div><div class="ideco-stat-label">T·ªîNG KH√ÅCH H√ÄNG</div></div>
                    <div class="ideco-stat-item ideco-stat-bad"><div class="ideco-stat-number">${summary.bad || 0}</div><div class="ideco-stat-label">C·∫¶N QUAN T√ÇM</div></div>
                    <div class="ideco-stat-item ideco-stat-warning"><div class="ideco-stat-number">${summary.warning || 0}</div><div class="ideco-stat-label">C·∫¶N H·ªñ TR·ª¢</div></div>
                    <div class="ideco-stat-item ideco-stat-good"><div class="ideco-stat-number">${summary.good || 0}</div><div class="ideco-stat-label">PH√ÅT TRI·ªÇN T·ªêT</div></div>
                </div>
                <p><em>D·ªØ li·ªáu c·∫≠p nh·∫≠t l√∫c: ${lastUpdated.toLocaleString('vi-VN')}</em></p>
            `;
            
            tableBody.innerHTML = '';
            analysisResult.forEach(customer => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${customer.id}</td>
                    <td>${customer.customerCode}</td>
                    <td>${customer.customerName}</td>
                    <td>${formatCurrency(customer.currentRevenue)}</td>
                    <td>${formatCurrency(customer.previousRevenue)}</td>
                    <td>${customer.growthRate}%</td>
                    <td class="ideco-${customer.statusClass}">${customer.recommendation}</td>
                `;
                tableBody.appendChild(row);
            });
        }

        // --- PH·∫¶N 3: TI√äM HTML V√Ä CSS V√ÄO WEBSITE ---
        
        function setupPopupAndTimers() {
            // --- ƒê·ªãnh nghƒ©a CSS (S·ª≠a l·ªói hi·ªÉn th·ªã popup nh·∫Øc nh·ªü) ---
            const styles = `
                /* Styles c≈© */
                #ideco-analysis-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.7); z-index: 2147483646; justify-content: center; align-items: center; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; color: #333; }
                #ideco-analysis-popup { width: 1000px; max-width: 90%; height: 800px; max-height: 90vh; background-color: white; border-radius: 10px; overflow: hidden; display: flex; flex-direction: column; box-shadow: 0 0 20px rgba(0,0,0,0.4); }
                #ideco-analysis-header { background-color: #e74c3c; color: white; padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; flex-shrink: 0; }
                #ideco-analysis-title { font-size: 20px; font-weight: bold; }
                #ideco-analysis-close-btn { background-color: #3498db; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-size: 14px; }
                #ideco-analysis-content { flex: 1; overflow-y: auto; padding: 20px; }
                .ideco-summary-stats { background-color: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #3498db; }
                .ideco-stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-bottom: 15px; }
                .ideco-stat-item { text-align: center; padding: 10px; border-radius: 5px; }
                .ideco-stat-number { font-size: 24px; font-weight: bold; margin-bottom: 5px; }
                .ideco-stat-label { font-size: 12px; color: #7f8c8d; }
                .ideco-stat-total { background-color: #e8f4fd; color: #3498db; }
                .ideco-stat-bad { background-color: #fde8e8; color: #e74c3c; }
                .ideco-stat-warning { background-color: #fef5e8; color: #f39c12; }
                .ideco-stat-good { background-color: #e8f8ef; color: #27ae60; }
                .ideco-customer-list { width: 100%; border-collapse: collapse; }
                .ideco-customer-list th { background-color: #3498db; color: white; padding: 12px 15px; text-align: left; position: sticky; top: 0; z-index: 10; }
                .ideco-customer-list td { padding: 12px 15px; border-bottom: 1px solid #e0e0e0; }
                .ideco-customer-list tr:hover { background-color: #f5f7fa; }
                .ideco-status-good { color: #27ae60; font-weight: bold; }
                .ideco-status-warning { color: #f39c12; font-weight: bold; }
                .ideco-status-bad { color: #e74c3c; font-weight: bold; }

                /* Styles M·ªöI cho Popup Nh·∫Øc Nh·ªü (Snooze Popup) */
                #ideco-snooze-popup {
                    display: none; /* M·∫∑c ƒë·ªãnh ·∫©n */
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    width: 1200px; /* K√≠ch th∆∞·ªõc m·ªõi */
                    height: 700px; /* K√≠ch th∆∞·ªõc m·ªõi */
                    max-width: 95%;
                    background-color: white; /* M√†u n·ªÅn vui t∆∞∆°i */
                    border: 5px solid #009688; /* M√†u vi·ªÅn */
                    padding: 30px;
                    border-radius: 15px;
                    z-index: 2147483647; /* ƒê·∫£m b·∫£o N·∫∞M TR√äN popup ch√≠nh */
                    box-shadow: 0 8px 25px rgba(0,0,0,0.5);
                    text-align: center;
                    /* Kh√¥ng ƒë·∫∑t display: flex ·ªü ƒë√¢y. S·∫Ω d√πng JS ƒë·ªÉ ƒë·∫∑t display = 'flex' khi c·∫ßn hi·ªÉn th·ªã */
                    flex-direction: column; 
                    justify-content: center;
                    align-items: center;
                }
                #ideco-snooze-popup h2 {
                    color: #009688;
                    font-size: 26px;
                    margin-bottom: 15px;
                    font-weight: bold;
                }
                #ideco-snooze-popup p {
                    font-size: 20px;
                    color: #388e3c;
                    margin-bottom: 25px;
                }
                #ideco-snooze-popup button {
                    background-color: #009688;
                    color: white;
                    padding: 12px 25px;
                    font-size: 18px;
                    border: none;
                    border-radius: 8px;
                    cursor: pointer;
                    font-weight: bold;
                }
                #ideco-snooze-popup button:hover {
                    background-color: #00796b;
                }
            `;
            const styleSheet = document.createElement("style");
            styleSheet.type = "text/css";
            styleSheet.innerText = styles;
            document.head.appendChild(styleSheet);

            // --- ƒê·ªãnh nghƒ©a HTML (B·ªï sung Popup Nh·∫Øc Nh·ªü) ---
            const popupHtml = `
                <div id="ideco-analysis-overlay">
                    <div id="ideco-analysis-popup">
                        <div id="ideco-analysis-header">
                            <div id="ideco-analysis-title">üìä KH√ÅCH H√ÄNG KH√îNG C√ì ƒê∆†N TH√ÅNG TR∆Ø·ªöC H√ÉY H·ªéI L·∫†I NHANH</div>
                            <button id="ideco-analysis-close-btn">ƒê√£ ƒë·ªçc</button>
                        </div>
                        <div id="ideco-analysis-content">
                            <div id="ideco-analysis-stats" class="ideco-summary-stats"><p>ƒêang t·∫£i d·ªØ li·ªáu ph√¢n t√≠ch...</p></div>
                            <table class="ideco-customer-list">
                                <thead><tr><th>STT</th><th>M√£ KH</th><th>Kh√°ch h√†ng</th><th>Doanh thu k·ª≥ n√†y</th><th>Doanh thu k·ª≥ tr∆∞·ªõc</th><th>TƒÉng tr∆∞·ªüng</th><th>Khuy·∫øn ngh·ªã</th></tr></thead>
                                <tbody id="ideco-analysis-table-body"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <div id="ideco-snooze-popup">
                     <h2>üòä B·∫†N C√ì L·∫∫ CH∆ØA ƒê·ªåC K·ª∏ DANH S√ÅCH PH·∫¢I KH√îNG!</h2> 
                     <p>Nhi·ªÅu kh√°ch h√†ng th√°ng tr∆∞·ªõc kh√¥ng l·∫•y ƒë∆°n- b·∫°n n√™n xem k·ªπ m√† t∆∞∆°ng t√°c l·∫°i xem nh√©!</p>
					 <p>H√£y ghi ch√∫ l·∫°i kh√°ch h√†ng n√†o c·∫ßn t∆∞∆°ng t√°c l·∫°i nhanh - t√¨m h∆∞·ªõng t∆∞∆°ng t√°c l·∫°i h·ªç ƒë·ªÉ do h·ªèi l·∫°i !</p>
					 <p>H√£y v√†o ·ª©ng d·ª•ng PH√ÇN T√çCH KPI TH√ÅNG Xem l·∫°i r·ªè h∆°n ƒë·ªÉ c√≥ k·∫ø ho·∫°ch - t∆∞∆°ng t√°c l·∫°i nh√© !</p>
					 <p>T·∫≠n d·ª•ng g√≥i ch√≠nh s√°ch UVS : ƒê·ªïi tr·∫£ - h·ªó tr·ª£ c√¥ng n·ª£- chi·∫øt kh·∫•u cao ; Thu·ªëc th√¨ nhi·ªÅm nh√≥m - ƒëa d·∫°ng ƒë·ªÉ kh∆°i d√¢y c∆° h·ªôi</p>
					 <p>KINH DOANH LU√îN L√Ä T√åM M·ªåI C√ÅCH ƒê·ªÇ B√ÅN TRONG NG√ÄY- TRONG TU·∫§N L√Ä ∆ØU TI√äN H∆†N VI·ªÜC L√ÄM QU√Å L√ÇU THAO T√ÅC M√ÅY T√çNH</p>
                    
					<button id="ideco-snooze-close-btn">Quay l·∫°i danh s√°ch</button>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', popupHtml);
            
            // --- KH·∫ÆC PH·ª§C L·ªñI HI·ªÇN TH·ªä S·ªöM TRI·ªÜT ƒê·ªÇ ---
            // ƒê·∫£m b·∫£o ·∫©n ngay sau khi DOM ƒë∆∞·ª£c ti√™m v√†o body.
            const initialSnoozePopup = document.getElementById('ideco-snooze-popup');
            if (initialSnoozePopup) {
                initialSnoozePopup.style.display = 'none';
            }
            // --- K·∫æT TH√öC KH·∫ÆC PH·ª§C L·ªñI ---


            // G·∫Øn s·ª± ki·ªán click (C·∫≠p nh·∫≠t)
            document.getElementById('ideco-analysis-close-btn').addEventListener('click', handleMainPopupClose);
            document.getElementById('ideco-snooze-close-btn').addEventListener('click', closeSnoozePopup);

            // --- B·∫Øt ƒë·∫ßu ch·∫°y b·ªô h·∫πn gi·ªù (Gi·ªØ nguy√™n logic h·∫πn gi·ªù) ---
            checkAutoAnalysisPopup(); // 1. Ki·ªÉm tra ngay l·∫≠p t·ª©c (Ch·ªâ k√≠ch ho·∫°t n·∫øu kh·ªõp ph√∫t)
            setInterval(checkAutoAnalysisPopup, 60000); // 2. Ki·ªÉm tra m·ªói ph√∫t (Logic ch√≠nh)

            // --- Logic K√≠ch ho·∫°t popup sau 15 gi√¢y n·∫øu ƒëƒÉng nh·∫≠p mu·ªôn (Gi·ªØ nguy√™n) ---
            setTimeout(() => {
                const popupIsCurrentlyOpen = document.getElementById('ideco-analysis-overlay').style.display === 'flex';
                
                if (!popupIsCurrentlyOpen && hasPassedAnyScheduledTime()) {
                    const now = new Date();
                    console.log("IDECO Analysis: K√≠ch ho·∫°t popup 15s sau khi T·∫¢I TRANG v√¨ ƒë√£ qua th·ªùi gian thi·∫øt l·∫≠p.");
                    showAutoAnalysisPopup(db, now); 
                } else if (popupIsCurrentlyOpen) {
                    console.log("IDECO Analysis: B·ªè qua popup 15s v√¨ popup ƒë√£ ƒë∆∞·ª£c hi·ªÉn th·ªã.");
                } else {
                    console.log("IDECO Analysis: Ch∆∞a ƒë·∫øn th·ªùi gian thi·∫øt l·∫≠p popup, kh√¥ng k√≠ch ho·∫°t popup 15s.");
                }
            }, 15000); // 15 gi√¢y

            console.log('IDECO Analysis Popup script (v4) initialized with Read Time Check.');
        }

        // --- ƒê·∫£m b·∫£o ch·∫°y logic sau khi DOM t·∫£i xong ---
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', setupPopupAndTimers);
        } else {
            setupPopupAndTimers();
        }
    }
})();
</script>

<!-- Script THONG BAO CONG NO KHACH HANG -->
<script>
(function() {
    'use strict';

    // --- 1. C·∫§U H√åNH FIREBASE ---
    const firebaseConfig = {
      apiKey: "AIzaSyAT-ddG7Jd1qdwrNlCgfiQ_GyyLoODl5MA",
      authDomain: "notebook-d469b.firebaseapp.com",
      databaseURL: "https" + "://notebook-d469b-default-rtdb.firebaseio.com",
      projectId: "notebook-d469b",
      storageBucket: "notebook-d469b.firebasestorage.app",
      messagingSenderId: "835830453697",
      appId: "1:835830453697:web:ba485de6c981e72fe00b40",
    };

    // --- 2. C·∫§U H√åNH POPUP (GI·ªêNG FILE G·ªêC) ---
    const autoPopupConfig = {
        targetWeekdays: [ 1, 2, 3, 5, 6], // 0 = CN, 1 = T2, ...
        openTimes: [
            {hour: 11, minute: 45 }, 
            {hour: 17, minute: 20}
        ],
    };

    // ƒê∆∞·ªùng d·∫´n th∆∞ vi·ªán
    const FIREBASE_APP_URL = 'https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js';
    const FIREBASE_DB_URL = 'https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js';
    const WIDGET_HOST_ID = 'cong-no-notifier-widget-host';

    // Bi·∫øn to√†n c·ª•c ƒë·ªÉ gi·ªØ data
    let currentOverdueDrugs = [];
    let currentOverdueNonDrugs = [];
    let popupCheckInterval = null;

    // --- 3. H√ÄM T·∫¢I SCRIPT ---
    function loadScript(src, callback) {
        let script = document.createElement('script');
        script.src = src;
        script.defer = true;
        script.onload = callback;
        script.onerror = () => console.error(`[Widget C√¥ng n·ª£] L·ªói t·∫£i script: ${src}`);
        document.head.appendChild(script);
    }

    // --- 4. H√ÄM KH·ªûI T·∫†O WIDGET (CH·ªà POPUP) ---
    function initializeWidget() {
        let hostElement = document.getElementById(WIDGET_HOST_ID);
        if (!hostElement) {
            hostElement = document.createElement('div');
            hostElement.id = WIDGET_HOST_ID;
            document.body.appendChild(hostElement);
        }

        let shadowRoot = hostElement.attachShadow({ mode: 'open' });

        // --- A. CSS cho Popup L·ªõn (L·∫•y t·ª´ file g·ªëc) ---
        const widgetStyle = `
            /* CSS cho Popup L·ªõn */
            .schedule-popup-overlay {
                display: none; /* ·∫®n ban ƒë·∫ßu */
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.8);
                z-index: 2147483647; /* Cao nh·∫•t */
                align-items: center;
                justify-content: center;
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            }
            .schedule-popup-content {
                background: white;
                width: 1300px;
                height: 800px; 
                max-width: 95vw;
                max-height: 90vh;
                border-radius: 15px;
                box-shadow: 0 10px 50px rgba(0,0,0,0.5);
                display: flex;
                flex-direction: column;
                overflow: hidden; 
            }
            .schedule-popup-header {
                background: linear-gradient(135deg, #e74c3c, #c0392b);
                color: white;
                padding: 20px;
                display: flex;
                justify-content: space-between;
                align-items: center;
                flex-shrink: 0;
            }
            .schedule-popup-header h2 {
                margin: 0;
                font-size: 24px;
                display: flex;
                align-items: center;
                gap: 10px;
            }
            .schedule-popup-header .close-btn {
                background: none;
                border: none;
                color: white;
                font-size: 30px;
                cursor: pointer;
                padding: 0 10px;
                opacity: 0.8;
            }
            .schedule-popup-header .close-btn:hover { opacity: 1; }

            .schedule-popup-body {
                padding: 20px;
                overflow-y: auto;
                flex: 1;
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 20px;
                background: #f0f2f5;
            }
            .schedule-section {
                background: #ffffff;
                padding: 20px;
                border-radius: 10px;
                border: 1px solid #e0e0e0;
                overflow: hidden;
                display: flex;
                flex-direction: column;
            }
            .schedule-section h3 {
                color: #2c3e50;
                margin-top: 0;
                margin-bottom: 15px;
                padding-bottom: 10px;
                border-bottom: 2px solid #3498db;
                flex-shrink: 0;
            }
            .schedule-table-container {
                overflow-y: auto;
                flex: 1;
                border: 1px solid #ddd;
                border-radius: 5px;
                background: white;
            }
            .summary-info {
                background: #e8f4fd;
                border: 1px solid #b3d9f7;
                padding: 10px 15px;
                border-radius: 5px;
                margin-bottom: 15px;
                font-weight: 500;
                flex-shrink: 0;
            }
            .schedule-table {
                width: 100%;
                border-collapse: collapse;
                min-width: 600px;
            }
            .schedule-table th {
                background: #34495e;
                color: white;
                padding: 12px 8px;
                text-align: left;
                position: sticky;
                top: 0;
                z-index: 10;
            }
            .schedule-table td {
                padding: 10px 8px;
                border: 1px solid #ddd;
                font-size: 13px;
                color: #333;
            }
            .schedule-table tr:nth-child(even) { background: #f8f9fa; }
            .schedule-table tr:hover { background: #e3f2fd; }
            .paid-row {
                background-color: #e8f5e8 !important;
                text-decoration: line-through;
                opacity: 0.7;
            }

            .schedule-popup-footer {
                padding: 15px 20px;
                background: #f8f9fa;
                border-top: 1px solid #dee2e6;
                display: flex;
                justify-content: center;
                flex-shrink: 0;
            }
            .read-confirm-btn {
                background: linear-gradient(135deg, #27ae60, #219653);
                color: white;
                border: none;
                padding: 12px 40px;
                border-radius: 25px;
                cursor: pointer;
                font-size: 16px;
                font-weight: 600;
                box-shadow: 0 4px 15px rgba(39, 174, 96, 0.3);
                transition: all 0.3s ease;
            }
            .read-confirm-btn:hover {
                background: linear-gradient(135deg, #219653, #1e8449);
                transform: translateY(-2px);
                box-shadow: 0 6px 20px rgba(39, 174, 96, 0.4);
            }
            /* Responsive */
            @media (max-width: 1350px) {
                .schedule-popup-content { width: 95%; height: 90%; }
            }
            @media (max-width: 1024px) {
                .schedule-popup-body { grid-template-columns: 1fr; }
            }
        `;

        // --- B. HTML (Ch·ªâ c√≤n Popup) ---
        const widgetHTML = `
            <div class="schedule-popup-overlay" id="cn-report-popup">
                <div class="schedule-popup-content">
                    <div class="schedule-popup-header">
                        <h2>‚è∞ B√ÅO C√ÅO C√îNG N·ª¢ H√ÄNG NG√ÄY</h2>
                        <button class="close-btn" id="cn-close-report-popup">√ó</button>
                    </div>
                    <div class="schedule-popup-body">
                        <div class="schedule-section">
                            <h3>üíä C√îNG N·ª¢ THU·ªêC</h3>
                            <div class="summary-info" id="cn-drugs-summary">ƒêang t·∫£i...</div>
                            <div class="schedule-table-container">
                                <div id="cn-schedule-drugs-table"></div>
                            </div>
                        </div>
                        <div class="schedule-section">
                            <h3>üì¶ C√îNG N·ª¢ KH√îNG PH·∫¢I THU·ªêC</h3>
                            <div class="summary-info" id="cn-non-drugs-summary">ƒêang t·∫£i...</div>
                            <div class="schedule-table-container">
                                <div id="cn-schedule-non-drugs-table"></div>
                            </div>
                        </div>
                    </div>
                    <div class="schedule-popup-footer">
                        <button class="read-confirm-btn" id="cn-read-confirm-btn">‚úÖ ƒê√É ƒê·ªåC</button>
                    </div>
                </div>
            </div>
        `;

        // C. G·∫Øn v√†o Shadow DOM
        shadowRoot.innerHTML = `<style>${widgetStyle}</style>${widgetHTML}`;

        // D. Tr·∫£ v·ªÅ c√°c element ƒë·ªÉ ƒëi·ªÅu khi·ªÉn
        return {
            reportPopup: shadowRoot.getElementById('cn-report-popup'),
            closeReportBtn: shadowRoot.getElementById('cn-close-report-popup'),
            readConfirmBtn: shadowRoot.getElementById('cn-read-confirm-btn'),
            drugsSummary: shadowRoot.getElementById('cn-drugs-summary'),
            nonDrugsSummary: shadowRoot.getElementById('cn-non-drugs-summary'),
            drugsTable: shadowRoot.getElementById('cn-schedule-drugs-table'),
            nonDrugsTable: shadowRoot.getElementById('cn-schedule-non-drugs-table'),
            shadowRoot: shadowRoot
        };
    }

    // --- 5. C√ÅC H√ÄM X·ª¨ L√ù POPUP V√Ä DATA ---
    
    // C·∫≠p nh·∫≠t data cho popup (t√≥m t·∫Øt)
    function updateSummaryInfo(elements) {
        const drugs = currentOverdueDrugs.length;
        const paidDrugs = currentOverdueDrugs.filter(i => i.isPaid).length;
        const nonDrugs = currentOverdueNonDrugs.length;
        const paidNonDrugs = currentOverdueNonDrugs.filter(i => i.isPaid).length;
        
        if (elements.drugsSummary) {
            elements.drugsSummary.innerHTML = `üìä T·ªïng: ${drugs} | ‚úÖ ƒê√£ tr·∫£: ${paidDrugs} | ‚ö†Ô∏è C√≤n: ${drugs - paidDrugs}`;
        }
        if (elements.nonDrugsSummary) {
            elements.nonDrugsSummary.innerHTML = `üìä T·ªïng: ${nonDrugs} | ‚úÖ ƒê√£ tr·∫£: ${paidNonDrugs} | ‚ö†Ô∏è C√≤n: ${nonDrugs - paidNonDrugs}`;
        }
    }

    // V·∫Ω b·∫£ng (l·∫•y t·ª´ file g·ªëc)
    function displayScheduleTable(container, data) {
        if (!container) return;
        if (data.length === 0) {
            container.innerHTML = `<div style="text-align:center;padding:40px;color:#666;"><h3>üéâ KH√îNG C√ì C√îNG N·ª¢ N√ÄO</h3></div>`;
            return;
        }
        let html = `<table class="schedule-table"><thead><tr><th>STT</th><th>M√É HD</th><th>M√É ƒêH</th><th>KH√ÅCH H√ÄNG</th><th>NG√ÄY THANH TO√ÅN</th><th>S·ªê TI·ªÄN N·ª¢</th><th>NG√ÄY QU√Å H·∫†N</th><th>TR·∫†NG TH√ÅI</th></tr></thead><tbody>`;
        
        const formatCurrency = (amount) => {
            if (amount === undefined || amount === null || isNaN(amount)) return '0';
            const num = parseFloat(String(amount).replace(/[^\d.]/g, ''));
            return isNaN(num) ? '0' : new Intl.NumberFormat('vi-VN').format(num);
        };

        data.forEach((item, i) => {
            const status = item.isPaid ? '‚úÖ ƒê√É THANH TO√ÅN' : '‚ùå CH∆ØA THANH TO√ÅN';
            const color = item.isPaid ? '#27ae60' : '#e74c3c';
            const debtAmountFormatted = item.debtAmount || formatCurrency(item.originalDebtAmount || 0);

            html += `<tr class="${item.isPaid ? 'paid-row' : ''}">
                <td>${i+1}</td>
                <td>${item.invoice || 'N/A'}</td>
                <td>${item.orderCode || 'N/A'}</td>
                <td>${item.customerName || 'N/A'}</td>
                <td>${item.paymentDue || 'N/A'}</td>
                <td style="text-align:right;font-weight:bold;">${debtAmountFormatted}</td>
                <td style="text-align:center;">
                    <span style="background:${item.daysOverdue>30?'#e74c3c':item.daysOverdue>15?'#f39c12':'#f1c40f'};color:white;padding:2px 8px;border-radius:10px;font-weight:bold;">${item.daysOverdue || '0'} ng√†y</span>
                </td>
                <td><span style="color:${color};font-weight:bold;">${status}</span></td>
            </tr>`;
        });
        html += '</tbody></table>';
        container.innerHTML = html;
    }

    // Hi·ªÉn th·ªã popup
    function showWidgetPopup(elements) {
        // C·∫≠p nh·∫≠t b·∫£ng v√† t√≥m t·∫Øt tr∆∞·ªõc khi hi·ªÉn th·ªã
        updateSummaryInfo(elements);
        displayScheduleTable(elements.drugsTable, currentOverdueDrugs);
        displayScheduleTable(elements.nonDrugsTable, currentOverdueNonDrugs);
        
        if (elements.reportPopup) {
            elements.reportPopup.style.display = 'flex';
        }
    }

    // ·∫®n popup
    function hideWidgetPopup(elements) {
        if (elements.reportPopup) {
            elements.reportPopup.style.display = 'none';
        }
    }

    // Ki·ªÉm tra gi·ªù ƒë·ªÉ auto-popup
    function checkAutoPopup(elements) {
        const now = new Date();
        const currentDay = now.getDay();
        const currentHour = now.getHours();
        const currentMinute = now.getMinutes();

        // N·∫øu ƒë√£ ƒë·ªçc b√°o c√°o h√¥m nay th√¨ kh√¥ng hi·ªán
        if (localStorage.getItem('cn_lastReportRead') === now.toDateString()) {
            return;
        }
        
        if (!autoPopupConfig.targetWeekdays.includes(currentDay)) {
            return;
        }

        if (autoPopupConfig.openTimes.some(t => t.hour === currentHour && t.minute === currentMinute)) {
            // Ch·ªâ hi·ªÉn th·ªã n·∫øu c√≥ c√¥ng n·ª£
            if (currentOverdueDrugs.length > 0 || currentOverdueNonDrugs.length > 0) {
                 showWidgetPopup(elements);
            }
        }
    }

    // B·∫Øt ƒë·∫ßu b·ªô ƒë·∫øm
    function startPopupChecker(elements) {
        if (popupCheckInterval) clearInterval(popupCheckInterval);
        checkAutoPopup(elements); 
        popupCheckInterval = setInterval(() => checkAutoPopup(elements), 60000); 
    }

    // --- 6. H√ÄM K·∫æT N·ªêI FIREBASE ---
    function connectFirebase(elements) {
        try {
            if (!firebase.apps.length) {
                firebase.initializeApp(firebaseConfig);
            }
            const rtdb = firebase.database();
            const dbRef = rtdb.ref('appData/currentData');

            // L·∫Øng nghe thay ƒë·ªïi (real-time)
            dbRef.on('value', (snapshot) => {
                if (snapshot.exists()) {
                    const data = snapshot.val();
                    currentOverdueDrugs = data.overdueDrugs || [];
                    currentOverdueNonDrugs = data.overdueNonDrugs || [];
                } else {
                    currentOverdueDrugs = [];
                    currentOverdueNonDrugs = [];
                }
                
                // C·∫≠p nh·∫≠t data cho popup (n·∫øu n√≥ ƒëang m·ªü)
                if (elements.reportPopup.style.display === 'flex') {
                    updateSummaryInfo(elements);
                    displayScheduleTable(elements.drugsTable, currentOverdueDrugs);
                    displayScheduleTable(elements.nonDrugsTable, currentOverdueNonDrugs);
                }

            }, (error) => {
                console.error("[Widget C√¥ng n·ª£] L·ªói ƒë·ªçc Firebase: ", error);
            });

        } catch (error) {
            console.error("[Widget C√¥ng n·ª£] L·ªói kh·ªüi t·∫°o Firebase: ", error);
        }
    }

    // --- 7. CH·∫†Y SCRIPT ---
    console.log("[Widget C√¥ng n·ª£] ƒêang t·∫£i...");
    loadScript(FIREBASE_APP_URL, () => {
        loadScript(FIREBASE_DB_URL, () => {
            console.log("[Widget C√¥ng n·ª£] T·∫£i xong. ƒêang kh·ªüi t·∫°o...");
            
            // 1. Kh·ªüi t·∫°o UI (ch·ªâ popup)
            const elements = initializeWidget();
            
            // 2. G·∫Øn s·ª± ki·ªán cho c√°c n√∫t
            elements.closeReportBtn.addEventListener('click', () => {
                hideWidgetPopup(elements);
            });
            
            elements.readConfirmBtn.addEventListener('click', () => {
                hideWidgetPopup(elements);
                localStorage.setItem('cn_lastReportRead', new Date().toDateString());
            });

            // 3. K·∫øt n·ªëi Firebase (ƒë·ªÉ l·∫•y data)
            connectFirebase(elements);

            // 4. B·∫Øt ƒë·∫ßu b·ªô ƒë·∫øm th·ªùi gian ƒë·ªÉ auto-popup
            startPopupChecker(elements);
        });
    });

})();
</script>


<!-- Script THONG BAO NH·∫ÆC VI·ªÜC -->

<div id="idcr-root">
  <style>
    /* Reset & C√¥ l·∫≠p ho√†n to√†n v·ªõi web g·ªëc */
    #idcr-root {
      all: initial;
      font-family: "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      line-height: 1.6;
      color: #333;
      z-index: 2147483647;
    }
    #idcr-root * { box-sizing: border-box; }

    #idcr-root {
      --c-red: #d32f2f;
      --c-blue: #1565c0;
      --c-yellow: #f9a825;
      --c-white: #ffffff;
      --c-text: #2c3e50;
      --c-bg-overlay: rgba(0, 0, 0, 0.85); /* T·ªëi h∆°n ch√∫t ƒë·ªÉ t·∫≠p trung */
      --c-green-btn: #2e7d32;
    }

    /* --- N√öT B·∫§M DOCK --- */
    #idcr-root .idcr-dock {
      position: fixed; bottom: 10px; left: 10px;
      display: flex; flex-direction: column-reverse; gap: 8px;
      z-index: 2147483640;
    }
    #idcr-root .idcr-btn-group { position: relative; display: flex; align-items: center; }
    
    #idcr-root .idcr-fab {
      width: 15px; height: 15px;
      border-radius: 50%;
      border: 2px solid #fff;
      cursor: pointer;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
      transition: transform 0.2s, box-shadow 0.2s;
    }
    #idcr-root .idcr-fab:hover { transform: scale(1.1); }
    #idcr-root .idcr-fab.is-white { background: var(--c-white); border-color: #ccc; }
    #idcr-root .idcr-fab.is-red   { background: var(--c-red); }
    #idcr-root .idcr-fab.is-blue  { background: var(--c-blue); }
    #idcr-root .idcr-fab.is-yellow{ background: var(--c-yellow); }

    /* Tooltip */
    #idcr-root .idcr-tooltip {
      position: absolute; left: 100%; margin-left: 10px;
      background: #222; color: #fff;
      padding: 4px 8px; border-radius: 4px;
      font-size: 11px; font-weight: 500;
      white-space: nowrap; opacity: 0; visibility: hidden;
      transition: 0.2s; pointer-events: none;
    }
    #idcr-root .idcr-tooltip::before {
      content: ""; position: absolute; right: 100%; top: 50%; transform: translateY(-50%);
      border: 5px solid transparent; border-right-color: #222;
    }
    #idcr-root .idcr-btn-group:hover .idcr-tooltip { opacity: 1; visibility: visible; }

    /* --- POPUP (MODAL) --- */
    #idcr-root .idcr-overlay {
      position: fixed; inset: 0;
      background: var(--c-bg-overlay);
      backdrop-filter: blur(3px);
      display: flex; align-items: center; justify-content: center;
      opacity: 0; visibility: hidden;
      transition: all 0.3s ease;
      z-index: 2147483645;
      padding: 15px;
    }
    #idcr-root .idcr-overlay.is-active { opacity: 1; visibility: visible; }

    #idcr-root .idcr-modal {
      background: #fff;
      width: 100%; 
      max-width: 1200px;
      max-height: 95vh;
      display: flex; flex-direction: column;
      border-radius: 12px;
      box-shadow: 0 25px 50px rgba(0,0,0,0.5);
      transform: scale(0.95); transition: transform 0.3s;
      border-top: 8px solid #ccc;
      overflow: hidden;
    }
    #idcr-root .idcr-overlay.is-active .idcr-modal { transform: scale(1); }

    #idcr-root .idcr-modal.theme-red    { border-top-color: var(--c-red); }
    #idcr-root .idcr-modal.theme-blue   { border-top-color: var(--c-blue); }
    #idcr-root .idcr-modal.theme-yellow { border-top-color: var(--c-yellow); }
    
    /* Hi·ªáu ·ª©ng ch·ªõp t·∫Øt li√™n t·ª•c */
    #idcr-root .idcr-modal.is-blinking  { animation: idcr-blink 1s infinite; }
    
    @keyframes idcr-blink { 
      0% { border-top-color: inherit; box-shadow: 0 0 0 0 rgba(255,0,0,0); }
      50% { border-top-color: transparent; box-shadow: 0 0 20px 5px rgba(255, 0, 0, 0.3); } 
      100% { border-top-color: inherit; box-shadow: 0 0 0 0 rgba(255,0,0,0); }
    }

    /* Header & N√∫t ƒê√É ƒê·ªåC */
    #idcr-root .idcr-header {
      padding: 10px 20px;
      display: flex; justify-content: flex-end;
      border-bottom: 1px solid #eee;
      background: #f9f9f9;
      flex-shrink: 0;
    }
    /* Thay ƒë·ªïi style n√∫t ƒë√≥ng th√†nh n√∫t x√°c nh·∫≠n */
    #idcr-root .idcr-read-btn {
      background: var(--c-green-btn); 
      border: none;
      font-size: 16px; font-weight: 700; color: #fff;
      cursor: pointer; padding: 10px 30px; border-radius: 4px;
      transition: 0.2s;
      box-shadow: 0 4px 6px rgba(0,0,0,0.2);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    #idcr-root .idcr-read-btn:hover { background: #1b5e20; transform: translateY(-1px); box-shadow: 0 6px 8px rgba(0,0,0,0.3); }
    #idcr-root .idcr-read-btn:active { transform: translateY(0); }

    /* Body */
    #idcr-root .idcr-body {
      padding: 35px 50px;
      overflow-y: auto;
      flex: 1;
      font-size: 17px;
      color: var(--c-text);
    }

    /* ƒê·ªãnh d·∫°ng vƒÉn b·∫£n */
    #idcr-root .idcr-body h2 {
      margin-top: 0; margin-bottom: 25px;
      font-size: 26px;
      text-transform: uppercase; border-bottom: 2px solid #eee; padding-bottom: 12px;
    }
    #idcr-root .idcr-body h3 {
      font-size: 19px; color: #444; margin-top: 30px; margin-bottom: 12px;
      font-weight: 700; background: #f0f2f5; padding: 8px 12px; border-radius: 4px; display: inline-block;
    }
    #idcr-root .idcr-body p { margin-bottom: 18px; text-align: justify; }
    #idcr-root .idcr-body ul { padding-left: 25px; margin-bottom: 18px; }
    #idcr-root .idcr-body li { margin-bottom: 8px; }
    #idcr-root .idcr-body a { color: var(--c-blue); text-decoration: underline; }

    #idcr-root .idcr-body::-webkit-scrollbar { width: 10px; }
    #idcr-root .idcr-body::-webkit-scrollbar-track { background: #f1f1f1; }
    #idcr-root .idcr-body::-webkit-scrollbar-thumb { background: #bdbdbd; border-radius: 5px; }
    #idcr-root .idcr-body::-webkit-scrollbar-thumb:hover { background: #9e9e9e; }
  </style>

  <div class="idcr-dock">
    <div class="idcr-btn-group">
      <button class="idcr-fab is-white" data-type="white"></button>
      <span class="idcr-tooltip">Th√¥ng b√°o chung</span>
    </div>
    <div class="idcr-btn-group">
      <button class="idcr-fab is-red" data-type="red"></button>
      <span class="idcr-tooltip">QUAN TR·ªåNG - KH·∫®N</span>
    </div>
    <div class="idcr-btn-group">
      <button class="idcr-fab is-blue" data-type="blue"></button>
      <span class="idcr-tooltip">Nh·∫Øc vi·ªác th√¥ng tin</span>
    </div>
    <div class="idcr-btn-group">
      <button class="idcr-fab is-yellow" data-type="yellow"></button>
      <span class="idcr-tooltip">L·ªùi khuy√™n / L∆∞u √Ω</span>
    </div>
  </div>

  <div class="idcr-overlay" id="idcrOverlay">
    <div class="idcr-modal" id="idcrModal">
      <div class="idcr-header">
        <button class="idcr-read-btn" id="idcrReadBtn">‚úî T√îI ƒê√É ƒê·ªåC & HI·ªÇU</button>
      </div>
      <div class="idcr-body" id="idcrContent">
      </div>
    </div>
  </div>
</div>

<template id="tpl-white">
    <h2 style="color: #777">‚ö™ H∆Ø·ªöNG D·∫™N H·ªòI NH·∫¨P CHO NH√ÇN VI√äN M·ªöI</h2>
    <h3>1Ô∏è‚É£ PH·ª§ TR√ÅCH ƒêI·ªÄU PH·ªêI KINH DOANH - PH√ÅT TRI·ªÇN KINH DOANH</h3>
    <p>Nghe podcast "GI·ªöI THI·ªÜU PH·∫¶N H·ªòI NH·∫¨P". - Ph·∫ßn podcast- video n√†o c√≥ n·ªôi dung danh nh√¢n vi√™n m·ªõi h·ªôi nh·∫≠p  h√£y xem qua -  Quy ƒê·ªãnh c√¥ng ty tr√™n ERP.</p>
	<p>N√™n l·∫≠p cho m√¨nh k·∫ø ho·∫°ch h·ªôi nh·∫≠p t√¨m hi·ªÉu c√¥ng vi·ªác theo tu·∫ßn r·ªè r√†ng - mu·ªën v·∫≠y c√≥ th·ªÉ h·ªèi hay tham kh·∫£o IDECO BOT - Xem m·∫´u Prompt t·∫°i m·ª•c 7 tr√™n ERP</p>
     <p>Ch·ªß ƒë·ªông t√¨m hi·ªÉu danh m·ª•c- ch√≠nh s√°ch 2 nh√≥m s·∫£n ph·∫©m c√¥ng ty t·∫°i: C√îNG C·ª§ QU·∫¢N L√ù g√≥c ph·∫£i ERP - Menu tra c·ª©u thu·ªëc- DMP</p>
	 <p>Xem - nghe : C√°ch l√™n ƒë∆°n h√†ng - C√°ch x·ª≠ l√Ω g·ªçi kh√°ch h√†ng ƒë∆∞·ª£c giao - c√°ch qu·∫£n l√Ω chu·ªói nh√† thu·ªëc.</p>
	  <p>Xem v√† nghe: C√°ch l·∫≠p k·∫ø ho·∫°ch - l·ªói l·∫≠p k·∫ø ho·∫°ch - C√°ch b√°o c√°o giao d·ªãch kh√°ch h√†ng - C√°c n·ªôi dung kinh doanh c·∫ßn n·∫Øm, c·∫ßn tr√°nh </p>
	 <p>C√°c ·ª©ng d·ª•ng cƒÉn b·∫£n: kinh doanh ph·∫£i th√†nh th·∫£o: ·ª®ng d·ª•ng qu·∫£n l√Ω kh√°ch h√†ng ƒë·∫∑t h√†ng - ·ª®ng d·ª•ng Ki·ªÉm tra gi√° CNT - ·ª®ng d·ª•ng AI ch·∫°y b·∫£ng d·ªØ l·ªáu ƒë∆°n h√†ng chu·ªói NT</p>
	 <p> ·ª®ng d·ª•ng ph·∫£i n·∫Øm : C√°ch l√™n ƒë∆°n h√†ng ERP Menu ƒë∆°n h√†ng - B√°o c√°o ho·∫°t ƒë·ªông giao d·ªãch - Qu·∫£n l√Ω ƒë·∫∑t h√†ng</p>
	 <p>Ngo√†i ra t·∫°i icon "C√îNG C·ª§ QL" g√≥c ph·∫£i ERP: c√°c ·ª©ng d·ª•ng: l·∫≠p checklist - tra c·ª© gi√° & l√†m b·∫£ng ch√†o gi√°  - Theo d√µi c√¥ng n·ª£.</p>
	 <p>N√äN T·∫¨P T∆Ø∆†NG T√ÅC KH√ÅCH H√ÄNG ƒê√É GIAO - K·∫æT H·ª¢P C√ôNG ƒê·ªíNG NGHI·ªÜP X·ª¨ L√ù ƒê∆†N H√ÄNG - XEM M·∫™U S·∫¢N PH·∫®M - ƒê·ªåC K·ª∏ QUY ƒê·ªäNH KINH DOANH - NGHE TH√äM PODCAST - VIDEO</p>
	 <p>T√¨m hi·ªÉu n·ªôi dung ERP ch√≠nh c√°c ·ª©ng d·ª•ng: Xem b√°o c√°o XNT - Menu v√†o ƒë∆°n h√†ng - B√°o c√°o kinh doanh  - C√°ch khai m√£ kh√°ch h√†ng - C√°ch xem c√¥ng n·ª£ kh√°ch h√†ng</p>
	 <p>C√°c ·ª©ng d·ª•ng cƒÉn b·∫£n: kinh doanh ph·∫£i th√†nh th·∫£o: ·ª®ng d·ª•ng qu·∫£n l√Ω kh√°ch h√†ng ƒë·∫∑t h√†ng - ·ª®ng d·ª•ng Ki·ªÉm tra gi√° CNT - ·ª®ng d·ª•ng AI ch·∫°y b·∫£ng d·ªØ l·ªáu ƒë∆°n h√†ng chu·ªói NT</p>
	 <p>Ngo√†i ra t·∫°i icon "C√îNG C·ª§ QL" g√≥c ph·∫£i ERP: c√°c ·ª©ng d·ª•ng: l·∫≠p checklist - tra c·ª© gi√° & l√†m b·∫£ng ch√†o gi√° - xem ch∆∞∆°ng tr√¨nh KM - Ph√¢n t√≠ch DS k·ª≥ n√†y...</p>
	 <p>L·ªùi khuy√™n: danh th·ªùi gian xem c√°c n·ªôi dung kinh doanh- k·ªπ nƒÉng telesales - c√°ch x·ª≠ l√Ω b√°n h√†ng - c√°ch l·∫≠p k·∫ø ho·∫°ch tu·∫ßn - c√°c ƒëi·ªÅu kinh doanh c·∫ßn n·∫Øm.</p>
	
	<h3>2Ô∏è‚É£ PH·ª§ TR√ÅCH ƒêI·ªÄU PH·ªêI KHO </h3>
    <p>Nghe - xem c√°c video - podcast gi·ªõi thi·ªáu h·ªôi nh·∫≠p chung c·∫£ kinh doanh - c√°c video c√≥ li√™n quan ƒë·∫øn kho -k·∫ø to√°n </p>
	 <p>T√¨m hi·ªÉu c√¥ng c·ª• qu·∫£n l√Ω c√¥ng vi·ªác v√† tri·ªÉn khai: L·∫≠p checklist - l·∫≠p k·∫ø ho·∫°ch - Xem video - podcast h∆∞·ªõng d·∫´n</p>
	<p>Nghe podcast GDP l√† g√¨ -M√¥ t·∫£ c√¥ng vi·ªác SOP l√† g√¨ - Xem k·ªπ Quy ƒë·ªãnh c√¥ng ty trong ƒë√≥ ph·∫ßn n·ªôi dung quy ƒë·ªãnh kho - ph√¢n quy·ªÅn kho.</p>
	<p>Ph·ª• tr√°ch kho c·∫ßn ph·∫£i n·∫Øm r·ªè: Danh m·ª•c thu·ªëc b√°n- danh m·ª•c d∆∞·ª£c m·ªπ ph·∫©m - ch√≠nh s√°ch b√°n ƒë·ªÉ qu·∫£n l√Ω ph·ªëi h·ª£p h√†ng h√≥a ƒë√∫ng sao n√†y.</p>
	<p>Ph·∫ßn m·ªÅm ERO ph·∫£i n·∫Øm ro c√°c ·ª©ng d·ª•ng li√™n quan kho: B√°o c√°o XNT- TK phi·∫øu xu·∫•t nh·∫≠p - Menu Nh√† kho ( xu·∫•t - nh·∫≠p - nh·∫≠p kho kh√°ch h√†ng - ki·ªÉm kho)</p>
	<p>·ª®ng d·ª•ng AI tr√≠ch xu·∫•t phi·∫øu nh·∫≠n - l·∫≠p - ·ª®ng d·ª•ng ƒë√≥ng g√≥i - giao h√†ng - ·ª®ng d·ª•ng ki·ªÉm tra l√¥ date theo ·∫£nh : ph·∫£i h·ªèi t√¨m hi·ªÉu c√°ch v·∫≠n h√†nh th√¥ng th·∫°o</p>
	<p>Th√†nh vi√™n ph·ª• tr√°ch kho giao nh·∫≠n: ph·∫£i h·ªèi n·∫Øm c√°ch khai nh√£n giao nh·∫≠n c√°c ƒë∆°n v·ªã v·∫≠n chuy·ªÉn - Nh·∫•t T√≠n- Viettel- ƒê∆°n v·ªã kh√°c th√¥ng th·∫°o- n√™n h·ªèi n·∫Øm</p>
	<p>Th√†nh vi√™n ph·ª• tr√°ch kho giao nh·∫≠n: ph·∫£i xem t√†i li·ªáu SOP- quy ƒë·ªãnh qu·∫£n l√Ω kho d∆∞·ª£c - n·∫Øm kh√™ khai phi·∫øu nh·∫≠p xu·∫•t kho theo thu·ªëc quy ƒë·ªãnh</p>
	<p>Ch·ªß ƒë·ªông ki·ªÉm tra h√†ng h√≥a - ph√¢n lo·∫°i tr∆∞·ªõc khi khai nh·∫≠p kho - xu·∫•t kho th·ªß t·ª•c n√†y ph·∫£i lu√¥n n·∫Øm- h·ªèi tra c·ª©u ƒë·ªÉ ƒë·∫£m b·∫£o GDP - SOP</p>
	<p>N·∫Øm c√°ch nh·∫≠p li·ªáu phi·∫øu nh·∫≠n h√†ng - ch·∫°y d·ªØ li·ªáu nhi·ªát ƒë·ªô kho - in l∆∞u tr·ªØ phi·∫øu li√™n quan ƒë·∫øn XNT ph·∫£i tuy·ªát ƒë·ªëi th·ª±c hi·ªán.</p>
	
    <h3>3Ô∏è‚É£ PH·ª§ TR√ÅCH K·∫æ TO√ÅN  </h3>
     <p>Nghe podcast "GI·ªöI THI·ªÜU PH·∫¶N H·ªòI NH·∫¨P". Xem k·ªπ Quy ƒê·ªãnh c√¥ng ty tr√™n ERP.</p>
	 <p>Nghe- xem podcast- video gi·ªõi thi·ªáu v·ªÅ nh√≥m h√†ng - ng√†nh h√†ng c√¥ng ty chung.</p>
	 <p>K·∫ø to√°n m·ªõi h·ªôi nh·∫≠p: Danh th·ªùi gian t√¨m hi·ªÉu h·ªá sinh th√°i tr√™n ERP theo chia s·∫Ω b√™n c·∫°nh Qu·∫£n l√Ω k·∫ø to√°n h∆∞·ªõng d·∫´n chuy√™n m√¥n tr√™n MISA</p>
	 <p>Giai ƒëo·∫°n ƒë·∫ßu: K·∫ø to√°n s·∫Ω n·∫±m -tri·ªÉn khai nhi·ªám v·ª• K·∫æ TO√ÅN B√ÅN H√ÄNG - KHO - C√îNG N·ª¢ THU  ƒë·ªÉ n·∫Øm d·∫ßn -t·∫≠p trung ƒë·ªãnh h∆∞·ªõng n√†y theo ch·ªâ ƒë·∫°o BGƒê</p>
	 <il> 
	 <p>T√¨m hi·ªÉu v·ªÅ danh m·ª•c s·∫£n ph·∫©m m·ªüi icon" C√îNG C·ª§ QL" g·ªìm tra c·ª©u thu·ªëc- tra c·ª©u DMP ƒë·ªÉ t√¨m hi·ªÉu nh√≥m h√†ng- ch√≠nh s√°ch b√°n h√†ng li√™n quan ƒë·∫øn h√≥a ƒë∆°n b√°n.</p>
     <p>T√¨m hi·ªÉu c√°ch l·∫≠p CHECKLIST- K·∫æ HO·∫†CH: li√™n quan ƒë·∫øn t·ªï ch·ª©c theo d√µi c√¥ng vi·ªác sao n√†y t·ªët h∆°n</p>
	 <p>T√¨m hi·ªÉu c√°c Menu ch√≠nh c√≥ li√™n quan ƒë·∫øn k·∫ø to√°n: B√°o c√°o t√†i ch√≠nh- b√°o c√°o kinh doanh- khai b√°o s·∫£n ph·∫©m - ƒë∆°n h√†ng mua -C√¥ng n·ª£ kh√°ch h√†ng - Thu n·ª£/ Tr·∫£ n·ª£ ..</p>
	 <p>Ti·∫øp t·ª•c tr√™n Menu ch√≠nh ERP: Phi·∫øu thu- phi·∫øu chi - T·∫°m ·ª©ng ( h·ªèi c·∫•p tr√™n c√°ch v√†o - xem - l·∫≠p - x√°c nh·∫≠n- duy·ªát cho k·ªπ v√¨ li√™n quan ƒë·∫øn k√™ khai h·ªá th·ªëng.</p>
	 <p>T√¨m hi·ªÉu c√°c c√¥ng c·ª• ·ª©ng d·ª•ng AI li√™n quan ƒë·∫øn k·∫ø to√°n: B·ªô ph·∫≠n ph√°p ch·∫ø AI - Ph√¢n t√≠ch k·∫ø to√°n- IDECO BOT l√† nh·ªØng c√¥ng c·ª• h·ªó tr·ª£ nghi·ªáp v·ª• k·∫ø to√°n khi c·∫ßn.</p>
	 <p>Ch·ªß ƒë·ªông l·∫≠p k·∫ø ho·∫°ch trong tu·∫ßn c√°c n·ªôi dung t√¨m hi·ªÉu- tr√¨nh b√†y k·∫ø ho·∫°ch cho c·∫•p qu·∫£n ƒë·ªÉ h∆∞·ªõng d·∫´n c√°ch t√¨m hi·ªÉu t·ªët h∆°n </p>
	 </il> 
	 <p>Ph√¢n nghi·ªáp v·ª• chuy√™n m√¥n: c·∫ßn t√¨m hi·ªÉu video- podcast v·ªÅ k·∫ø to√°n tr√™n ERP - k·∫øt h·ª£p n√™n xem th√™m ·ªü nh√†.</p>
	  <p>T√¨m hi·ªÉu v·ªÅ danh m·ª•c s·∫£n ph·∫©m m·ªüi icon" C√îNG C·ª§ QL" g·ªìm tra c·ª©u thu·ªëc- tra c·ª©u DMP ƒë·ªÉ t√¨m hi·ªÉu nh√≥m h√†ng- ch√≠nh s√°ch b√°n h√†ng li√™n quan ƒë·∫øn h√≥a ƒë∆°n b√°n.</p>
	 <il>
	 <p>Ph·∫ßn Misa khai b√°o- c·∫•p qu·∫£n l√Ω chia s·∫Ω tr·ª±c ti·∫øp: c·∫ßn n·∫Øm hi·ªÉu c√°ch khai h√†ng h√≥a theo m√£ th·ªëng nh·∫•t tr√™n 2 ph·∫ßn m·ªÅm MISA-ERP </p>
	 <p>Xem- nghe ph·∫ßn chia s·∫Ω quy ƒë·ªãnh - quy tr√¨nh k·∫ø to√°n -kho v·∫≠n - k·∫ø to√°n b√°n h√†ng- k·∫ø to√°n mua h√†ng v√† c√°c n·ªôi dung li√™n quan ƒë·∫øn k·∫ø to√°n</p>
	 <p>CH·ª¶ ƒê·ªòNG T∆Ø∆†NG T√ÅC V·ªöI C√ÅC TH√ÄNH VI√äN C√îNG TY - X·ª¨ L√ù T√åNH HU·ªêNG TH·ª∞C T·∫æ- N·∫ÆM - H·ªéI V√Ä TRA C·ª®U NHANH</p>
	 <il>
	
	<p>Link c√†i ƒë·∫∑t: <a href="https://congtyideco.github.io/mobile" target="_blank">congtyideco.github.io/mobile</a></p>
</template>

<template id="tpl-red">
    <h2 style="color: #d32f2f">üî¥ N·ªòI DUNG C√îNG VI·ªÜC CHUNG</h2>
    
    
    <h3>1Ô∏è‚É£ THEO D√ïI C√îNG VI·ªÜC CHUNG </h3>
    <p>C√°c em nh·ªõ ƒë·ªãnh k·ª≥ xem l·∫°i ƒê·ªãnh H∆∞·ªõng Th√°ng- Giao vi·ªác Tu·∫ßn- KPI ƒë·ªÉ ƒëi·ªÅu ch·ªânh m·ª•c ti√™u - vi·ªác ho√†n th√†nh nh√©</p>
	<p>Quy ƒë·ªãnh cty xem l·∫°i n·∫øu qu√™n - n·∫Øm r·ªè - v·∫≠n h√†nh- ƒë·∫∑c bi·ªát c√°c ·ª©ng d·ª•ng AI n√™n t·∫≠p ƒë∆∞a v√†o c√¥ng vi·ªác ƒë·ªÉ n√¢ng cao hi·ªáu su·∫•t</p>
    <p>C√°c n·ªôi dung Xu·∫•t- nh·∫≠p h√†ng ph·∫£i lu√¥n ki·ªÉm tra ch·ª©ng t·ª´ - h√†ng h√≥a k·ªπ khi nh·∫≠p kho - xu·∫•t kho , tr√°nh s√≥t ph·∫ßn n√†y trong SOP</p>
    <p>Khai b√°o ·ª©ng d·ª•ng ƒë·ªÉ truy xu·∫•t nhanh: l√¥ - h·∫°n d·ª•ng- t·ªìn kho - form m·∫´u ph·∫£i khai li·ªÅn trong ph√°t sinh - ƒë·ª´ng ƒë·ªÉ d·ªìn t√≠ch -d·ªÖ qu√™n!</p>
	
	<h3>2Ô∏è‚É£ CHECKLIST - K·∫æ HO·∫†CH - XEM L·∫†I ƒê·ªäNH H∆Ø·ªöNG NH√â! </h3>
    <ul>
        <li>Ki·ªÉm tra l·∫°i k·∫ø ho·∫°ch, b·ªï sung n·∫øu c√≥ ph√°t sinh - khai b√°o c√°o r·ªè- c·ª• th·ªÉ ngay ƒë·ªÉ kh√¥ng c·∫ßn ph·∫£i l√†m cu·ªëi tu·∫ßn.</li>
        <li>Ch·ª©ng t·ª´ mua/b√°n: Nh·∫≠p li·ªáu ƒë·ªìng b·ªô Misa & ERP - khi c√≥ thanh tra ki·ªÉm tra ph·∫£i c√≥ ƒë·ªß b·∫±ng ch·ª©ng cung c·∫•p s·ªë li·ªáu - n√™n in l∆∞u</li>
        <li>Ph·∫ßn nhi·ªám v·ª• n√†o trao ƒë·ªïi giao vi·ªác m√† c√≥ t√≠nh ƒë·ªãnh k·ª≥ n√™n khai b·ªï sung Checklist ƒë·ªÉ theo d√µi </li>
    </ul>

    <h3>3Ô∏è‚É£ CHUY√äN M√îN - NGHI·ªÜP V·ª§ </h3>
    <p>ƒê∆°n h√†ng c·ªë g·∫Øng ƒë√≥ng & giao trong bu·ªïi s√°ng c√†ng t·ªët - nh·ªõ khai ·ª©ng d·ª•ng ƒë√∫ng h√†ng- khi giao h√†ng ph·∫£i khai giao ƒë·ªß .<br>
    S·∫£n ph·∫©m l·ªói: L·∫≠p vƒÉn b·∫£n, h·∫°ch to√°n tr·∫£ v·ªÅ ƒë√∫ng nghi·ªáp v·ª• k·∫ø to√°n- SOP c·∫ßn l·∫≠p form k√Ω theo ƒë·ªÉ l∆∞u theo d√µi.<br>
   H√†ng thu·ªëc nh·∫≠p v·ªÅ -Ph·∫£i tu√¢n th·ªß quy ƒë·ªãnh SOP : phi·∫øu giao h√†ng - l·∫≠p ngay bi√™n b·∫£ng - l∆∞u chia s·∫Ω cho b·ªô ph·∫≠n ƒë·ªÉ khai tr√™n Misa-ERP ƒë√∫ng quy d·ªãnh   
   Ki·ªÉm kho ƒë·ªãnh k·ª≥: 1 th√°ng/l·∫ßn c√πng team K·∫ø to√°n kho v·∫≠n : ki·ªÉm c·∫£ s·ªë li·ªáu MISA -ERP v√† th·∫≠t t·∫ø - nghi·ªám thu - k√Ω ƒë√≥ng bi√™n b·∫£ng r·ªè r√†ng.</p>
    
    <h3>4Ô∏è‚É£ L∆ØU √ù QUAN TR·ªåNG KH√ÅC (B·ªï sung)</h3>
    <p>Khi th·ª±c hi·ªán c√°c nghi·ªáp v·ª• tr√™n ph·∫ßn m·ªÅm, c·∫ßn ch√∫ √Ω t√≠nh ch√≠nh x√°c c·ªßa d·ªØ li·ªáu. Vi·ªác sai l·ªách s·ªë li·ªáu gi·ªØa kho th·ª±c t·∫ø v√† ph·∫ßn m·ªÅm s·∫Ω d·∫´n ƒë·∫øn kh√≥ khƒÉn trong vi·ªác ki·ªÉm k√™ cu·ªëi k·ª≥. Do ƒë√≥, y√™u c·∫ßu m·ªçi nh√¢n vi√™n khi xu·∫•t nh·∫≠p h√†ng ph·∫£i c·∫ßm thi·∫øt b·ªã v√† qu√©t m√£ v·∫°ch ngay t·∫°i ch·ªó, tuy·ªát ƒë·ªëi kh√¥ng ƒë∆∞·ª£c "nh·ªõ mang m√°ng" r·ªìi nh·∫≠p sau.</p>
    <p>ƒê·ªëi v·ªõi c√°c ƒë∆°n h√†ng ƒëi t·ªânh, c·∫ßn ch·ª•p ·∫£nh ki·ªán h√†ng tr∆∞·ªõc khi giao cho ƒë∆°n v·ªã v·∫≠n chuy·ªÉn ƒë·ªÉ l√†m b·∫±ng ch·ª©ng x·ª≠ l√Ω khi·∫øu n·∫°i (n·∫øu c√≥) sau n√†y.</p>
    <p>L√†m vi·ªác ƒë·ªëi nh√≥m: ph·∫£i c√πng nhau quan s√°t vi·ªác - ki·ªÉm tra - b√°o c√°o- c·∫≠p nh·∫≠t , ƒë·∫∑c bi·ªát l∆∞u √Ω ƒë·∫øn khai s·ªë li·ªáu h·ªá th·ªëng ph·∫ßn m·ªÅm</p>
</template>

<template id="tpl-blue">
    <h2 style="color: #1565c0">üîµ KINH DOANH -KHO V·∫¨N </h2>
    <h3>1Ô∏è‚É£ KH√ÅCH H√ÄNG M·ªöI</h3>
    <p>Do kh√°ch h√†ng lu√¥n ph√°t sinh t·ª´ ch·ªëi- lu√¥n tr√¨ ho√£n m√† Doanh thu ch√∫ng ta ph·∫£i c·∫ßn ch·ªët trong tu·∫ßn- cu·ªëi th√°ng n√™n:</p>
    <p>K·∫ø ho·∫°ch l·∫≠p n√™n ƒë·ªÅ ra m·ª•c ti√™u m·ªü kh√°ch h√†ng m·ªõi m·ªói ng√†y - tu·∫ßn v√† khai b√°o B√°o c√°o giao d·ªãch r·ªè r√†ng, c·∫≠p nh·∫≠t r·ªè - theo d√µi l·ªãch h·∫πn s√°t sao</p>
    <p>Ngo√†i b√°o c√°o t·ª´ ·ª©ng d·ª•ng tra c·ª©u Thu·ªëc- DMP th√¨ c√≤n c√≥ b√°o gi√° b·∫≥ng ·∫£nh poster  tr√™n C√îNG C·ª§ QU·∫¢N L√ù  menu g·∫ßn cu·ªëi ƒë·ªÉ √°p d·ª•ng</p>
    <p>Khi khai th√°c kh√°ch h√†ng m·ªõi: n√™n xem l·∫°i ƒê·ªäNH H∆Ø·ªöNG KHU V·ª∞C - KPI  ƒë·ªÉ x√∫c ti·∫øn - c·∫ßn thi·∫øt xem- nghe PODCAST-Video n√≥i v·ªÅ k·ªπ nƒÉng- c√°ch ch·ªët Sales th√™m</p>

   <h3>2Ô∏è‚É£ KH√ÅCH H√ÄNG HI·ªÜN T·∫†I ƒêANG H·ª¢P T√ÅC - ƒê√É GIAO</h3>
    <p>lu√¥n qu·∫£n l√Ω ·ª®NG D·ª§NG KH√ÅCH H√ÄNG ƒë·∫∑t h√†ng, khai b√°o - theo d√µi s√°t ƒë·ªÉ ph·ªß k√≠nh kh√°ch h√†ng l√™n ƒë∆°n - ERP lu√¥n th√¥ng b√°o t·ª± ƒë·ªông nh·∫Øc n√™n xem k·ªπ.</p>
    <p>H√£y xem video-podcast chia s·∫Ω c√°ch trao ƒë·ªïi kh√°ch h√†ng ƒëang h·ª£p t√°c th√™m : N√™u chu·∫©n b·ªã th√¥ng tin ch√†o m·ªùi, danh m·ª•c, s·∫£n ph·∫©m gi·ªõi thi·ªáu th√™m m·ªü r·ªông.</p>
    <p>Tr∆∞·ªõc khi l√™n ƒë∆°n n√™n ph·ªëi h·ª£p kho v·∫≠n - ki·ªÉm tra h√†ng h√≥a trong kho - thu·ªëc k·ªπ ƒë·ªÉ b√°o cho kh√°ch h√†ng - t√°ch ƒë∆°n giao s·∫£n ph·∫©m c√≥ s·∫µn kho - tr√°nh ƒë·ªÉ ch·ªù s·∫Ω m·∫•t ƒë∆°n.</p>
	<p>Vi·ªác l√™n ƒë∆°n h√†ng thu·ªëc - kh√¥ng ph·∫£i thu·ªëc - ti·ªÅn m·∫∑t - thu h·ªô - thi·∫øt l·∫≠p n·ª£ ph·∫£i k·ªπ c√†ng - ch·ªçn tick tr√°nh sai s√≥t - xem l·∫°i tr∆∞·ªõc khi xu·∫•t giao</p>
	<p>Ph·ª• tr√°ch ƒë∆°n chu·ªói NT l·ªõn ph·∫£i ki·ªÉm tra gi√° -h√≥a ƒë∆°n th√¥ng qua ·ª©ng d·ª•ng AI c·ªßa c√¥ng ty - ƒë·∫∑c bi·ªát cho Chu·ªói PMC nh√≥m UVS ph·∫£i ch·ªçn chi·∫øt kh·∫•u b√°o c√°o ngo√†i chi·∫øt kh·∫•u th∆∞∆°ng m·∫°i 40%</p>
	
    <h3>3Ô∏è‚É£ KHO V·∫¨N </h3>
    <ul>
        <li>Ki·ªÉm tra L√¥ - H·∫°n d√πng tr√™n m·ªçi ch·ª©ng t·ª´ nh·∫≠p kho -khai b√°o ph·∫ßn m·ªÅm -ƒë·ªïi chi·∫øu ERP t·ªìn kho cu·ªëi k·ª≥ ƒë·ªÉ ch·ªânh s·ª≠a n·∫øu sai s√≥t.</li>
        <li>Khai b√°o App ƒê√ìNG H√ÄNG - GIAO NH·∫¨N ph√¢n c√¥ng khai b√°o ƒë·ªß -ki·ªÉm tra cu·ªëi k·ª≥ l·∫°i .</li>
        <li>D·ªØ li·ªáu khai b√°o phi·∫øu nh·∫≠p h√†ng  -xu·∫•t kho thu·ªëc ph·∫£i l∆∞u in cho khai l√¥ h·∫°n d√πng k·ªπ ƒë·ªÉ l√†m b·∫±ng ch·ª©ng truy xu·∫•t - ƒë√°nh gi√° GDP chu·∫©n</li>
		<p> Qu·∫£n l√Ω SOP: ƒëi·ªÅu ki·ªán b·∫£o quan kho - d·ªØ li·ªáu theo d√µi - ƒë·ªìng b·ªô SOP ph·∫£i ƒë·ªãnh k·ª≥ c√πng nhau cu·ªëi th√°ng ki·ªÉm - in l∆∞u r·ªè r√†ng trong b·ªô ph·∫≠n</p>
		<p> Vi·ªác ki·ªÉm kho ph·∫£i ƒë∆∞·ª£c th√¥ng b√°o tr∆∞·ªõc - ph√¢n c√¥ng ki·ªÉm tra - ghi nh·∫≠n - l·∫≠p bi√™n b·∫£n - l∆∞u bi√™n b·∫£ng c·ª• th·ªÉ tr√¨nh BGƒê v√† l∆∞u k√Ω</p>
    </ul>
</template>

<template id="tpl-yellow">
    <h2 style="color: #f9a825">üü° K·∫æ TO√ÅN - T√ÄI CH√çNH</h2>
    <h3>1Ô∏è‚É£ NGHI·ªÜP V·ª§</h3>
    <p>Xem Checklist, b·ªï sung ngay n·∫øu c√≥ ph√°t sinh. Khai b√°o ƒë·ªìng b·ªô MISA-ERP.</p>
    <p>Qu·∫£n l√Ω ch·∫∑t ch·∫Ω L√î- H·∫†N D·ª§NG trong nh·∫≠p ch·ª©ng t·ª´ : xu·∫•t h√≥a ƒë∆°n ph·∫£i ƒë·ªëi chi·∫øu l·∫°i tr∆∞·ªõc khi g·ªüi cho kh√°ch h√†ng c·∫©n th·∫≠n.</p>
    <p>ƒêi·ªÅu ph·ªëi- ch·ªâ ƒë·∫°o c√¥ng vi·ªác kho nh·∫≠p li·ªáu Phi·∫øu nh·∫≠p- bi√™n b·∫£n nh·∫≠p thu·ªëc ph·∫£i ƒë√∫ng- ƒë·ªß m·ªçi ph√°t sinh trong ng√†y v√† lu√¥n ki·ªÉm tra l·∫°i,</p>
	<p>Lu√¥n ki·ªÉm tra l·∫°i ch·ª©ng t·ª´ MUA- B√ÅN thu·ªëc ph·∫£i ki·ªÉm tra L√î - H·∫†N c·∫©n th·∫≠n tr∆∞·ªõc khi ph√°t h√†nh- hay nh·∫≠p li·ªáu c·ªßa MISA- ·ª®NG D·ª§NG KHO.</p>
    
	<h3>2Ô∏è‚É£  KHAI B√ÅO MISA- KHO- ERP</h3>
    <p>Ho·∫°t ƒë·ªông thu chi ph·∫£i y√™u c·∫ßu m·ªçi nh√¢n vi√™n ph·∫£i l√†m ƒê·ªÄ XU·∫§T - K√®m ch·ª©ng t·ª´- l∆∞u c·∫©n th·∫≠n - in l∆∞u khi c·∫ßn,</p>
    <p>Lu√¥n ki·ªÉm tra email k·∫ø to√°n ƒë·ªÉ ki·ªÉm tra h√≥a ƒë∆°n nh√† cung c·∫•p - ph√¢n lo·∫°i cho d√∫ng khai b√°o c√°o Misa - ERP ƒë·ªìng th·ªùi, tr√°nh qu√™n, s√≥t,</p>
    <p>Lu√¥n ki·ªÉm tra ƒë·ªëi chi·∫øu s·ªë li·ªáu khai tr√™n MISA - ERP ph·∫£i ƒë·ªìng b·ªô, ƒë·∫∑c bi·ªát t·ªìn kho h√†ng h√≥a ph√°t sinh ph·∫£i t∆∞∆°ng ƒë·ªëi kh·ªõp / k·ª≥,</p>
	 <p>ƒê·ªãnh k·ª≥ n√™n n√™u l√™n h·ªçp nh√≥m K·∫æ TO√ÅN- KHO V·∫¨N: ki·ªÉm tra c√¥ng vi·ªác th√†nh vi√™n- b√°o c√°o- x·ª≠ l√Ω- t·ªïng h·ª£p ƒë·ªÉ ph√°t hi·ªán sai s√≥t n·∫øu do hay ƒëi·ªÉm l·∫°i vi·ªác giao ho√†n th√†nh</p>
   
   <h3>3Ô∏è‚É£ QU·∫¢N L√ù D√íNG - TI·ªÄN- THU CHI - TI·ªÄN M·∫∂T</h3>
    <p>C·∫ßn t·ªï ch·ª©c qu·∫£n l√Ω b·∫£ng cashflow r·ªè r√†ng- theo d√µi chi khai ti·ªÅn m·∫∑t - thu chi - t√†i kho·∫£n .</p>
	<p>C√¢n ƒë·ªëi kho·∫£n thu - v·ªõi kho·∫£n chi h·ª£p l√Ω: lu√¥n b·∫£o v·ªá thanh kho·∫£n c√¥ng ty t·ªëi ∆∞u - hay tr√¨nh b√†o khi c√≥ n·ªôi dung c·∫ßn.</p>
	<p>B√°o c√°o Thu·∫ø- nghi·ªáp v·ª• tr√™n Misa l√† n·ªôi dung c·∫ßn tr√¨nh b√†y cu·ªëi th√°ng trong k·ª≥ b√°o c√°o ngo√†</p>

	 <h3>3Ô∏è‚É£ B√ÅO C√ÅO CU·ªêI K·ª≤- NGHI·ªÜP V·ª§ </h3>
    <p>Ra so√°t l·∫°i vi·ªác nh·∫≠p li·ªáu - ch·ª©ng t·ª´ - s·ªë li·ªáu mua - b√°n - kho d·∫ßn t·ª´ ng√†y 25 cu·ªëi th√°ng ƒë·ªÉ ƒë·ªëi so√°t d·∫ßn</p>
	<p>B√°o c√°o nghi·ªáp v·ª• k·∫ø to√°n n√™n t·∫≠p trung h∆°n trong b√°o c√°o cu·ªëi th√°ng v·ªõi BGƒê v√¨ K·∫øt qu·∫£ kinh doanh xem tr√™n ERP d√£ r·ªè.</p>
	<p>Lu√¥n c·∫≠p nh·∫≠t t·ªìn kho - ng√¢n h√†ng- thanh to√°n- khai ti·ªÅn m·∫∑t gi·∫£m tr√™n s·ªë s·ªï s√°ch - C√¢n ƒë·ªëi k·∫øt chuy·ªÉn Tk 911</p>
	
    <p style="text-align: center; margin-top: 20px; font-weight: bold; color: #d32f2f;">‚ù§Ô∏è BAN GI√ÅM ƒê·ªêC C·∫¢M ∆†N ‚ù§Ô∏è</p>
</template>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyA_fToIYgemRb8IiG_w6PKzT1hWsMHmCAU",
    authDomain: "nhacviec-60be5.firebaseapp.com",
    projectId: "nhacviec-60be5",
    storageBucket: "nhacviec-60be5.firebasestorage.app",
    messagingSenderId: "229663309740",
    appId: "1:229663309740:web:045944f1c47316fcbc8409",
    measurementId: "G-Y59LY8TTK5"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  const notiRef = ref(db, 'ideco_global_notify/current_trigger');

  const overlay = document.getElementById('idcrOverlay');
  const modal = document.getElementById('idcrModal');
  const contentBox = document.getElementById('idcrContent');
  const readBtn = document.getElementById('idcrReadBtn'); // N√∫t m·ªõi
  let lastTimestamp = 0;

  function showPopup(type) {
    const tpl = document.getElementById('tpl-' + type);
    if (!tpl) return;
    contentBox.innerHTML = tpl.innerHTML;
    modal.className = 'idcr-modal'; 
    modal.classList.add('theme-' + type);
    
    // Lu√¥n lu√¥n ch·ªõp t·∫Øt (tr·ª´ khi l√† white, ho·∫∑c tu·ª≥ √Ω b·∫°n)
    // ·ªû ƒë√¢y gi·ªØ logic c≈©: type != white th√¨ ch·ªõp.
    if (type !== 'white') modal.classList.add('is-blinking');
    
    overlay.classList.add('is-active');
    
    // ƒê√É X√ìA: setTimeout (kh√¥ng t·ª± t·∫Øt n·ªØa)
  }

  function hidePopup() {
    overlay.classList.remove('is-active');
  }

  // S·ª± ki·ªán n√∫t "ƒê√É ƒê·ªåC"
  readBtn.addEventListener('click', hidePopup);
  
  // ƒê√É X√ìA: overlay click event (click ra ngo√†i kh√¥ng t·∫Øt)

  onValue(notiRef, (snapshot) => {
    const data = snapshot.val();
    if (data && data.type && data.timestamp) {
      const now = Date.now();
      // Logic c≈©: ch·ªâ hi·ªán n·∫øu tin m·ªõi trong v√≤ng 60s
      if (now - data.timestamp < 60000 && data.timestamp !== lastTimestamp) {
        console.log("Nh·∫≠n th√¥ng b√°o m·ªõi:", data.type);
        lastTimestamp = data.timestamp;
        showPopup(data.type);
      }
    }
  });

  document.querySelectorAll('.idcr-fab').forEach(btn => {
    btn.addEventListener('click', () => {
      const type = btn.getAttribute('data-type');
      set(notiRef, { type: type, timestamp: Date.now(), sender: 'web_client' })
        .catch(err => console.error(err));
    });
  });
</script>


<!-- Script TH√îNG B√ÅO T·ª™ XA QUA INFOGRAPHIC -->
<div id="iw_widget_root">
    <div id="iw_main_icon" title="Xem Th√¥ng B√°o"><span>XEM ·∫¢NH</span></div>
    <div id="iw_modal_overlay">
        <div id="iw_modal_content">
            <div id="iw_modal_header">
                <span style="font-weight: bold; color: #b45309;">TH√îNG B√ÅO M·ªöI</span>
                </div>
            <div id="iw_content_body"><div class="iw_loading">ƒêang t·∫£i d·ªØ li·ªáu...</div></div>
            <div id="iw_modal_footer"><button id="iw_read_btn">ƒê√£ ƒë·ªçc / ƒê√≥ng</button></div>
        </div>
    </div>
</div>

<style>
    /* Reset c∆° b·∫£n */
    #iw_widget_root { font-family: Arial, sans-serif; text-align: left; line-height: 1.5; }
    #iw_widget_root * { box-sizing: border-box; }

    /* N√∫t icon m·ªü widget */
    #iw_main_icon { position: fixed; bottom:184px; right: 20px; z-index: 999999; background-color: #f97316; color: white; padding: 10px 20px; border-radius: 30px; border: 3px solid white; box-shadow: 0 4px 15px rgba(0,0,0,0.3); cursor: pointer; font-weight: bold; width: 65px; text-align: center; display: flex; align-items: center; justify-content: center; transition: transform 0.2s; }
    #iw_main_icon:hover { transform: scale(1.05); }

    /* M√†n h√¨nh n·ªÅn m·ªù */
    #iw_modal_overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.85); z-index: 1000000; align-items: center; justify-content: center; }
    #iw_modal_overlay.active { display: flex; }

    /* --- PH·∫¶N QUAN TR·ªåNG NH·∫§T: K√çCH TH∆Ø·ªöC POPUP --- */
    #iw_modal_content { 
        background: white; 
        /* Chi·ªÅu r·ªông chi·∫øm 95% m√†n h√¨nh thi·∫øt b·ªã */
        width: 95vw; 
        max-width: 95vw; 
        /* Chi·ªÅu cao chi·∫øm 95% m√†n h√¨nh thi·∫øt b·ªã */
        height: 95vh; 
        border-radius: 8px; 
        display: flex; 
        flex-direction: column; 
        box-shadow: 0 0 50px rgba(0,0,0,0.8); 
        border: 2px solid #555;
    }

    /* Header nh·ªè g·ªçn */
    #iw_modal_header { padding: 8px 15px; border-bottom: 1px solid #ddd; display: flex; justify-content: space-between; align-items: center; background: #fffbeb; flex-shrink: 0; }

    /* V√πng n·ªôi dung ch√≠nh */
    #iw_content_body { 
        flex: 1; 
        overflow-y: auto; 
        padding: 0; /* X√≥a kho·∫£ng tr·∫Øng vi·ªÅn ƒë·ªÉ ·∫£nh to nh·∫•t c√≥ th·ªÉ */
        background-color: #f0f0f0; 
        text-align: center; /* CƒÉn gi·ªØa ·∫£nh */
    }

    /* Footer n√∫t b·∫•m */
    #iw_modal_footer { padding: 10px; border-top: 1px solid #ddd; text-align: center; background: #fff; flex-shrink: 0; }
    #iw_read_btn { background-color: #333; color: white; padding: 10px 40px; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; font-weight: bold; }
    #iw_read_btn:hover { background-color: #000; }

    /* Item ch·ª©a n·ªôi dung */
    .iw_item_container { margin-bottom: 0; width: 100%; }
    
    /* ·∫¢NH HI·ªÇN TH·ªä TO H·∫æT C·ª† - CSS T·ªëi ∆∞u ƒë·ªô n√©t */
    .iw_img_fluid { 
        width: 100%; 
        height: auto; 
        display: block; 
        object-fit: contain; 
        image-rendering: optimizeSpeed; 
        image-rendering: -moz-crisp-edges; 
        image-rendering: pixelated; 
    }
    
    /* PDF */
    .iw_pdf_canvas { width: 100%; height: auto; display: block; margin: 0 auto; }
    
    /* VƒÉn b·∫£n (gi·ªØ padding cho d·ªÖ ƒë·ªçc) */
    .iw_text_content { padding: 30px; background: #fff; font-size: 18px; line-height: 1.6; text-align: left; max-width: 1200px; margin: 0 auto; } 
    .iw_loading { text-align: center; padding: 50px; font-size: 18px; color: #666; }
</style>

<script>
(function() {
    function loadScript(src) { return new Promise((res, rej) => { if (document.querySelector(`script[src="${src}"]`)) return res(); const s = document.createElement('script'); s.src = src; s.onload = res; s.onerror = rej; document.head.appendChild(s); }); }
    Promise.all([
        loadScript("https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"),
        loadScript("https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js")
    ]).then(() => loadScript("https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"))
    .then(() => initWidgetApp()).catch(e => console.error("Widget Load Error", e));

    function initWidgetApp() {
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js';
        
        const config = {
            apiKey: "AIzaSyBIp68MT7Sh72-ZibE6iYr3hZCzTfCcY_k",
            authDomain: "podcastideco1.firebaseapp.com",
            projectId: "podcastideco1",
            storageBucket: "podcastideco1.firebasestorage.app",
            messagingSenderId: "219029042374",
            appId: "1:219029042374:web:f6ddb9f7abe755aa7953c7",
            measurementId: "G-0WH57T6Q58",
            databaseURL: "https://podcastideco1-default-rtdb.firebaseio.com" 
        };

        let app; try { app = firebase.initializeApp(config, "InfoWidgetApp"); } catch(e) { app = firebase.app("InfoWidgetApp"); }
        const db = app.database();

        const icon = document.getElementById('iw_main_icon');
        const overlay = document.getElementById('iw_modal_overlay');
        const contentBody = document.getElementById('iw_content_body');
        const readBtn = document.getElementById('iw_read_btn');

        const openPopup = () => { overlay.classList.add('active'); loadContent(); };
        const closePopup = () => overlay.classList.remove('active');
        icon.onclick = openPopup;
        readBtn.onclick = closePopup; // Ch·ªâ t·∫Øt khi b·∫•m ƒê√£ ƒë·ªçc / ƒê√≥ng
        // ƒê√£ lo·∫°i b·ªè s·ª± ki·ªán t·∫Øt khi b·∫•m n√∫t X ho·∫∑c b·∫•m ra ngo√†i Overlay

        // --- LOGIC X·ª¨ L√ù NG√ÄY V√Ä TH·ªúI GIAN TR·ªÑ ---
        let isInitialLoad = true; 

        db.ref('systemControl/forceTrigger').on('value', (snapshot) => {
            const serverTime = snapshot.val();
            if (!serverTime) return;
            
            const lastSeen = localStorage.getItem('iw_last_trigger_time');
            
            const now = new Date();
            const triggerDate = new Date(serverTime);
            
            // Ki·ªÉm tra xem c√≥ ph·∫£i "H√¥m Nay" kh√¥ng (so s√°nh Ng√†y/Th√°ng/NƒÉm)
            const isSameDay = triggerDate.getDate() === now.getDate() &&
                              triggerDate.getMonth() === now.getMonth() &&
                              triggerDate.getFullYear() === now.getFullYear();

            // N·∫øu Server c√≥ th√¥ng b√°o m·ªõi (kh√°c v·ªõi c√°i ƒë√£ l∆∞u)
            if (serverTime != lastSeen) {
                
                if (isSameDay) {
                    if (isInitialLoad) {
                        // Tr∆∞·ªùng h·ª£p 1: V√†o sau khi Admin ƒë√£ b·∫•m (c√πng ng√†y) -> ƒê·ª£i 10s
                        console.log("Th√¥ng b√°o trong ng√†y, kh√°ch v√†o sau. ƒê·ª£i 10s...");
                        setTimeout(() => {
                            const currentSeen = localStorage.getItem('iw_last_trigger_time');
                            if (serverTime != currentSeen) {
                                openPopup();
                                localStorage.setItem('iw_last_trigger_time', serverTime);
                            }
                        }, 10000); // 10 gi√¢y
                    } else {
                        // Tr∆∞·ªùng h·ª£p 2: ƒêang l∆∞·ªõt web th√¨ Admin b·∫•m -> Hi·ªán ngay
                        console.log("Admin v·ª´a b·∫•m t·ª©c th√¨ -> Hi·ªán ngay!");
                        openPopup();
                        localStorage.setItem('iw_last_trigger_time', serverTime);
                    }
                } 
                else {
                    // Tr∆∞·ªùng h·ª£p 3: Th√¥ng b√°o c≈© (t·ª´ h√¥m qua tr·ªü v·ªÅ tr∆∞·ªõc) -> Kh√¥ng hi·ªán
                    console.log("Th√¥ng b√°o c≈© t·ª´ h√¥m qua -> Kh√¥ng hi·ªán.");
                    localStorage.setItem('iw_last_trigger_time', serverTime); 
                }
            }
            
            isInitialLoad = false;
        });

        function loadContent() {
            contentBody.innerHTML = '<div class="iw_loading">ƒêang t·∫£i d·ªØ li·ªáu...</div>';
            db.ref('pdfData').once('value').then(snap => {
                const data = snap.val();
                contentBody.innerHTML = '';
                if(!data) { contentBody.innerHTML = '<div class="iw_loading">Ch∆∞a c√≥ th√¥ng b√°o.</div>'; return; }
                const list = Array.isArray(data) ? data : Object.values(data);
                if(list.length === 0) { contentBody.innerHTML = '<div class="iw_loading">Danh s√°ch tr·ªëng.</div>'; return; }

                list.forEach((item, idx) => {
                    const wrap = document.createElement('div'); wrap.className = 'iw_item_container';
                    if (item.type === 'text') { const d = document.createElement('div'); d.className='iw_text_content'; d.innerHTML = item.html; wrap.appendChild(d); }
                    else if (item.type === 'image') { wrap.innerHTML += `<img class="iw_img_fluid" src="${item.data}">`; }
                    else if (item.type === 'pdf') { renderPdf(item.data, wrap); }
                    contentBody.appendChild(wrap);
                });
            });
        }
        async function renderPdf(b64, box) { try { if(b64.includes(',')) b64=b64.split(',')[1]; const bin=atob(b64), len=bin.length, u8=new Uint8Array(len); for(let i=0;i<len;i++) u8[i]=bin.charCodeAt(i); const pdf=await pdfjsLib.getDocument({data:u8}).promise; for(let j=1;j<=pdf.numPages;j++){ const p=await pdf.getPage(j), v=p.getViewport({scale: (box.clientWidth||1200)/p.getViewport({scale:1}).width }), c=document.createElement('canvas'); c.className='iw_pdf_canvas'; c.width=v.width; c.height=v.height; box.appendChild(c); await p.render({canvasContext:c.getContext('2d'), viewport:v}).promise; } } catch(e){ box.innerHTML+='<div style="color:red">L·ªói PDF</div>'; } }
    }
})();
</script>
